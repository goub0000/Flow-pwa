<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flow — Recommender Onboarding</title>
  <meta name="description" content="Complete your profile and upload recommendation letters for students." />
  <link rel="icon" href="/assets/img/logo.PNG" type="image/png" />
  <link rel="apple-touch-icon" href="/assets/img/logo.PNG" />
  <link rel="stylesheet" href="/assets/css/base.css" />
  <link rel="stylesheet" href="/assets/css/recommenders-onboarding.css" />
</head>
<body>
  <a href="#main" class="skip-link">Skip to content</a>

  <!-- Enhanced Header -->
  <header class="header" role="banner" aria-label="Site header">
    <div class="container header__inner">
      <a class="brand" href="/" aria-label="Flow home">
        <img src="/assets/img/logo.PNG" class="brand__logo" alt="Flow logo" />
        <span class="brand__name">Flow</span>
      </a>

      <div class="onboarding-controls">
        <!-- Progress Indicator -->
        <div class="progress-indicator">
          <div class="progress-circle active">1</div>
          <div class="progress-line"></div>
          <div class="progress-circle">2</div>
          <div class="progress-line"></div>
          <div class="progress-circle">3</div>
        </div>
        
        <!-- Help Button -->
        <button class="help-button" title="Get Help" aria-label="Get Help">
          <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </button>
        
        <!-- Language Switch -->
        <form class="lang-switch" aria-label="Language selector">
          <select id="lang" name="lang">
            <option value="en" selected>EN</option>
            <option value="fr">FR</option>
            <option value="ar">AR</option>
            <option value="sw">SW</option>
          </select>
        </form>
        
        <!-- Save & Exit -->
        <button class="save-exit-btn" title="Save & Exit" aria-label="Save & Exit">
          Save & Exit
        </button>
      </div>
    </div>
  </header>

  <!-- Local nav -->
  <div class="subnav" role="navigation" aria-label="Recommender onboarding">
    <div class="container wrap" style="gap:.5rem; flex-wrap:wrap;">
      <a href="/get-started/" class="badge">← Back to role chooser</a>
      <a href="/recommenders/" class="badge">Recommender Portal</a>
    </div>
  </div>

  <main id="main" class="onboarding">
    <div class="container onboarding__container">
      <!-- Progress rail -->
      <aside class="steps-nav" aria-label="Onboarding progress">
        <h2 class="steps-nav__title">Setup checklist</h2>
        <ol class="steps" role="list">
          <li class="step step--current"><span class="step__bullet">1</span><div><a class="step__label" href="#step-profile">Profile</a><p class="step__desc">Your information</p></div></li>
          <li class="step"><span class="step__bullet">2</span><div><a class="step__label" href="#step-preferences">Preferences</a><p class="step__desc">Notifications</p></div></li>
          <li class="step"><span class="step__bullet">3</span><div><a class="step__label" href="#step-review">Review</a><p class="step__desc">Finish</p></div></li>
        </ol>
      </aside>

      <!-- Content -->
      <div class="section">
        <div class="onboarding__intro card notice">
          <h1 class="u-mb-0">Recommender Onboarding</h1>
          <p class="u-mt-2 u-mb-0">Complete your profile to start providing recommendations for students. You can save a draft and return later.</p>
        </div>

        <!-- Step 1: Profile -->
        <section id="step-profile" class="card" aria-labelledby="profileTitle">
          <div class="section__header">
            <h2 id="profileTitle">1. Profile Information</h2>
            <div class="header-actions"><span class="pill pill--ok">Required</span></div>
          </div>
          <form class="form">
            <div class="grid grid--2">
              <label>First name<input type="text" placeholder="Aisha" /></label>
              <label>Last name<input type="text" placeholder="Ouedraogo" /></label>
              <label>Institution / Organization<input type="text" placeholder="University of Accra" /></label>
              <label>Title / Role<input type="text" placeholder="Professor of Computer Science" /></label>
            </div>
            <div class="grid grid--2">
              <label>Email<input type="email" placeholder="aisha@university.edu" /></label>
              <label>Phone<input type="tel" placeholder="+233 55 000 0000" /></label>
            </div>
            <div class="section__actions">
              <a class="btn btn--ghost" href="#step-preferences">Next: Preferences</a>
              <a class="btn" href="#" aria-disabled="true">Save draft</a>
            </div>
          </form>
        </section>

        <!-- Step 2: Preferences -->
        <section id="step-preferences" class="card" aria-labelledby="prefTitle">
          <div class="section__header">
            <h2 id="prefTitle">2. Preferences</h2>
            <div class="header-actions"><span class="pill">Optional</span></div>
          </div>
          <form class="form">
            <div class="grid grid--3">
              <label>Notifications
                <select>
                  <option>All</option>
                  <option>Only requests</option>
                  <option>None</option>
                </select>
              </label>
              <label>Email summary
                <select>
                  <option>Weekly</option>
                  <option>Monthly</option>
                  <option>Disabled</option>
                </select>
              </label>
              <label>Language
                <select>
                  <option>English</option>
                  <option>Français</option>
                  <option>العربية</option>
                  <option>Kiswahili</option>
                </select>
              </label>
            </div>
            <div class="section__actions">
              <a class="btn btn--ghost" href="#step-review">Next: Review</a>
              <a class="btn" href="#" aria-disabled="true">Save</a>
            </div>
          </form>
        </section>

        <!-- Step 3: Review & Finish -->
        <section id="step-review" class="card complete" aria-labelledby="reviewTitle">
          <div class="section__header">
            <h2 id="reviewTitle">3. Review & Finish</h2>
            <div class="header-actions"><span class="pill pill--ok">Ready</span></div>
          </div>
          <div class="grid grid--2">
            <div>
              <h3 class="u-mt-0">Summary</h3>
              <ul class="checklist">
                <li>Profile: <strong>Complete</strong></li>
                <li>Preferences: <strong>Set</strong></li>
              </ul>
            </div>
            <div>
              <h3 class="u-mt-0">Next steps</h3>
              <p>After finishing, you'll access the Recommender Portal where you can respond to student requests and upload recommendation letters.</p>
            </div>
          </div>
          <fieldset class="fieldset u-mt-4">
            <legend class="sr-only">Legal agreement</legend>
            <label>
              <input type="checkbox" /> I agree to Flow's <a href="/legal/privacy.html">Privacy Policy</a> and <a href="/legal/terms.html">Terms of Service</a>.
            </label>
          </fieldset>
          <div class="wizard-ctrls">
            <a class="btn btn--ghost" href="#step-preferences">← Back</a>
            <a class="btn btn--secondary" href="/recommenders/">Finish & Go to Portal</a>
          </div>
        </section>

        <!-- Toast (placeholder) -->
        <div class="toast toast--ok" id="toast">
          <div class="toast__title">Saved</div>
          <div>Your onboarding draft has been saved.</div>
        </div>
      </div>
    </div>
  </main>

  <!-- Global Footer -->
  <footer class="footer" role="contentinfo" aria-label="Site footer">
    <div class="container footer__grid">
      <section class="footer__brand">
        <img src="/assets/img/logo.PNG" alt="" class="footer__logo" />
        <p class="footer__tagline">Connecting learners and institutions across Africa.</p>
      </section>
      <nav aria-label="Explore" class="footer__nav">
        <h3 class="footer__title">Explore</h3>
        <ul>
          <li><a href="/students/">Students</a></li>
          <li><a href="/institutions/">Institutions</a></li>
          <li><a href="/counselors/">Counselors</a></li>
          <li><a href="/parents/">Parents</a></li>
          <li><a href="/recommenders/">Recommenders</a></li>
        </ul>
      </nav>
      <nav aria-label="Legal" class="footer__nav">
        <h3 class="footer__title">Legal</h3>
        <ul>
          <li><a href="/legal/terms.html">Terms</a></li>
          <li><a href="/legal/privacy.html">Privacy</a></li>
          <li><a href="/legal/cookies.html">Cookies</a></li>
        </ul>
      </nav>
      <section class="footer__cta">
        <h3 class="footer__title">Need help?</h3>
        <a href="/recommenders/" class="btn btn--primary">Open Recommender Portal</a>
      </section>
    </div>
    <div class="footer__meta">
      <div class="container">
        <small>© <span id="year"></span> Flow</small>
      </div>
    </div>
  </footer>

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore-compat.js"></script>
  <script src="/assets/js/firebase-config.js"></script>
  <script src="/assets/js/firebase-auth.js"></script>
  <script src="/assets/js/onboarding-save.js"></script>

  <script>
    (function(){ try { document.getElementById('year').textContent = new Date().getFullYear(); } catch(e){} })();

    // Add save functionality for recommender onboarding
    document.addEventListener('DOMContentLoaded', function() {
      const completeBtn = document.querySelector('button[type="submit"]') ||
                         document.querySelector('.btn--primary');

      if (completeBtn && completeBtn.textContent.includes('Dashboard')) {
        completeBtn.addEventListener('click', async function(e) {
          e.preventDefault();
          const btn = this;
          const originalText = btn.innerHTML;
          btn.disabled = true;
          btn.innerHTML = 'Saving...';

          try {
            const formData = window.recommenderOnboardingData || {};

            const profileData = {
              accountType: 'recommender',
              firstName: formData.firstName || '',
              lastName: formData.lastName || '',
              displayName: `${formData.firstName || ''} ${formData.lastName || ''}`.trim() || 'Recommender',
              title: formData.title || '',
              organization: formData.organization || '',
              phone: formData.phone || '',
              relationship: formData.relationship || '',
              preferences: {
                language: localStorage.getItem('flowLanguage') || 'en'
              }
            };

            console.log('💾 Saving recommender profile:', profileData);

            const result = await window.OnboardingSave.saveProfile(profileData);

            if (result.success) {
              console.log('✅ Recommender profile saved successfully');
              btn.innerHTML = '✓ Complete!';
              setTimeout(() => {
                window.location.href = '/recommenders/';
              }, 1000);
            } else {
              throw new Error(result.message || 'Failed to save profile');
            }
          } catch (error) {
            console.error('❌ Error saving recommender profile:', error);
            alert('Failed to save profile: ' + error.message);
            btn.disabled = false;
            btn.innerHTML = originalText;
          }
        });
      }
    });
  </script>
</body>
</html>
