<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Account Types - Flow</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        .account-card {
            background: #f8f9fa;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }
        .account-email {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .account-uid {
            font-size: 12px;
            color: #999;
            font-family: monospace;
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }
        select, input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 10px;
        }
        button:hover {
            opacity: 0.9;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Setup Account Types</h1>
        <p class="subtitle">Set account types for your Firebase users</p>

        <div id="loading" class="loading">
            <p>Loading Firebase...</p>
        </div>

        <div id="content" style="display: none;">
            <!-- Account 1 -->
            <div class="account-card">
                <div class="account-email">ogouba3@gmail.com</div>
                <div class="account-uid">UID: aDaNnSiDrVYCW2cRXE1QPr0aC7v2</div>

                <label for="account1-type">Account Type:</label>
                <select id="account1-type">
                    <option value="student">Student</option>
                    <option value="institution" selected>Institution</option>
                    <option value="counselor">Counselor</option>
                    <option value="parent">Parent</option>
                    <option value="recommender">Recommender</option>
                </select>

                <label for="account1-name">Display Name:</label>
                <input type="text" id="account1-name" value="Test Institution">

                <button onclick="updateAccount('aDaNnSiDrVYCW2cRXE1QPr0aC7v2', 'ogouba3@gmail.com')">
                    Update Account
                </button>
            </div>

            <!-- Account 2 -->
            <div class="account-card">
                <div class="account-email">oumarou.gouba-1@ou.edu</div>
                <div class="account-uid">UID: wuw2ArmjsKOAzl5MFy9yMcYppLt1</div>

                <label for="account2-type">Account Type:</label>
                <select id="account2-type">
                    <option value="student" selected>Student</option>
                    <option value="institution">Institution</option>
                    <option value="counselor">Counselor</option>
                    <option value="parent">Parent</option>
                    <option value="recommender">Recommender</option>
                </select>

                <label for="account2-name">Display Name:</label>
                <input type="text" id="account2-name" value="Oumarou Gouba">

                <button onclick="updateAccount('wuw2ArmjsKOAzl5MFy9yMcYppLt1', 'oumarou.gouba-1@ou.edu')">
                    Update Account
                </button>
            </div>

            <div id="status" class="status"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAJ7QV35ydmmIxIwe9rCPHzD3AT8I6yiCY",
            authDomain: "flow-pwa.firebaseapp.com",
            projectId: "flow-pwa",
            storageBucket: "flow-pwa.firebasestorage.app",
            messagingSenderId: "940039973517",
            appId: "1:940039973517:web:4cee57759b916cb34850c4"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Wait for auth state and check if user is logged in
        auth.onAuthStateChanged((user) => {
            if (user) {
                console.log('User authenticated:', user.email);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
            } else {
                // Show login prompt
                document.getElementById('loading').innerHTML = `
                    <p>Please log in to set account types</p>
                    <button onclick="loginAsAdmin()" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">
                        Login
                    </button>
                `;
            }
        });

        async function loginAsAdmin() {
            const email = prompt('Enter your email:');
            const password = prompt('Enter your password:');

            if (email && password) {
                try {
                    await auth.signInWithEmailAndPassword(email, password);
                    showStatus('‚úÖ Logged in successfully!', true);
                } catch (error) {
                    showStatus('‚ùå Login failed: ' + error.message, false);
                }
            }
        }

        function showStatus(message, isSuccess) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + (isSuccess ? 'success' : 'error');
            status.style.display = 'block';

            setTimeout(() => {
                status.style.display = 'none';
            }, 5000);
        }

        async function updateAccount(uid, email) {
            const typeId = uid === 'aDaNnSiDrVYCW2cRXE1QPr0aC7v2' ? 'account1' : 'account2';
            const accountType = document.getElementById(typeId + '-type').value;
            const displayName = document.getElementById(typeId + '-name').value;

            const button = event.target;
            button.disabled = true;
            button.textContent = 'Updating...';

            try {
                const data = {
                    email: email,
                    accountType: accountType,
                    displayName: displayName,
                    isVerified: true,
                    isActive: true,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                // Add type-specific fields
                if (accountType === 'institution') {
                    data.institutionName = displayName;
                } else if (accountType === 'student') {
                    const names = displayName.split(' ');
                    data.firstName = names[0] || '';
                    data.lastName = names.slice(1).join(' ') || '';
                }

                await db.collection('users').doc(uid).set(data, { merge: true });

                showStatus(`‚úÖ Successfully updated ${email} as ${accountType}`, true);
                button.textContent = '‚úì Updated';

                setTimeout(() => {
                    button.textContent = 'Update Account';
                    button.disabled = false;
                }, 2000);
            } catch (error) {
                console.error('Error updating account:', error);
                showStatus(`‚ùå Error: ${error.message}`, false);
                button.textContent = 'Update Account';
                button.disabled = false;
            }
        }
    </script>
</body>
</html>
