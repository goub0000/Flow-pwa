<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reports & Analytics - Institution Portal | Flow</title>
  <meta name="description" content="Generate insights and reports on your institution's performance through advanced analytics.">
  
  <!-- Styles -->
  <link rel="stylesheet" href="/assets/css/base.css">
  <link rel="stylesheet" href="/assets/css/institutions.css">

  <style>
    /* Header Smaller Size and Blue Buttons */
    .header {
      padding: 0.8rem 0 !important;
    }

    .header:hover {
      padding: 1rem 0 !important;
    }

    /* Header Buttons - Blue Background with White Icons */
    .header-search__trigger,
    .header-notifications__trigger,
    .header-messages__trigger {
      background: #5a5bb8 !important;
      border-radius: 50% !important;
      padding: 0.75rem !important;
      border: none !important;
      transition: all 0.3s ease !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
    }

    .header-search__trigger svg,
    .header-notifications__trigger svg,
    .header-messages__trigger svg {
      fill: white !important;
      stroke: white !important;
    }

    .header-search__trigger:hover,
    .header-notifications__trigger:hover,
    .header-messages__trigger:hover {
      background: #4c4db8 !important;
      transform: translateY(-2px) !important;
      box-shadow: 0 4px 12px rgba(76, 77, 184, 0.3) !important;
    }

    .header-profile__trigger,
    .header-mobile-toggle {
      color: #5a5bb8 !important;
    }

    .header-profile__trigger:hover,
    .header-mobile-toggle:hover {
      color: #4c4db8 !important;
    }

    /* Enhanced Navigation Styling */
    .nav-hover-item:hover {
      background: rgba(255, 255, 255, 0.15) !important;
      color: white !important;
      transform: translateY(-2px) !important;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2) !important;
    }

    /* Enhanced Content Padding */
    .reports-feature-card {
      padding: 2rem !important;
      margin: 1rem 0 !important;
      border-radius: 16px !important;
      transition: all 0.3s ease !important;
    }

    .reports-feature-card:hover {
      transform: translateY(-4px) !important;
      box-shadow: 0 8px 24px rgba(90, 91, 184, 0.15) !important;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .subnav {
        padding: 1.5rem 0 !important;
      }

      .subnav__inner {
        padding: 1rem 1.5rem !important;
        flex-direction: column !important;
        gap: 1rem !important;
      }

      .subnav__link {
        text-align: center !important;
        margin: 0 !important;
        padding: 1rem 1.5rem !important;
      }

      .container {
        padding: 0 1.5rem !important;
      }

      .section__header {
        padding: 1.5rem 0 2rem 0 !important;
        margin-bottom: 2rem !important;
      }

      .coming-soon {
        padding: 2rem 1.5rem !important;
        margin: 1rem 0 !important;
      }
    }
  </style>
  
  <!-- Favicon -->
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/img/favicon.png" type="image/png">
</head>

<body>
  <!-- Skip link for accessibility -->
  <a href="#main" class="skip-link">Skip to content</a>

  <!-- Toast notifications container -->
  <div id="toast-container" class="toast-container" aria-live="polite"></div>

  <!-- Site header -->
  <header class="header" role="banner" aria-label="Site header">
    <div class="container header__inner">
      <a class="brand" href="/" aria-label="Flow home">
        <img src="/assets/img/logo.png" class="brand__logo" alt="Flow logo" width="40" height="40" />
        <span class="brand__name">Flow</span>
      </a>

      <!-- Header Tools -->
      <div class="header-tools">
        <!-- Search -->
        <div class="header-search" id="headerSearch">
          <button class="header-search__trigger" id="searchTrigger" aria-label="Search">
            <svg width="20" height="20" fill="white">
              <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke="white" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <div class="header-search__dropdown" id="searchDropdown" aria-hidden="true">
            <div class="search-box">
              <input type="search" id="globalSearch" placeholder="Search reports, analytics, metrics..." aria-label="Global search">
            </div>
            <div class="search-suggestions" id="searchSuggestions"></div>
          </div>
        </div>

        <!-- Notifications -->
        <div class="header-notifications" id="headerNotifications">
          <button class="header-notifications__trigger" id="notificationsTrigger" aria-label="Notifications">
            <svg width="20" height="20" fill="white">
              <path d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
            </svg>
            <span class="header-notifications__badge" id="notificationsBadge">1</span>
          </button>
          <div class="header-notifications__dropdown" id="notificationsDropdown" aria-hidden="true">
            <div class="notifications-header">
              <h3>Notifications</h3>
              <button class="btn btn--sm btn--ghost" onclick="markAllNotificationsRead()">Mark all read</button>
            </div>
            <div class="notifications-list">
              <div class="notification-item notification-item--unread" data-id="1">
                <div class="notification-icon notification-icon--new">📊</div>
                <div class="notification-content">
                  <div class="notification-title">Monthly Report Ready</div>
                  <div class="notification-message">September admissions report is ready for review</div>
                  <div class="notification-time">1 hour ago</div>
                </div>
                <button class="notification-dismiss" onclick="dismissNotification('1')" aria-label="Dismiss">×</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Messages -->
        <div class="header-messages" id="headerMessages">
          <button class="header-messages__trigger" id="messagesTrigger" aria-label="Messages">
            <svg width="20" height="20" fill="white">
              <path d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
            </svg>
            <span class="header-messages__badge" id="messagesBadge">0</span>
          </button>
          <div class="header-messages__dropdown" id="messagesDropdown" aria-hidden="true">
            <div class="messages-header">
              <h3>Recent Messages</h3>
              <button class="btn btn--sm btn--primary" onclick="composeMessage()">Compose</button>
            </div>
            <div class="messages-list" id="messagesList">
              <div class="message-placeholder">No recent messages</div>
            </div>
          </div>
        </div>

        <!-- User Profile -->
        <div class="header-profile" id="headerProfile">
          <button class="header-profile__trigger" id="profileTrigger" aria-label="User menu" aria-expanded="false">
            <div class="profile-avatar">
              <img src="/assets/img/avatars/institution.jpg" alt="University of Excellence" width="32" height="32">
            </div>
            <div class="profile-info">
              <span class="profile-name">University of Excellence</span>
              <span class="profile-role">Institution Admin</span>
            </div>
            <svg width="16" height="16" fill="white" class="profile-chevron">
              <path d="M4.646 4.646a.5.5 0 01.708 0L8 7.293l2.646-2.647a.5.5 0 01.708.708L8.707 8l2.647 2.646a.5.5 0 01-.708.708L8 8.707l-2.646 2.647a.5.5 0 01-.708-.708L7.293 8 4.646 5.354a.5.5 0 010-.708z"/>
            </svg>
          </button>
          <div class="header-profile__dropdown" id="profileDropdown" aria-hidden="true">
            <div class="profile-menu">
              <a href="/institutions/profile.html" class="profile-menu__item">
                <svg width="16" height="16" fill="white">
                  <path d="M8 8a3 3 0 100-6 3 3 0 000 6zM12.735 14c.618 0 1.093-.561.872-1.139a6.002 6.002 0 00-11.215 0c-.22.578.254 1.139.872 1.139h9.47z"/>
                </svg>
                Institution Profile
              </a>
              <a href="/institutions/settings.html" class="profile-menu__item">
                <svg width="16" height="16" fill="white">
                  <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 01-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 01.872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 012.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 012.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 01.872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 01-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 01-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 100-5.86 2.929 2.929 0 000 5.858z"/>
                </svg>
                Settings
              </a>
              <div class="profile-menu__divider"></div>
              <button class="profile-menu__item profile-menu__item--danger" onclick="signOut()">
                <svg width="16" height="16" fill="white">
                  <path d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 11-2 0V4H5v8h10V9a1 1 0 112 0v3a1 1 0 01-1 1H4a1 1 0 01-1-1V3z"/>
                  <path d="M6 10a1 1 0 011-1h4a1 1 0 110 2H7a1 1 0 01-1-1z"/>
                </svg>
                Sign Out
              </button>
            </div>
          </div>
        </div>

        <!-- Mobile Menu Toggle -->
        <button class="header-mobile-toggle" id="mobileMenuToggle" aria-label="Toggle menu" aria-expanded="false">
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
        </button>
      </div>
    </div>

    <!-- Mobile Navigation Overlay -->
    <div class="nav-overlay" id="navOverlay" aria-hidden="true">
      <div class="nav-overlay__content">
        <nav class="nav-overlay__menu">
          <a href="/institutions/" class="nav-overlay__link">Dashboard</a>
          <a href="/institutions/messages.html" class="nav-overlay__link">Messages</a>
          <a href="/institutions/programs.html" class="nav-overlay__link">Programs</a>
          <a href="/institutions/admissions.html" class="nav-overlay__link">Admissions</a>
          <a href="/institutions/reports.html" class="nav-overlay__link nav-overlay__link--active">Reports</a>
        </nav>
      </div>
    </div>
  </header>

  <!-- Sub-navigation -->
  <nav class="subnav" role="navigation" aria-label="Institution sections" style="background: #5a5bb8; padding: 2rem 0;">
    <div class="container">
      <div class="subnav__inner" style="padding: 1.5rem 3rem; border-radius: 16px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);">
        <a href="/institutions/" class="subnav__link nav-hover-item" style="padding: 1.25rem 2rem; margin: 0 0.5rem; border-radius: 12px; color: rgba(255, 255, 255, 0.9); transition: all 0.3s ease;">Dashboard</a>
        <a href="/institutions/messages.html" class="subnav__link nav-hover-item" style="padding: 1.25rem 2rem; margin: 0 0.5rem; border-radius: 12px; color: rgba(255, 255, 255, 0.9); transition: all 0.3s ease;">Messages</a>
        <a href="/institutions/programs.html" class="subnav__link nav-hover-item" style="padding: 1.25rem 2rem; margin: 0 0.5rem; border-radius: 12px; color: rgba(255, 255, 255, 0.9); transition: all 0.3s ease;">Programs</a>
        <a href="/institutions/admissions.html" class="subnav__link nav-hover-item" style="padding: 1.25rem 2rem; margin: 0 0.5rem; border-radius: 12px; color: rgba(255, 255, 255, 0.9); transition: all 0.3s ease;">Admissions</a>
        <a href="/institutions/reports.html" class="subnav__link subnav__link--active" style="padding: 1.25rem 2rem; margin: 0 0.5rem; border-radius: 12px; background: rgba(255, 255, 255, 0.2); color: white; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); font-weight: 600;">Reports</a>
      </div>
    </div>
  </nav>

  <!-- Main content -->
  <main id="main" role="main" style="padding: 4rem 0;">
    <section class="section" aria-labelledby="reportsTitle" style="padding: 3rem 0;">
      <div class="container" style="padding: 0 3rem;">
        <header class="section__header" style="padding: 2rem 0 3rem 0; margin-bottom: 4rem;">
          <h1 id="reportsTitle" style="padding: 1rem 2rem; margin-bottom: 1.5rem; background: linear-gradient(135deg, rgba(90, 91, 184, 0.05), rgba(90, 91, 184, 0.1)); border-radius: 16px; border-left: 6px solid #5a5bb8;">Analytics & Reports</h1>
          <p class="section__description" style="padding: 1.5rem 2rem; background: rgba(90, 91, 184, 0.03); border-radius: 12px; font-size: 1.2rem; line-height: 1.7;">Generate insights and reports on your institution's performance</p>
        </header>
        
        <div class="coming-soon" style="padding: 4rem 3rem; margin: 2rem 0; background: linear-gradient(135deg, rgba(90, 91, 184, 0.02), rgba(90, 91, 184, 0.05)); border: 2px solid rgba(90, 91, 184, 0.1); border-radius: 24px;">
          <div class="coming-soon__icon" style="padding: 1rem; margin-bottom: 2rem;">📊</div>
          <h2 style="padding: 1.5rem 2rem; margin-bottom: 2rem; background: rgba(255, 255, 255, 0.8); border-radius: 16px; box-shadow: 0 4px 12px rgba(90, 91, 184, 0.1);">Advanced Reporting Dashboard Coming Soon</h2>
          <p style="padding: 2rem 2.5rem; margin-bottom: 3rem; background: rgba(255, 255, 255, 0.6); border-radius: 16px; font-size: 1.1rem; line-height: 1.8; border: 1px solid rgba(90, 91, 184, 0.1);">Our comprehensive analytics and reporting platform is being developed to provide deep insights into your institution's performance. This powerful tool will include:</p>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
            <!-- Left Column -->
            <div>
              <div class="reports-feature-card" onclick="openApplicationTrends()" style="display: flex; align-items: flex-start; margin-bottom: 2rem; padding: 1.5rem; background: rgba(90, 91, 184, 0.05); border-radius: 12px; border-left: 4px solid #5a5bb8; cursor: pointer; transition: all 0.3s ease;">
                <svg width="64" height="64" fill="white" style="margin-right: 24px; color: #5a5bb8; flex-shrink: 0; margin-top: 4px;">
                  <path d="M2 3a1 1 0 011-1h1a1 1 0 011 1v1a1 1 0 01-1 1H3a1 1 0 01-1-1V3zM2 8a1 1 0 011-1h1a1 1 0 011 1v1a1 1 0 01-1 1H3a1 1 0 01-1-1V8zM2 13a1 1 0 011-1h1a1 1 0 011 1v1a1 1 0 01-1 1H3a1 1 0 01-1-1v-1zM7 3a1 1 0 011-1h7a1 1 0 110 2H8a1 1 0 01-1-1zM7 8a1 1 0 011-1h7a1 1 0 110 2H8a1 1 0 01-1-1zM7 13a1 1 0 011-1h7a1 1 0 110 2H8a1 1 0 01-1-1z"/>
                  <path d="M17 3l3 3-3 3m0-6h-3v6h3"/>
                  <circle cx="18" cy="5" r="1.5" fill="#22c55e"/>
                  <circle cx="18" cy="9" r="1.5" fill="#f59e0b"/>
                  <circle cx="18" cy="13" r="1.5" fill="#ef4444"/>
                </svg>
                <span style="font-size: 1.25rem; font-weight: 600; line-height: 1.4; color: #1a1a1a;">Application trends and statistical analysis</span>
              </div>
              
              <div class="reports-feature-card" onclick="openEnrollmentForecasting()" style="display: flex; align-items: flex-start; margin-bottom: 2rem; padding: 1.5rem; background: rgba(90, 91, 184, 0.05); border-radius: 12px; border-left: 4px solid #5a5bb8; cursor: pointer; transition: all 0.3s ease;">
                <svg width="64" height="64" fill="white" style="margin-right: 24px; color: #5a5bb8; flex-shrink: 0; margin-top: 4px;">
                  <path d="M3 3v4l4-2-4-2zm0 6v4l4-2-4-2zm0 6v4l4-2-4-2z"/>
                  <path d="M9 2l8 3v10l-8-3V2z" fill="none" stroke="white" stroke-width="1.5"/>
                  <path d="M9 6l8-3M9 10l8-3M9 14l8-3" stroke="white" stroke-width="1"/>
                  <path d="M13 8c0-2 2-4 4-4s4 2 4 4-2 4-4 4-4-2-4-4z" fill="none" stroke="#22c55e" stroke-width="1.5" stroke-dasharray="2,2"/>
                  <circle cx="17" cy="8" r="1" fill="#22c55e"/>
                </svg>
                <span style="font-size: 1.25rem; font-weight: 600; line-height: 1.4; color: #1a1a1a;">Enrollment forecasting and projections</span>
              </div>
              
              <div class="reports-feature-card" onclick="openPerformanceMetrics()" style="display: flex; align-items: flex-start; margin-bottom: 2rem; padding: 1.5rem; background: rgba(90, 91, 184, 0.05); border-radius: 12px; border-left: 4px solid #5a5bb8; cursor: pointer; transition: all 0.3s ease;">
                <svg width="64" height="64" fill="white" style="margin-right: 24px; color: #5a5bb8; flex-shrink: 0; margin-top: 4px;">
                  <rect x="2" y="2" width="16" height="16" rx="2" fill="none" stroke="white" stroke-width="1.5"/>
                  <path d="M6 6h8M6 10h6M6 14h4"/>
                  <circle cx="15" cy="7" r="3" fill="none" stroke="#22c55e" stroke-width="1.5"/>
                  <path d="M13.5 7l1 1 2-2" stroke="#22c55e" stroke-width="1.5" fill="none"/>
                  <rect x="4" y="16" width="2" height="2" fill="#f59e0b"/>
                  <rect x="7" y="15" width="2" height="3" fill="#22c55e"/>
                  <rect x="10" y="14" width="2" height="4" fill="#3b82f6"/>
                </svg>
                <span style="font-size: 1.25rem; font-weight: 600; line-height: 1.4; color: #1a1a1a;">Performance metrics and KPI tracking</span>
              </div>
              
              <div class="reports-feature-card" onclick="openCustomReportBuilder()" style="display: flex; align-items: flex-start; margin-bottom: 2rem; padding: 1.5rem; background: rgba(90, 91, 184, 0.05); border-radius: 12px; border-left: 4px solid #5a5bb8; cursor: pointer; transition: all 0.3s ease;">
                <svg width="64" height="64" fill="white" style="margin-right: 24px; color: #5a5bb8; flex-shrink: 0; margin-top: 4px;">
                  <rect x="2" y="3" width="16" height="14" rx="2" fill="none" stroke="white" stroke-width="1.5"/>
                  <path d="M2 7h16M6 3v4M10 3v4M14 3v4"/>
                  <rect x="4" y="9" width="3" height="2" rx="1" fill="#3b82f6" opacity="0.7"/>
                  <rect x="8" y="11" width="3" height="2" rx="1" fill="#22c55e" opacity="0.7"/>
                  <rect x="12" y="13" width="3" height="2" rx="1" fill="#f59e0b" opacity="0.7"/>
                  <path d="M16 2l2 2-2 2" stroke="#8b5cf6" stroke-width="1.5" fill="none"/>
                  <circle cx="16" cy="4" r="1" fill="#8b5cf6"/>
                </svg>
                <span style="font-size: 1.25rem; font-weight: 600; line-height: 1.4; color: #1a1a1a;">Custom report builder with drag-and-drop interface</span>
              </div>
            </div>
            
            <!-- Right Column -->
            <div>
              <div class="reports-feature-card" onclick="openRealtimeDashboard()" style="display: flex; align-items: flex-start; margin-bottom: 2rem; padding: 1.5rem; background: rgba(90, 91, 184, 0.05); border-radius: 12px; border-left: 4px solid #5a5bb8; cursor: pointer; transition: all 0.3s ease;">
                <svg width="64" height="64" fill="white" style="margin-right: 24px; color: #5a5bb8; flex-shrink: 0; margin-top: 4px;">
                  <rect x="2" y="2" width="16" height="12" rx="2" fill="none" stroke="white" stroke-width="1.5"/>
                  <path d="M2 6h16"/>
                  <circle cx="5" cy="4" r="1"/>
                  <circle cx="8" cy="4" r="1"/>
                  <circle cx="11" cy="4" r="1"/>
                  <path d="M4 8l3 4 3-2 3 2 3-4" stroke="#22c55e" stroke-width="2" fill="none"/>
                  <circle cx="4" cy="12" r="1.5" fill="#22c55e"/>
                  <circle cx="7" cy="10" r="1.5" fill="#3b82f6"/>
                  <circle cx="10" cy="12" r="1.5" fill="#f59e0b"/>
                  <circle cx="13" cy="8" r="1.5" fill="#ef4444"/>
                  <circle cx="16" cy="4" r="2" fill="#22c55e" opacity="0.3"/>
                  <text x="16" y="4" text-anchor="middle" dy="0.35em" font-size="6" fill="white">●</text>
                </svg>
                <span style="font-size: 1.25rem; font-weight: 600; line-height: 1.4; color: #1a1a1a;">Real-time dashboard with interactive charts</span>
              </div>
              
              <div class="reports-feature-card" onclick="openAutomatedReporting()" style="display: flex; align-items: flex-start; margin-bottom: 2rem; padding: 1.5rem; background: rgba(90, 91, 184, 0.05); border-radius: 12px; border-left: 4px solid #5a5bb8; cursor: pointer; transition: all 0.3s ease;">
                <svg width="64" height="64" fill="white" style="margin-right: 24px; color: #5a5bb8; flex-shrink: 0; margin-top: 4px;">
                  <rect x="2" y="2" width="12" height="16" rx="2" fill="none" stroke="white" stroke-width="1.5"/>
                  <path d="M6 6h4M6 9h4M6 12h2"/>
                  <circle cx="16" cy="6" r="2" fill="none" stroke="#22c55e" stroke-width="1.5"/>
                  <path d="M15 6l1 1 2-2" stroke="#22c55e" stroke-width="1" fill="none"/>
                  <path d="M14 10l2 2 2-2" stroke="#f59e0b" stroke-width="1.5" fill="none"/>
                  <circle cx="16" cy="12" r="1" fill="#f59e0b"/>
                  <path d="M14 14h4v2h-4z" fill="#3b82f6" opacity="0.7"/>
                  <circle cx="12" cy="18" r="1" fill="white"/>
                  <path d="M13 17l4-2v3l-4 2z" fill="#8b5cf6" opacity="0.8"/>
                </svg>
                <span style="font-size: 1.25rem; font-weight: 600; line-height: 1.4; color: #1a1a1a;">Automated report scheduling and delivery</span>
              </div>
              
              <div class="reports-feature-card" onclick="openComparativeAnalysis()" style="display: flex; align-items: flex-start; margin-bottom: 2rem; padding: 1.5rem; background: rgba(90, 91, 184, 0.05); border-radius: 12px; border-left: 4px solid #5a5bb8; cursor: pointer; transition: all 0.3s ease;">
                <svg width="64" height="64" fill="white" style="margin-right: 24px; color: #5a5bb8; flex-shrink: 0; margin-top: 4px;">
                  <circle cx="6" cy="6" r="4" fill="none" stroke="#3b82f6" stroke-width="1.5"/>
                  <circle cx="14" cy="6" r="4" fill="none" stroke="#22c55e" stroke-width="1.5"/>
                  <circle cx="10" cy="14" r="4" fill="none" stroke="#f59e0b" stroke-width="1.5"/>
                  <path d="M8.5 8.5L11.5 11.5M11.5 8.5L8.5 11.5" stroke="#8b5cf6" stroke-width="2"/>
                  <rect x="4" y="4" width="4" height="4" fill="none" stroke="#3b82f6" stroke-width="1"/>
                  <rect x="12" y="4" width="4" height="4" fill="none" stroke="#22c55e" stroke-width="1"/>
                  <rect x="8" y="12" width="4" height="4" fill="none" stroke="#f59e0b" stroke-width="1"/>
                  <path d="M6 6v2h2M14 6v2h-2M10 14v-2h2" stroke="white" stroke-width="1"/>
                </svg>
                <span style="font-size: 1.25rem; font-weight: 600; line-height: 1.4; color: #1a1a1a;">Comparative analysis with peer institutions</span>
              </div>
              
              <div class="reports-feature-card" onclick="openExportCapabilities()" style="display: flex; align-items: flex-start; margin-bottom: 2rem; padding: 1.5rem; background: rgba(90, 91, 184, 0.05); border-radius: 12px; border-left: 4px solid #5a5bb8; cursor: pointer; transition: all 0.3s ease;">
                <svg width="64" height="64" fill="white" style="margin-right: 24px; color: #5a5bb8; flex-shrink: 0; margin-top: 4px;">
                  <rect x="2" y="2" width="12" height="16" rx="1" fill="none" stroke="white" stroke-width="1.5"/>
                  <path d="M6 6h4M6 9h4M6 12h3"/>
                  <rect x="16" y="4" width="2" height="12" fill="#22c55e" opacity="0.7"/>
                  <rect x="15" y="6" width="4" height="8" fill="none" stroke="#22c55e" stroke-width="1"/>
                  <path d="M15 18l4-2v-2h-4z" fill="#3b82f6" opacity="0.8"/>
                  <circle cx="17" cy="2" r="1" fill="#f59e0b"/>
                  <path d="M16 3h2v1h-2z" fill="#ef4444"/>
                  <text x="8" y="16" font-family="monospace" font-size="3" fill="white">CSV</text>
                  <text x="17" y="8" font-family="monospace" font-size="3" fill="white" transform="rotate(90 17 8)">PDF</text>
                  <rect x="4" y="14" width="6" height="2" fill="#22c55e" opacity="0.3"/>
                </svg>
                <span style="font-size: 1.25rem; font-weight: 600; line-height: 1.4; color: #1a1a1a;">Export capabilities (PDF, Excel, CSV)</span>
              </div>
            </div>
          </div>
          
          <div class="coming-soon__showcase">
            <h3>Report Categories</h3>
            <div class="showcase-grid">
              <div class="showcase-item">
                <div class="showcase-item__icon">📈</div>
                <div class="showcase-item__content">
                  <h4>Admissions Analytics</h4>
                  <p>Track application volumes, conversion rates, and acceptance trends</p>
                  <div class="showcase-item__features">
                    <span class="feature-tag">Funnel Analysis</span>
                    <span class="feature-tag">Yield Prediction</span>
                    <span class="feature-tag">Geographic Mapping</span>
                  </div>
                </div>
              </div>
              
              <div class="showcase-item">
                <div class="showcase-item__icon">👥</div>
                <div class="showcase-item__content">
                  <h4>Student Demographics</h4>
                  <p>Analyze student population diversity and enrollment patterns</p>
                  <div class="showcase-item__features">
                    <span class="feature-tag">Diversity Metrics</span>
                    <span class="feature-tag">Retention Analysis</span>
                    <span class="feature-tag">Academic Performance</span>
                  </div>
                </div>
              </div>
              
              <div class="showcase-item">
                <div class="showcase-item__icon">💰</div>
                <div class="showcase-item__content">
                  <h4>Financial Performance</h4>
                  <p>Monitor tuition revenue, financial aid distribution, and ROI</p>
                  <div class="showcase-item__features">
                    <span class="feature-tag">Revenue Tracking</span>
                    <span class="feature-tag">Aid Distribution</span>
                    <span class="feature-tag">Cost Analysis</span>
                  </div>
                </div>
              </div>
              
              <div class="showcase-item">
                <div class="showcase-item__icon">🎓</div>
                <div class="showcase-item__content">
                  <h4>Program Analytics</h4>
                  <p>Evaluate program popularity, success rates, and outcomes</p>
                  <div class="showcase-item__features">
                    <span class="feature-tag">Program Popularity</span>
                    <span class="feature-tag">Graduation Rates</span>
                    <span class="feature-tag">Employment Outcomes</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="coming-soon__cta">
            <button class="btn btn--primary" onclick="requestDemo()">
              <svg width="16" height="16" fill="white">
                <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0zM12 16v6M9.5 14.5L5 19M14.5 14.5L19 19"/>
              </svg>
              Request Analytics Demo
            </button>
            <button class="btn btn--ghost" onclick="downloadSample()">
              <svg width="16" height="16" fill="white">
                <path d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"/>
              </svg>
              Download Sample Reports
            </button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="footer" role="contentinfo" aria-label="Site footer" style="background: linear-gradient(135deg, #5a5bb8, #6b6ce8); position: relative; overflow: hidden; color: white;">
    <div class="container footer__inner" style="position: relative; z-index: 2; color: white;">
      <div class="footer__grid">
        <!-- Brand section -->
        <div class="footer__brand">
          <div class="footer__logo" onclick="scrollToTop()" style="cursor: pointer;" title="Back to top">
            <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
              <defs>
                <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#373896"/>
                  <stop offset="100%" style="stop-color:#6b6ce8"/>
                </linearGradient>
              </defs>
              <circle cx="20" cy="20" r="18" fill="url(#logoGradient)" stroke="white" stroke-width="2"/>
              <path d="M15 18l5-5 5 5M20 13v14" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="footer__brand-text">
            <div class="footer__brand-name" style="color: white;">Flow</div>
            <div class="footer__tagline" style="color: white;">Streamlining Education Access</div>
          </div>
        </div>

        <!-- Links -->
        <div class="footer__section">
          <h3 class="footer__title" style="color: black;">For Institutions</h3>
          <ul class="footer__links">
            <li><a href="/institutions/">
              <svg width="16" height="16" fill="white" style="display: inline-block; margin-right: 8px; vertical-align: middle;">
                <rect x="2" y="3" width="12" height="10" rx="1" fill="none" stroke="white" stroke-width="1.2"/>
                <path d="M4 6h8M4 8h6M4 10h4"/>
                <circle cx="11" cy="5" r="2" fill="#22c55e" opacity="0.8"/>
                <path d="M10 5l0.7 0.7 1.3-1.4" stroke="white" stroke-width="0.8" fill="none"/>
              </svg>
              <span style="color: white;">Dashboard</span></a></li>
            <li><a href="/institutions/programs.html">
              <svg width="16" height="16" fill="white" style="display: inline-block; margin-right: 8px; vertical-align: middle;">
                <rect x="2" y="2" width="12" height="12" rx="1" fill="none" stroke="white" stroke-width="1.2"/>
                <path d="M5 5h6M5 7h4M5 9h5"/>
                <circle cx="11" cy="6" r="1.5" fill="#22c55e" opacity="0.8"/>
                <path d="M10.3 6l0.4 0.4 0.6-0.8" stroke="white" stroke-width="0.8" fill="none"/>
              </svg>
              <span style="color: white;">Manage Programs</span></a></li>
            <li><a href="/institutions/admissions.html">
              <svg width="16" height="16" fill="white" style="display: inline-block; margin-right: 8px; vertical-align: middle;">
                <rect x="2" y="3" width="8" height="10" rx="1" fill="none" stroke="white" stroke-width="1.2"/>
                <rect x="12" y="3" width="2" height="10" rx="0.5" fill="none" stroke="white" stroke-width="1.2"/>
                <path d="M4 6h4M4 8h3M4 10h4"/>
                <circle cx="8" cy="6" r="1" fill="#22c55e"/>
                <path d="M7.5 6l0.3 0.3 0.5-0.6" stroke="white" stroke-width="0.6" fill="none"/>
              </svg>
              <span style="color: white;">Admissions</span></a></li>
            <li><a href="/institutions/reports.html">
              <svg width="16" height="16" fill="white" style="display: inline-block; margin-right: 8px; vertical-align: middle;">
                <rect x="2" y="3" width="12" height="10" rx="1" fill="none" stroke="white" stroke-width="1.2"/>
                <path d="M2 7h12"/>
                <rect x="4" y="9" width="1.5" height="2" fill="#3b82f6" opacity="0.8" rx="0.3"/>
                <rect x="6" y="10" width="1.5" height="1" fill="#22c55e" opacity="0.8" rx="0.3"/>
                <rect x="8" y="8" width="1.5" height="3" fill="#f59e0b" opacity="0.8" rx="0.3"/>
                <rect x="10" y="11" width="1.5" height="0.5" fill="#ef4444" opacity="0.8" rx="0.3"/>
              </svg>
              <span style="color: white;">Reports</span></a></li>
          </ul>
        </div>

        <div class="footer__section">
          <h3 class="footer__title" style="color: black;">Support</h3>
          <ul class="footer__links">
            <li><a href="/institutions/help.html">
              <svg width="16" height="16" fill="white" style="display: inline-block; margin-right: 8px; vertical-align: middle;">
                <circle cx="8" cy="8" r="6" fill="none" stroke="white" stroke-width="1.2"/>
                <path d="M8 6v2M8 10h.01"/>
                <circle cx="8" cy="4" r="1" fill="#3b82f6"/>
                <path d="M4 12l8-8M12 12l-8-8" stroke="#22c55e" stroke-width="0.8" opacity="0.5"/>
              </svg>
              <span style="color: white;">Help Center</span></a></li>
            <li><a href="/contact/">
              <svg width="16" height="16" fill="white" style="display: inline-block; margin-right: 8px; vertical-align: middle;">
                <path d="M2 3h12l-6 5-6-5zM2 3v10h12V3" fill="none" stroke="white" stroke-width="1.2"/>
                <circle cx="12" cy="4" r="1.5" fill="#22c55e"/>
                <path d="M11.3 4l0.4 0.4 0.6-0.8" stroke="white" stroke-width="0.6" fill="none"/>
              </svg>
              <span style="color: white;">Contact</span></a></li>
            <li><a href="/legal/privacy.html">
              <svg width="16" height="16" fill="white" style="display: inline-block; margin-right: 8px; vertical-align: middle;">
                <rect x="3" y="2" width="10" height="12" rx="1" fill="none" stroke="white" stroke-width="1.2"/>
                <path d="M8 6v4M6 8h4"/>
                <circle cx="8" cy="5" r="1" fill="#f59e0b"/>
                <rect x="5" y="9" width="6" height="1" fill="#ef4444" opacity="0.6"/>
              </svg>
              <span style="color: white;">Privacy</span></a></li>
            <li><a href="/legal/terms.html">
              <svg width="16" height="16" fill="white" style="display: inline-block; margin-right: 8px; vertical-align: middle;">
                <rect x="2" y="2" width="12" height="12" rx="1" fill="none" stroke="white" stroke-width="1.2"/>
                <path d="M5 5h6M5 7h5M5 9h4M5 11h6"/>
                <circle cx="12" cy="4" r="1" fill="#8b5cf6"/>
                <rect x="4" y="6" width="1" height="6" fill="#3b82f6" opacity="0.3"/>
              </svg>
              <span style="color: white;">Terms</span></a></li>
          </ul>
        </div>

        <div class="footer__section">
          <h3 class="footer__title" style="color: black;">Connect</h3>
          <ul class="footer__links">
            <li><a href="/institutions/messages.html">
              <svg width="16" height="16" fill="white" style="display: inline-block; margin-right: 8px; vertical-align: middle;">
                <rect x="2" y="4" width="12" height="8" rx="1" fill="none" stroke="white" stroke-width="1.2"/>
                <path d="M2 6l5 3 2-1 5-2"/>
                <circle cx="12" cy="5" r="1.5" fill="#ef4444"/>
                <text x="12" y="6" text-anchor="middle" font-size="2.5" fill="white" font-weight="bold">2</text>
              </svg>
              <span style="color: white;">Messages</span></a></li>
            <li><a href="/community/">
              <svg width="16" height="16" fill="white" style="display: inline-block; margin-right: 8px; vertical-align: middle;">
                <circle cx="5" cy="6" r="2" fill="none" stroke="white" stroke-width="1.2"/>
                <circle cx="11" cy="6" r="2" fill="none" stroke="white" stroke-width="1.2"/>
                <circle cx="8" cy="11" r="2" fill="none" stroke="white" stroke-width="1.2"/>
                <circle cx="5" cy="6" r="1" fill="#22c55e"/>
                <circle cx="11" cy="6" r="1" fill="#3b82f6"/>
                <circle cx="8" cy="11" r="1" fill="#f59e0b"/>
                <path d="M7 8l2 1M9 8l-2 1" stroke="white" stroke-width="0.8"/>
              </svg>
              <span style="color: white;">Community</span></a></li>
            <li><a href="/blog/">
              <svg width="16" height="16" fill="white" style="display: inline-block; margin-right: 8px; vertical-align: middle;">
                <rect x="2" y="2" width="12" height="12" rx="1" fill="none" stroke="white" stroke-width="1.2"/>
                <path d="M5 5h6M5 7h4M5 9h5"/>
                <circle cx="12" cy="4" r="1.5" fill="#22c55e"/>
                <path d="M11.3 4l0.4 0.4 0.6-0.8" stroke="white" stroke-width="0.6" fill="none"/>
                <rect x="4" y="11" width="8" height="1" fill="#8b5cf6" opacity="0.6"/>
              </svg>
              <span style="color: white;">Updates</span></a></li>
          </ul>
        </div>
      </div>

      <div class="footer__bottom">
        <div class="footer__copyright" style="color: white;">
          © 2024 Flow Education Platform. All rights reserved.
        </div>
        <div class="footer__status">
          <span class="footer__status-dot"></span>
          <span style="color: white;">All systems operational</span>
        </div>
      </div>
    </div>
  </footer>

  <!-- JavaScript -->
  <script src="/assets/js/auth.js"></script>
  <script src="/assets/js/auth-guards.js"></script>
  <script src="/assets/js/institutions.js"></script>
  
  <script>
    console.log('📊 Reports page JavaScript loading...');

    // Header Button JavaScript Functionality

    // Toggle Dropdown Function
    function toggleDropdown(dropdownId, triggerId) {
      const dropdown = document.getElementById(dropdownId);
      const trigger = document.getElementById(triggerId);
      const isOpen = dropdown.getAttribute('aria-hidden') === 'false';

      // Close all dropdowns first
      closeAllDropdowns();

      if (!isOpen) {
        dropdown.setAttribute('aria-hidden', 'false');
        dropdown.style.display = 'block';
        trigger.setAttribute('aria-expanded', 'true');
      }
    }

    // Close all dropdowns
    function closeAllDropdowns() {
      const dropdowns = ['searchDropdown', 'notificationsDropdown', 'messagesDropdown', 'profileDropdown'];
      const triggers = ['searchTrigger', 'notificationsTrigger', 'messagesTrigger', 'profileTrigger'];

      dropdowns.forEach((id, index) => {
        const dropdown = document.getElementById(id);
        const trigger = document.getElementById(triggers[index]);
        if (dropdown && trigger) {
          dropdown.setAttribute('aria-hidden', 'true');
          dropdown.style.display = 'none';
          trigger.setAttribute('aria-expanded', 'false');
        }
      });
    }

    // Search functionality
    function handleSearch(query) {
      console.log('Searching for:', query);
      const suggestions = document.getElementById('searchSuggestions');

      if (query.length > 0) {
        const mockResults = [
          'Enrollment Reports',
          'Analytics Dashboard',
          'Performance Metrics',
          'Financial Reports',
          'Academic Reports'
        ].filter(item => item.toLowerCase().includes(query.toLowerCase()));

        suggestions.innerHTML = mockResults.map(result =>
          `<div class="suggestion-item" onclick="selectSuggestion('${result}')">${result}</div>`
        ).join('');
      } else {
        suggestions.innerHTML = '';
      }
    }

    function selectSuggestion(suggestion) {
      document.getElementById('globalSearch').value = suggestion;
      closeAllDropdowns();
      showToast(`Searching for: ${suggestion}`, 'info', 3000);
    }

    // Notification functions
    function markAllNotificationsRead() {
      const notifications = document.querySelectorAll('.notification-item--unread');
      notifications.forEach(notification => {
        notification.classList.remove('notification-item--unread');
      });
      document.getElementById('notificationsBadge').textContent = '0';
      showToast('All notifications marked as read', 'success', 3000);
    }

    function dismissNotification(notificationId) {
      const notification = document.querySelector(`[data-id="${notificationId}"]`);
      if (notification) {
        notification.style.opacity = '0';
        setTimeout(() => notification.remove(), 300);
      }
    }

    function openNotificationSettings() {
      showToast('Notification settings would open here', 'info', 3000);
    }

    // Message functions
    function composeMessage() {
      const modal = `
        <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 1000;" onclick="if(event.target === this) closeComposeModal()">
          <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 500px; width: 90%;">
            <h3 style="margin: 0 0 1rem 0;">Compose Message</h3>
            <form onsubmit="sendMessage(event)">
              <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem;">To:</label>
                <input type="text" name="recipient" required style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;" placeholder="Enter recipient">
              </div>
              <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem;">Subject:</label>
                <input type="text" name="subject" required style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;" placeholder="Enter subject">
              </div>
              <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem;">Message:</label>
                <textarea name="message" required style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;" rows="4" placeholder="Enter your message"></textarea>
              </div>
              <div style="display: flex; gap: 1rem;">
                <button type="submit" style="flex: 1; background: #5a5bb8; color: white; border: none; padding: 0.75rem; border-radius: 4px; cursor: pointer;">Send</button>
                <button type="button" onclick="closeComposeModal()" style="flex: 1; background: #6b7280; color: white; border: none; padding: 0.75rem; border-radius: 4px; cursor: pointer;">Cancel</button>
              </div>
            </form>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', modal);
    }

    function closeComposeModal() {
      const modal = document.querySelector('div[style*="position: fixed"]');
      if (modal) modal.remove();
    }

    function sendMessage(event) {
      event.preventDefault();
      showToast('Message sent successfully!', 'success', 3000);
      closeComposeModal();
    }

    function markMessageRead(messageId) {
      showToast(`Opening message ${messageId}`, 'info', 3000);
      closeAllDropdowns();
    }

    // Profile functions
    function viewFullProfile() {
      showToast('Opening full profile...', 'info', 3000);
    }

    function editProfile() {
      showToast('Opening profile editor...', 'info', 3000);
    }

    function logout() {
      if (confirm('Are you sure you want to log out?')) {
        showToast('Logging out...', 'info', 3000);
        setTimeout(() => {
          window.location.href = '/';
        }, 1000);
      }
    }

    // Sign out function (for compatibility)
    function signOut() {
      logout();
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', function() {
      // Search trigger
      const searchTrigger = document.getElementById('searchTrigger');
      if (searchTrigger) {
        searchTrigger.addEventListener('click', () => toggleDropdown('searchDropdown', 'searchTrigger'));
      }

      // Notifications trigger
      const notificationsTrigger = document.getElementById('notificationsTrigger');
      if (notificationsTrigger) {
        notificationsTrigger.addEventListener('click', () => toggleDropdown('notificationsDropdown', 'notificationsTrigger'));
      }

      // Messages trigger
      const messagesTrigger = document.getElementById('messagesTrigger');
      if (messagesTrigger) {
        messagesTrigger.addEventListener('click', () => toggleDropdown('messagesDropdown', 'messagesTrigger'));
      }

      // Profile trigger
      const profileTrigger = document.getElementById('profileTrigger');
      if (profileTrigger) {
        profileTrigger.addEventListener('click', () => toggleDropdown('profileDropdown', 'profileTrigger'));
      }

      // Search input
      const globalSearch = document.getElementById('globalSearch');
      if (globalSearch) {
        globalSearch.addEventListener('input', (e) => handleSearch(e.target.value));
      }

      // Mobile menu toggle
      const mobileMenuToggle = document.getElementById('mobileMenuToggle');
      const navOverlay = document.getElementById('navOverlay');
      if (mobileMenuToggle && navOverlay) {
        mobileMenuToggle.addEventListener('click', () => {
          const isOpen = navOverlay.getAttribute('aria-hidden') === 'false';
          navOverlay.setAttribute('aria-hidden', !isOpen);
          navOverlay.style.display = isOpen ? 'none' : 'block';
          mobileMenuToggle.setAttribute('aria-expanded', !isOpen);
        });
      }

      // Click outside to close dropdowns
      document.addEventListener('click', function(event) {
        const isDropdownTrigger = event.target.closest('.header-search__trigger, .header-notifications__trigger, .header-messages__trigger, .header-profile__trigger');
        const isDropdownContent = event.target.closest('.header-search__dropdown, .header-notifications__dropdown, .header-messages__dropdown, .header-profile__dropdown');

        if (!isDropdownTrigger && !isDropdownContent) {
          closeAllDropdowns();
        }
      });
    });

    // Reports specific functions
    function requestDemo() {
      // Show loading state
      const button = event.target.closest('button');
      const originalText = button.innerHTML;
      button.disabled = true;
      button.innerHTML = '<svg width="16" height="16" fill="white" class="animate-spin"><path d="M8 2a6 6 0 016 6h2a8 8 0 10-8 8v-2a6 6 0 01-6-6 6 6 0 016-6z"/></svg> Submitting...';
      
      // Simulate API request
      setTimeout(() => {
        showToast('🎯 Analytics demo request submitted successfully!<br>📧 Our data specialists will contact you within 24 hours<br>📊 Prepare to see powerful insights from your data', 'success', 6000);
        
        // Create demo scheduling modal simulation
        setTimeout(() => {
          if (confirm('Would you like to schedule your demo for a specific time? Click OK to open our scheduling system.')) {
            showToast('📅 Scheduling system would open here in the full implementation', 'info', 4000);
          }
        }, 2000);
        
        // Reset button
        button.disabled = false;
        button.innerHTML = originalText;
      }, 2000);
    }
    
    function downloadSample() {
      // Show loading state
      const button = event.target.closest('button');
      const originalText = button.innerHTML;
      button.disabled = true;
      button.innerHTML = '<svg width="16" height="16" fill="white" class="animate-spin"><path d="M8 2a6 6 0 016 6h2a8 8 0 10-8 8v-2a6 6 0 01-6-6 6 6 0 016-6z"/></svg> Preparing...';
      
      // Simulate report generation
      setTimeout(() => {
        showToast('📊 Sample Reports Package Ready!<br>📁 Download includes: Analytics Overview, Enrollment Trends, Performance Metrics<br>💾 Files saved to your Downloads folder', 'success', 6000);
        
        // Simulate actual file download
        const sampleData = createSampleReportData();
        downloadFile('Flow_Sample_Reports_Package.json', JSON.stringify(sampleData, null, 2));
        
        // Show additional options
        setTimeout(() => {
          showToast('💡 Want to see these reports with your actual data? Request a personalized demo!', 'info', 4000);
        }, 3000);
        
        // Reset button
        button.disabled = false;
        button.innerHTML = originalText;
      }, 3000);
    }
    
    // Helper function to create sample report data
    function createSampleReportData() {
      return {
        reportPackage: "Flow Analytics Sample Reports",
        generatedDate: new Date().toISOString(),
        institution: "Sample University",
        reports: {
          enrollmentTrends: {
            totalApplications: 15420,
            acceptanceRate: "68%",
            yieldRate: "42%",
            trending: "up",
            quarterlyGrowth: "12%"
          },
          performanceMetrics: {
            avgResponseTime: "2.3 days",
            studentSatisfaction: "94%",
            completionRate: "87%",
            retentionRate: "91%"
          },
          demographicAnalysis: {
            internationalStudents: "23%",
            diversityIndex: "High",
            geographicSpread: "45 countries",
            ageDistribution: "18-24: 78%, 25+: 22%"
          }
        },
        insights: [
          "Application volume increased 12% this quarter",
          "International applications up 18%",
          "STEM programs showing highest demand",
          "Mobile applications account for 67% of submissions"
        ]
      };
    }
    
    // Helper function to download file
    function downloadFile(filename, content) {
      const blob = new Blob([content], { type: 'application/json' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);
    }
    
    // Additional helper functions for enhanced button functionality
    function submitDemoRequest(event) {
      event.preventDefault();
      const formData = new FormData(event.target);
      const data = Object.fromEntries(formData);
      
      // Simulate form submission
      showToast('⏳ Submitting your demo request...', 'info', 2000);
      
      setTimeout(() => {
        showToast(`✅ Demo request submitted successfully!<br>📧 Confirmation sent to: ${data.email}<br>📅 Our team will contact you within 24 hours`, 'success', 6000);
        closeDemoModal();
        
        // Auto-fill downloaded sample data with their info
        setTimeout(() => {
          downloadPersonalizedSample(data);
        }, 2000);
      }, 1500);
    }
    
    function closeDemoModal() {
      const modal = document.querySelector('div[style*="position: fixed"]');
      if (modal) {
        modal.remove();
      }
    }
    
    function downloadPersonalizedSample(userData) {
      const personalizedData = {
        institutionProfile: {
          name: userData.institution || "Sample University",
          contact: userData.name || "Institution Admin",
          email: userData.email || "demo@institution.edu",
          requestDate: new Date().toISOString(),
          interestedAreas: userData.interests || "General analytics overview"
        },
        customizedReports: "Generated based on your specific interests and institution profile"
      };
      
      downloadFile('Flow_Personalized_Demo_Package.json', JSON.stringify(personalizedData, null, 2));
      showToast('🎁 Personalized demo package created with your information!', 'success', 4000);
    }
    
    function createTextSummary(reports) {
      return `
FLOW ANALYTICS - COMPREHENSIVE REPORT SUMMARY
Generated: ${new Date().toLocaleString()}
Institution: Sample University

EXECUTIVE SUMMARY
================
Total Applications: ${reports.executive_summary.keyMetrics.totalApplications.toLocaleString()}
Acceptance Rate: ${reports.executive_summary.keyMetrics.acceptanceRate}
Yield Rate: ${reports.executive_summary.keyMetrics.yieldRate}
Processing Time: ${reports.executive_summary.keyMetrics.avgProcessingTime}
Satisfaction Score: ${reports.executive_summary.keyMetrics.studentSatisfaction}

KEY HIGHLIGHTS
==============
${reports.executive_summary.highlights.map(h => `• ${h}`).join('\n')}

ENROLLMENT ANALYSIS
==================
Domestic Students: ${reports.enrollment_analysis.demographics.domestic}
International Students: ${reports.enrollment_analysis.demographics.international}
Undergraduate: ${reports.enrollment_analysis.demographics.undergrad}
Graduate: ${reports.enrollment_analysis.demographics.graduate}

TOP PROGRAMS BY APPLICATIONS
============================
${reports.enrollment_analysis.topPrograms.map(p => 
  `• ${p.name}: ${p.applications} applications (${p.acceptance} acceptance rate)`
).join('\n')}

PERFORMANCE METRICS
==================
Application Completion: ${reports.performance_dashboard.kpis.applicationCompletionRate}
Decision Time: ${reports.performance_dashboard.kpis.averageDecisionTime}
System Uptime: ${reports.performance_dashboard.kpis.systemUptime}
User Satisfaction: ${reports.performance_dashboard.kpis.userSatisfactionScore}/5.0

FORECASTING
===========
Next Quarter: ${reports.enrollment_analysis.forecasting.nextQuarter}
Seasonal Pattern: ${reports.performance_dashboard.trends.seasonalPatterns}

This is a sample report. Contact Flow for personalized analytics with your actual data.
Contact: demo@flow.edu | Schedule Demo: https://flow.edu/demo
      `;
    }
    
    function createCSVSample() {
      return `Date,Applications,Acceptances,Enrollments,Program,Country
2024-01-15,234,156,67,Computer Science,USA
2024-01-15,189,134,89,Business,USA
2024-01-15,156,78,34,Engineering,Canada
2024-01-15,134,89,23,Pre-Med,Mexico
2024-01-16,267,178,78,Computer Science,USA
2024-01-16,201,145,92,Business,USA
2024-01-16,178,89,45,Engineering,Canada
2024-01-16,145,92,34,Pre-Med,UK
2024-01-17,289,195,84,Computer Science,Germany
2024-01-17,234,167,103,Business,USA
2024-01-17,198,99,52,Engineering,Canada
2024-01-17,167,103,41,Pre-Med,France
2024-01-18,312,208,89,Computer Science,USA
2024-01-18,245,172,108,Business,India
2024-01-18,208,104,56,Engineering,Japan
2024-01-18,172,108,45,Pre-Med,USA`;
    }
    
    // Replace the original functions with working versions
    function requestDemo() {
      // Create professional demo request form
      const formHtml = `
        <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center; z-index: 1000;" onclick="if(event.target === this) closeDemoModal()">
          <div style="background: white; padding: 2.5rem; border-radius: 16px; max-width: 550px; width: 90%; max-height: 85vh; overflow-y: auto; box-shadow: 0 25px 50px rgba(0,0,0,0.25);">
            <div style="text-align: center; margin-bottom: 2rem;">
              <h2 style="margin: 0 0 0.5rem 0; color: #5a5bb8; font-size: 1.5rem;">Request Analytics Demo</h2>
              <p style="color: #6b7280; margin: 0;">Get a personalized demonstration of Flow's powerful analytics platform</p>
            </div>
            <form onsubmit="submitDemoRequest(event)">
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                <div>
                  <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Institution Name *</label>
                  <input type="text" name="institution" required style="width: 100%; padding: 0.875rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 0.95rem;" placeholder="University of Excellence">
                </div>
                <div>
                  <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Your Title</label>
                  <input type="text" name="title" style="width: 100%; padding: 0.875rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 0.95rem;" placeholder="Director of Admissions">
                </div>
              </div>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                <div>
                  <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Your Name *</label>
                  <input type="text" name="name" required style="width: 100%; padding: 0.875rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 0.95rem;" placeholder="John Smith">
                </div>
                <div>
                  <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Phone Number</label>
                  <input type="tel" name="phone" style="width: 100%; padding: 0.875rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 0.95rem;" placeholder="+1 (555) 123-4567">
                </div>
              </div>
              <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Email Address *</label>
                <input type="email" name="email" required style="width: 100%; padding: 0.875rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 0.95rem;" placeholder="john.smith@university.edu">
              </div>
              <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Preferred Demo Date/Time</label>
                <input type="datetime-local" name="preferred_time" style="width: 100%; padding: 0.875rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 0.95rem;">
              </div>
              <div style="margin-bottom: 2rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Areas of Interest</label>
                <textarea name="interests" rows="3" style="width: 100%; padding: 0.875rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 0.95rem; resize: vertical;" placeholder="e.g., Enrollment forecasting, Application analytics, Performance metrics, Comparative analysis..."></textarea>
              </div>
              <div style="display: flex; gap: 1rem;">
                <button type="submit" style="flex: 1; background: linear-gradient(135deg, #5a5bb8, #6b6ce8); color: white; border: none; padding: 1rem 1.5rem; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1rem; transition: transform 0.2s;">
                  🚀 Request Demo
                </button>
                <button type="button" onclick="closeDemoModal()" style="flex: 0.5; background: #6b7280; color: white; border: none; padding: 1rem; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1rem;">
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', formHtml);
      showToast('📋 Please complete the form to schedule your personalized analytics demonstration', 'info', 4000);
    }
    
    function downloadSample() {
      showToast('📊 Generating comprehensive sample reports package...', 'info', 2000);
      
      setTimeout(() => {
        // Generate comprehensive sample reports with actual data
        const reports = {
          executive_summary: {
            reportType: "Executive Summary",
            period: "Q4 2024",
            keyMetrics: {
              totalApplications: 18750,
              acceptanceRate: "67%",
              yieldRate: "43%",
              avgProcessingTime: "2.1 days",
              studentSatisfaction: "96%"
            },
            highlights: [
              "Applications increased 15% YoY",
              "International applications up 22%",
              "STEM programs showing highest demand",
              "Mobile submissions account for 71%"
            ]
          },
          enrollment_analysis: {
            reportType: "Enrollment Trends Analysis",
            demographics: {
              domestic: "77%",
              international: "23%",
              undergrad: "82%",
              graduate: "18%"
            },
            topPrograms: [
              { name: "Computer Science", applications: 2840, acceptance: "52%" },
              { name: "Business Administration", applications: 2156, acceptance: "71%" },
              { name: "Engineering", applications: 1923, acceptance: "58%" },
              { name: "Pre-Med", applications: 1645, acceptance: "41%" }
            ],
            forecasting: {
              nextQuarter: "+8% projected growth",
              riskFactors: ["Economic uncertainty", "Competition increase"],
              opportunities: ["New program launches", "Enhanced digital experience"]
            }
          },
          performance_dashboard: {
            reportType: "Performance Metrics Dashboard",
            kpis: {
              applicationCompletionRate: "89%",
              averageDecisionTime: "2.1 days",
              appealSuccessRate: "12%",
              systemUptime: "99.7%",
              userSatisfactionScore: 4.6
            },
            trends: {
              weeklyApplications: [245, 312, 298, 367, 334, 289, 356],
              monthlyAcceptances: [1240, 1567, 1834, 2156],
              seasonalPatterns: "Peak: March-May, Low: July-August"
            }
          }
        };
        
        // Download multiple files
        Object.keys(reports).forEach(reportName => {
          downloadFile(`Flow_${reportName}_Report.json`, JSON.stringify(reports[reportName], null, 2));
        });
        
        // Create a comprehensive text summary
        const textSummary = createTextSummary(reports);
        downloadFile('Flow_Analytics_Summary.txt', textSummary);
        
        // Create CSV sample
        const csvData = createCSVSample();
        downloadFile('Flow_Sample_Data.csv', csvData);
        
        showToast('✅ Sample reports downloaded successfully!<br>📁 5 files downloaded: JSON reports, text summary, and CSV data<br>💡 Ready to see your actual data? Request a personalized demo!', 'success', 6000);
        
        setTimeout(() => {
          if (confirm('📧 Would you like us to email you additional resources and implementation guides?')) {
            showToast('📬 Resource request submitted! You\'ll receive comprehensive guides within 1 hour.', 'success', 4000);
          }
        }, 3000);
      }, 1500);
    }
    
    // Scroll to top function - make it globally accessible
    function scrollToTop() {
      try {
        window.scrollTo({ top: 0, behavior: 'smooth' });
        console.log('Scrolled to top');
      } catch (error) {
        // Fallback for older browsers
        window.scrollTo(0, 0);
        console.log('Scrolled to top (fallback)');
      }
    }
    
    // Make functions globally accessible
    window.scrollToTop = scrollToTop;
    window.requestDemo = requestDemo;
    window.downloadSample = downloadSample;
    
    // Ensure showToast function exists, provide fallback if not
    if (typeof showToast === 'undefined') {
      window.showToast = function(message, type, duration) {
        console.log(`Toast ${type}: ${message}`);
        alert(message.replace(/<br>/g, '\n').replace(/<[^>]*>/g, ''));
      };
    }
    
    console.log('Reports page functions loaded successfully');

    // Advanced Reports Feature Functions

    // 1. Application Trends and Statistical Analysis
    let applicationTrendsData = null;
    let trendsCharts = {};
    let trendsFilters = {
      dateRange: 'last12months',
      programs: 'all',
      demographics: 'all',
      region: 'all'
    };

    function openApplicationTrends() {
      showToast('📊 Loading Application Trends Analytics...', 'info', 2000);

      setTimeout(() => {
        applicationTrendsData = generateApplicationTrendsData();
        const modalHtml = createApplicationTrendsModal(applicationTrendsData);
        document.body.insertAdjacentHTML('beforeend', modalHtml);

        // Initialize charts and functionality
        setTimeout(() => {
          initializeApplicationTrendsCharts(applicationTrendsData);
          setupRealTimeUpdates();
          updateLastRefreshTime();
          setupTrendsInteractivity();
        }, 100);
      }, 1000);
    }

    function generateApplicationTrendsData() {
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      const currentYear = new Date().getFullYear();

      return {
        yearOverYear: {
          [currentYear]: [1240, 1567, 2834, 3156, 2847, 1923, 1456, 2234, 3567, 3234, 2876, 2145],
          [currentYear - 1]: [1156, 1423, 2567, 2934, 2634, 1789, 1323, 2089, 3234, 2987, 2634, 1934]
        },
        demographics: {
          domestic: 67,
          international: 33,
          undergraduate: 78,
          graduate: 22
        },
        programTrends: [
          { name: 'Computer Science', applications: 3247, change: '+18%', trend: 'up' },
          { name: 'Business Administration', applications: 2856, change: '+12%', trend: 'up' },
          { name: 'Engineering', applications: 2134, change: '-3%', trend: 'down' },
          { name: 'Medicine', applications: 1987, change: '+25%', trend: 'up' },
          { name: 'Liberal Arts', applications: 1654, change: '+8%', trend: 'up' }
        ],
        geographicData: [
          { region: 'North America', applications: 8976, percentage: 45 },
          { region: 'Europe', applications: 4321, percentage: 22 },
          { region: 'Asia', applications: 3456, percentage: 17 },
          { region: 'Africa', applications: 2234, percentage: 11 },
          { region: 'Other', applications: 1013, percentage: 5 }
        ],
        conversionRates: {
          applicationToAccepted: 68,
          acceptedToEnrolled: 42,
          inquiryToApplication: 23
        }
      };
    }

    function createApplicationTrendsModal(data) {
      const currentYear = new Date().getFullYear();
      return `
        <div id="applicationTrendsModal" data-fullscreen="false" style="position: fixed; top: 0; left: 0; width: 95vw; height: 90vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;">
          <div style="background: white; width: 95vw; height: 90vh; border-radius: 16px; overflow: hidden; display: flex; flex-direction: column;">
            <div style="background: linear-gradient(135deg, #5a5bb8, #6b6ce8); color: white; padding: 1.5rem; display: flex; justify-content: between; align-items: center;">
              <div style="display: flex; align-items: center; gap: 1rem;">
                <div>
                  <h2 style="margin: 0; font-size: 1.5rem;">📊 Application Trends & Statistical Analysis</h2>
                  <div style="display: flex; align-items: center; gap: 1rem; margin-top: 0.5rem;">
                    <span id="connectionStatus" style="font-size: 0.875rem; color: #10b981;">🟢 Live</span>
                    <span id="lastRefreshTime" style="font-size: 0.875rem; color: rgba(255,255,255,0.8);">Last updated: --:--:--</span>
                    <span id="currentTime" style="font-size: 0.875rem; color: rgba(255,255,255,0.8);"></span>
                  </div>
                </div>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                  <button onclick="refreshTrendsData()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                    🔄 Refresh
                  </button>
                  <button onclick="toggleAutoRefresh()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">
                    ▶️ Auto Refresh
                  </button>
                  <button onclick="toggleTrendsFullscreen()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">
                    🖥️ Fullscreen
                  </button>
                </div>
              </div>
              <button onclick="closeModal('applicationTrendsModal')" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">✕ Close</button>
            </div>

            <!-- Advanced Filters -->
            <div style="background: #f8fafc; border-bottom: 1px solid #e2e8f0; padding: 1rem 2rem;">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; align-items: end;">
                <div>
                  <label style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem; font-weight: 500; color: #374151;">Date Range</label>
                  <select id="trendsDateRange" onchange="updateTrendsFilter('dateRange', this.value)" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.875rem;">
                    <option value="last3months">Last 3 Months</option>
                    <option value="last6months">Last 6 Months</option>
                    <option value="last12months" selected>Last 12 Months</option>
                    <option value="last2years">Last 2 Years</option>
                    <option value="custom">Custom Range</option>
                  </select>
                </div>
                <div>
                  <label style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem; font-weight: 500; color: #374151;">Program Filter</label>
                  <select id="trendsPrograms" onchange="updateTrendsFilter('programs', this.value)" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.875rem;">
                    <option value="all" selected>All Programs</option>
                    <option value="computer-science">Computer Science</option>
                    <option value="business">Business Administration</option>
                    <option value="engineering">Engineering</option>
                    <option value="medicine">Medicine</option>
                    <option value="arts">Liberal Arts</option>
                  </select>
                </div>
                <div>
                  <label style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem; font-weight: 500; color: #374151;">Demographics</label>
                  <select id="trendsDemographics" onchange="updateTrendsFilter('demographics', this.value)" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.875rem;">
                    <option value="all" selected>All Students</option>
                    <option value="domestic">Domestic Only</option>
                    <option value="international">International Only</option>
                    <option value="undergraduate">Undergraduate</option>
                    <option value="graduate">Graduate</option>
                  </select>
                </div>
                <div>
                  <label style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem; font-weight: 500; color: #374151;">Region</label>
                  <select id="trendsRegion" onchange="updateTrendsFilter('region', this.value)" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.875rem;">
                    <option value="all" selected>All Regions</option>
                    <option value="north-america">North America</option>
                    <option value="europe">Europe</option>
                    <option value="asia">Asia</option>
                    <option value="africa">Africa</option>
                    <option value="other">Other</option>
                  </select>
                </div>
                <div>
                  <button onclick="resetTrendsFilters()" style="background: #6b7280; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; width: 100%;">Reset Filters</button>
                </div>
              </div>
            </div>

            <div style="flex: 1; overflow-y: auto; padding: 2rem;">

              <!-- Key Metrics Row -->
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                <div style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; padding: 1.5rem; border-radius: 12px;">
                  <div style="font-size: 2rem; font-weight: bold;">${data.yearOverYear[currentYear].reduce((a,b) => a+b, 0).toLocaleString()}</div>
                  <div style="opacity: 0.9;">Total Applications ${currentYear}</div>
                  <div style="font-size: 0.9rem; margin-top: 0.5rem;">+15% from last year</div>
                </div>
                <div style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 1.5rem; border-radius: 12px;">
                  <div style="font-size: 2rem; font-weight: bold;">${data.conversionRates.applicationToAccepted}%</div>
                  <div style="opacity: 0.9;">Acceptance Rate</div>
                  <div style="font-size: 0.9rem; margin-top: 0.5rem;">+2% improvement</div>
                </div>
                <div style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 1.5rem; border-radius: 12px;">
                  <div style="font-size: 2rem; font-weight: bold;">${data.conversionRates.acceptedToEnrolled}%</div>
                  <div style="opacity: 0.9;">Yield Rate</div>
                  <div style="font-size: 0.9rem; margin-top: 0.5rem;">+5% increase</div>
                </div>
                <div style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; padding: 1.5rem; border-radius: 12px;">
                  <div style="font-size: 2rem; font-weight: bold;">${data.demographics.international}%</div>
                  <div style="opacity: 0.9;">International Students</div>
                  <div style="font-size: 0.9rem; margin-top: 0.5rem;">+8% growth</div>
                </div>
              </div>

              <!-- Charts Grid -->
              <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                  <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 1rem;">
                    <h3 style="margin: 0; color: #1f2937;">Year-over-Year Application Trends</h3>
                    <div style="display: flex; gap: 0.5rem;">
                      <button onclick="downloadChart('trendsChart', 'Application_Trends_Chart')" style="background: #3b82f6; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.75rem;">📊 Download</button>
                      <button onclick="toggleChartType('trendsChart')" style="background: #8b5cf6; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.75rem;">📈 Toggle</button>
                    </div>
                  </div>
                  <canvas id="trendsChart" width="600" height="300" style="max-width: 100%; height: auto;"></canvas>
                </div>
                <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                  <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 1rem;">
                    <h3 style="margin: 0; color: #1f2937;">Student Demographics</h3>
                    <div style="display: flex; gap: 0.5rem;">
                      <button onclick="downloadChart('demographicsChart', 'Demographics_Chart')" style="background: #3b82f6; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.75rem;">📊 Download</button>
                      <button onclick="animateChart('demographicsChart')" style="background: #22c55e; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.75rem;">▶️ Animate</button>
                    </div>
                  </div>
                  <canvas id="demographicsChart" width="300" height="300" style="max-width: 100%; height: auto;"></canvas>
                </div>
              </div>

              <!-- Program Trends Table -->
              <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 2rem;">
                <h3 style="margin: 0 0 1rem 0; color: #1f2937;">Top Programs by Application Volume</h3>
                <div style="overflow-x: auto;">
                  <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                      <tr style="background: #e5e7eb;">
                        <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid #d1d5db;">Program</th>
                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #d1d5db;">Applications</th>
                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #d1d5db;">Change</th>
                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #d1d5db;">Trend</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${data.programTrends.map(program => `
                        <tr>
                          <td style="padding: 0.75rem; border-bottom: 1px solid #e5e7eb;">${program.name}</td>
                          <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">${program.applications.toLocaleString()}</td>
                          <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb; color: ${program.trend === 'up' ? '#10b981' : '#ef4444'};">${program.change}</td>
                          <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">${program.trend === 'up' ? '📈' : '📉'}</td>
                        </tr>
                      `).join('')}
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- Geographic Distribution -->
              <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                <h3 style="margin: 0 0 1rem 0; color: #1f2937;">Geographic Distribution</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                  ${data.geographicData.map(region => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                      <span>${region.region}</span>
                      <div style="text-align: right;">
                        <div style="font-weight: bold;">${region.applications.toLocaleString()}</div>
                        <div style="font-size: 0.875rem; color: #6b7280;">${region.percentage}%</div>
                      </div>
                    </div>
                  `).join('')}
                </div>
              </div>

              <!-- Advanced Analytics Section -->
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                  <h3 style="margin: 0 0 1rem 0; color: #1f2937;">📈 Trend Analysis</h3>
                  <div style="space-y: 1rem;">
                    <div style="display: flex; justify-content: between; align-items: center; padding: 0.75rem; background: white; border-radius: 8px; margin-bottom: 0.5rem;">
                      <span style="font-weight: 500;">Growth Rate (YoY)</span>
                      <span style="color: #22c55e; font-weight: bold;">+15.3%</span>
                    </div>
                    <div style="display: flex; justify-content: between; align-items: center; padding: 0.75rem; background: white; border-radius: 8px; margin-bottom: 0.5rem;">
                      <span style="font-weight: 500;">Peak Application Month</span>
                      <span style="color: #3b82f6; font-weight: bold;">March</span>
                    </div>
                    <div style="display: flex; justify-content: between; align-items: center; padding: 0.75rem; background: white; border-radius: 8px; margin-bottom: 0.5rem;">
                      <span style="font-weight: 500;">Conversion Rate</span>
                      <span style="color: #f59e0b; font-weight: bold;">68.4%</span>
                    </div>
                    <button onclick="generateTrendInsights()" style="width: 100%; background: #5a5bb8; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; margin-top: 1rem;">🔍 Generate AI Insights</button>
                  </div>
                </div>

                <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                  <h3 style="margin: 0 0 1rem 0; color: #1f2937;">📊 Quick Actions</h3>
                  <div style="space-y: 0.75rem;">
                    <button onclick="compareWithLastYear()" style="width: 100%; background: #3b82f6; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; margin-bottom: 0.75rem; text-align: left;">
                      <div style="font-weight: 600;">📅 Compare with Last Year</div>
                      <div style="font-size: 0.875rem; opacity: 0.9;">Side-by-side year comparison</div>
                    </button>
                    <button onclick="forecastNextQuarter()" style="width: 100%; background: #10b981; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; margin-bottom: 0.75rem; text-align: left;">
                      <div style="font-weight: 600;">🔮 Forecast Next Quarter</div>
                      <div style="font-size: 0.875rem; opacity: 0.9;">AI-powered predictions</div>
                    </button>
                    <button onclick="exportDetailedAnalysis()" style="width: 100%; background: #8b5cf6; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; text-align: left;">
                      <div style="font-weight: 600;">📋 Detailed Analysis</div>
                      <div style="font-size: 0.875rem; opacity: 0.9;">Comprehensive report</div>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Export Controls -->
              <div style="margin-top: 2rem; padding: 1.5rem; background: #f1f5f9; border-radius: 12px;">
                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 1rem;">
                  <h3 style="margin: 0;">Export & Share</h3>
                  <div style="display: flex; gap: 0.5rem;">
                    <button onclick="printTrendsReport()" style="background: #6b7280; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">🖨️ Print</button>
                    <button onclick="shareTrendsReport()" style="background: #059669; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">📤 Share</button>
                  </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                  <button onclick="exportTrendsReport('pdf')" style="background: #dc2626; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                    📄 Export PDF
                    <span style="font-size: 0.75rem; opacity: 0.8;">(2.3MB)</span>
                  </button>
                  <button onclick="exportTrendsReport('excel')" style="background: #059669; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                    📊 Export Excel
                    <span style="font-size: 0.75rem; opacity: 0.8;">(1.8MB)</span>
                  </button>
                  <button onclick="exportTrendsReport('csv')" style="background: #7c3aed; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                    📋 Export CSV
                    <span style="font-size: 0.75rem; opacity: 0.8;">(850KB)</span>
                  </button>
                  <button onclick="scheduleTrendsReport()" style="background: #f59e0b; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                    ⏰ Schedule Report
                    <span style="font-size: 0.75rem; opacity: 0.8;">(Auto)</span>
                  </button>
                </div>
                <div style="margin-top: 1rem; padding: 1rem; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                  <div style="display: flex; justify-content: between; align-items: center;">
                    <span style="font-size: 0.875rem; color: #6b7280;">Include in export:</span>
                    <div style="display: flex; gap: 1rem;">
                      <label style="display: flex; align-items: center; gap: 0.25rem; font-size: 0.875rem;">
                        <input type="checkbox" checked id="includeCharts"> Charts
                      </label>
                      <label style="display: flex; align-items: center; gap: 0.25rem; font-size: 0.875rem;">
                        <input type="checkbox" checked id="includeData"> Raw Data
                      </label>
                      <label style="display: flex; align-items: center; gap: 0.25rem; font-size: 0.875rem;">
                        <input type="checkbox" id="includeInsights"> AI Insights
                      </label>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      `;
    }

    function initializeApplicationTrendsCharts(data) {
      // Create enhanced interactive charts
      const trendsCanvas = document.getElementById('trendsChart');
      const demographicsCanvas = document.getElementById('demographicsChart');

      if (trendsCanvas && demographicsCanvas) {
        drawAdvancedLineChart(trendsCanvas, data.yearOverYear);
        drawInteractivePieChart(demographicsCanvas, data.demographics);

        // Store chart data for later use
        trendsCharts.trendsChart = { canvas: trendsCanvas, data: data.yearOverYear, type: 'line' };
        trendsCharts.demographicsChart = { canvas: demographicsCanvas, data: data.demographics, type: 'pie' };
      }
    }

    function setupTrendsInteractivity() {
      // Add event listeners for interactive features
      const trendsCanvas = document.getElementById('trendsChart');
      const demographicsCanvas = document.getElementById('demographicsChart');

      if (trendsCanvas) {
        trendsCanvas.addEventListener('click', handleTrendsChartClick);
        trendsCanvas.addEventListener('mousemove', handleTrendsChartHover);
      }

      if (demographicsCanvas) {
        demographicsCanvas.addEventListener('click', handleDemographicsChartClick);
        demographicsCanvas.addEventListener('mousemove', handleDemographicsChartHover);
      }

      showToast('📊 Interactive charts loaded! Click and hover for details.', 'success', 3000);
    }

    // Enhanced Chart Drawing Functions
    function drawAdvancedLineChart(canvas, data) {
      const ctx = canvas.getContext('2d');
      const width = canvas.width;
      const height = canvas.height;
      const padding = 60;

      // Clear canvas
      ctx.clearRect(0, 0, width, height);

      // Set up chart area
      const chartWidth = width - padding * 2;
      const chartHeight = height - padding * 2;

      // Get current year data
      const currentYear = new Date().getFullYear();
      const currentData = data[currentYear] || [];
      const previousData = data[currentYear - 1] || [];

      if (currentData.length === 0) return;

      const maxValue = Math.max(...currentData, ...previousData);
      const stepX = chartWidth / (currentData.length - 1);

      // Draw grid lines
      ctx.strokeStyle = '#e2e8f0';
      ctx.lineWidth = 1;

      // Horizontal grid lines
      for (let i = 0; i <= 5; i++) {
        const y = padding + (chartHeight / 5) * i;
        ctx.beginPath();
        ctx.moveTo(padding, y);
        ctx.lineTo(width - padding, y);
        ctx.stroke();

        // Y-axis labels
        ctx.fillStyle = '#6b7280';
        ctx.font = '12px Arial';
        ctx.textAlign = 'right';
        ctx.fillText(Math.round(maxValue * (1 - i / 5)).toLocaleString(), padding - 10, y + 4);
      }

      // Vertical grid lines and X-axis labels
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      for (let i = 0; i < currentData.length; i++) {
        const x = padding + stepX * i;
        ctx.beginPath();
        ctx.moveTo(x, padding);
        ctx.lineTo(x, height - padding);
        ctx.stroke();

        // X-axis labels
        ctx.fillStyle = '#6b7280';
        ctx.font = '12px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(months[i], x, height - padding + 20);
      }

      // Draw current year line
      ctx.strokeStyle = '#3b82f6';
      ctx.lineWidth = 3;
      ctx.beginPath();

      for (let i = 0; i < currentData.length; i++) {
        const x = padding + stepX * i;
        const y = padding + chartHeight - (currentData[i] / maxValue) * chartHeight;

        if (i === 0) {
          ctx.moveTo(x, y);
        } else {
          ctx.lineTo(x, y);
        }
      }
      ctx.stroke();

      // Draw current year points
      ctx.fillStyle = '#3b82f6';
      for (let i = 0; i < currentData.length; i++) {
        const x = padding + stepX * i;
        const y = padding + chartHeight - (currentData[i] / maxValue) * chartHeight;

        ctx.beginPath();
        ctx.arc(x, y, 4, 0, 2 * Math.PI);
        ctx.fill();
      }

      // Draw previous year line
      if (previousData.length > 0) {
        ctx.strokeStyle = '#10b981';
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 5]);
        ctx.beginPath();

        for (let i = 0; i < previousData.length; i++) {
          const x = padding + stepX * i;
          const y = padding + chartHeight - (previousData[i] / maxValue) * chartHeight;

          if (i === 0) {
            ctx.moveTo(x, y);
          } else {
            ctx.lineTo(x, y);
          }
        }
        ctx.stroke();
        ctx.setLineDash([]);
      }

      // Draw legend
      const legendY = 20;
      ctx.fillStyle = '#3b82f6';
      ctx.fillRect(20, legendY, 15, 3);
      ctx.fillStyle = '#1f2937';
      ctx.font = '12px Arial';
      ctx.textAlign = 'left';
      ctx.fillText(`${currentYear}`, 40, legendY + 8);

      if (previousData.length > 0) {
        ctx.strokeStyle = '#10b981';
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 5]);
        ctx.beginPath();
        ctx.moveTo(120, legendY + 2);
        ctx.lineTo(135, legendY + 2);
        ctx.stroke();
        ctx.setLineDash([]);
        ctx.fillText(`${currentYear - 1}`, 140, legendY + 8);
      }

      // Add title
      ctx.fillStyle = '#1f2937';
      ctx.font = 'bold 14px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Monthly Application Trends', width / 2, 25);
    }

    function drawInteractivePieChart(canvas, data) {
      const ctx = canvas.getContext('2d');
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const radius = Math.min(centerX, centerY) - 30;

      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Calculate data
      const total = data.domestic + data.international + data.undergraduate + data.graduate;
      const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444'];
      const labels = ['Domestic', 'International', 'Undergraduate', 'Graduate'];
      const values = [data.domestic, data.international, data.undergraduate, data.graduate];

      let currentAngle = -Math.PI / 2; // Start from top

      // Draw slices
      values.forEach((value, index) => {
        const sliceAngle = (value / total) * 2 * Math.PI;

        // Draw slice
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
        ctx.lineTo(centerX, centerY);
        ctx.fillStyle = colors[index];
        ctx.fill();

        // Draw slice border
        ctx.strokeStyle = '#ffffff';
        ctx.lineWidth = 2;
        ctx.stroke();

        // Draw labels
        const labelAngle = currentAngle + sliceAngle / 2;
        const labelX = centerX + Math.cos(labelAngle) * (radius * 0.7);
        const labelY = centerY + Math.sin(labelAngle) * (radius * 0.7);

        ctx.fillStyle = '#ffffff';
        ctx.font = 'bold 12px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(`${value}%`, labelX, labelY);

        currentAngle += sliceAngle;
      });

      // Draw center circle
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius * 0.4, 0, 2 * Math.PI);
      ctx.fillStyle = '#ffffff';
      ctx.fill();
      ctx.strokeStyle = '#e2e8f0';
      ctx.lineWidth = 2;
      ctx.stroke();

      // Center text
      ctx.fillStyle = '#1f2937';
      ctx.font = 'bold 14px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Student', centerX, centerY - 5);
      ctx.fillText('Mix', centerX, centerY + 10);

      // Draw legend
      const legendStartY = 30;
      labels.forEach((label, index) => {
        const y = legendStartY + index * 20;

        // Color box
        ctx.fillStyle = colors[index];
        ctx.fillRect(10, y - 8, 12, 12);

        // Label text
        ctx.fillStyle = '#1f2937';
        ctx.font = '12px Arial';
        ctx.textAlign = 'left';
        ctx.fillText(`${label}: ${values[index]}%`, 28, y + 2);
      });
    }

    // Interactive Chart Event Handlers
    function handleTrendsChartClick(event) {
      const canvas = event.target;
      const rect = canvas.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;

      // Simple click detection for data points
      showToast('📊 Chart clicked! Detailed view coming soon.', 'info', 2000);
    }

    function handleTrendsChartHover(event) {
      const canvas = event.target;
      canvas.style.cursor = 'pointer';
    }

    function handleDemographicsChartClick(event) {
      const canvas = event.target;
      const rect = canvas.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;

      showToast('🥧 Demographics slice selected! Drill-down available.', 'info', 2000);
    }

    function handleDemographicsChartHover(event) {
      const canvas = event.target;
      canvas.style.cursor = 'pointer';
    }

    // Interactive Functions
    function updateTrendsFilter(filterType, value) {
      trendsFilters[filterType] = value;
      showToast(`🔍 Filter updated: ${filterType} = ${value}`, 'info', 1500);

      // Simulate data update
      setTimeout(() => {
        const newData = generateFilteredTrendsData();
        updateTrendsCharts(newData);
      }, 500);
    }

    function generateFilteredTrendsData() {
      // Generate filtered data based on current filters
      const baseData = applicationTrendsData;

      // Apply filters (simplified simulation)
      let filteredData = { ...baseData };

      // Modify data based on filters
      if (trendsFilters.programs !== 'all') {
        // Simulate program filtering
        filteredData.programTrends = filteredData.programTrends.filter(p =>
          p.name.toLowerCase().includes(trendsFilters.programs.replace('-', ' '))
        );
      }

      if (trendsFilters.demographics !== 'all') {
        // Simulate demographic filtering
        if (trendsFilters.demographics === 'international') {
          filteredData.demographics.domestic = 0;
          filteredData.demographics.international = 100;
        }
      }

      return filteredData;
    }

    function updateTrendsCharts(data) {
      const trendsCanvas = document.getElementById('trendsChart');
      const demographicsCanvas = document.getElementById('demographicsChart');

      if (trendsCanvas && demographicsCanvas) {
        drawAdvancedLineChart(trendsCanvas, data.yearOverYear);
        drawInteractivePieChart(demographicsCanvas, data.demographics);
        showToast('📊 Charts updated with filtered data!', 'success', 2000);
      }
    }

    function resetTrendsFilters() {
      trendsFilters = {
        dateRange: 'last12months',
        programs: 'all',
        demographics: 'all',
        region: 'all'
      };

      // Reset form values
      document.getElementById('trendsDateRange').value = 'last12months';
      document.getElementById('trendsPrograms').value = 'all';
      document.getElementById('trendsDemographics').value = 'all';
      document.getElementById('trendsRegion').value = 'all';

      updateTrendsCharts(applicationTrendsData);
      showToast('🔄 All filters reset!', 'success', 2000);
    }

    function refreshTrendsData() {
      showToast('🔄 Refreshing application trends data...', 'info', 1000);

      setTimeout(() => {
        applicationTrendsData = generateApplicationTrendsData();
        updateTrendsCharts(applicationTrendsData);
        showToast('✅ Data refreshed successfully!', 'success', 2000);
        updateLastRefreshTime();
      }, 1500);
    }

    function updateLastRefreshTime() {
      const lastRefreshElement = document.getElementById('lastRefreshTime');
      if (lastRefreshElement) {
        const now = new Date();
        lastRefreshElement.textContent = `Last updated: ${now.toLocaleTimeString()}`;
      }
    }

    let autoRefreshInterval = null;

    function toggleAutoRefresh() {
      const button = document.querySelector('[onclick="toggleAutoRefresh()"]');

      if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
        autoRefreshInterval = null;
        if (button) button.textContent = '▶️ Auto Refresh';
        showToast('⏸️ Auto refresh stopped', 'info', 1500);
      } else {
        autoRefreshInterval = setInterval(() => {
          refreshTrendsData();
        }, 300000); // Refresh every 5 minutes
        if (button) button.textContent = '⏸️ Auto Refresh';
        showToast('🔄 Auto refresh started (5min intervals)', 'success', 2000);
      }
    }

    function setupRealTimeUpdates() {
      setInterval(() => {
        const statusElement = document.getElementById('connectionStatus');
        if (statusElement) {
          statusElement.textContent = '🟢 Live';
          statusElement.style.color = '#10b981';
        }
      }, 1000);

      setInterval(() => {
        const now = new Date();
        const timeElement = document.getElementById('currentTime');
        if (timeElement) {
          timeElement.textContent = now.toLocaleTimeString();
        }
      }, 1000);
    }

    function toggleTrendsFullscreen() {
      const modal = document.getElementById('applicationTrendsModal');
      const button = document.querySelector('[onclick="toggleTrendsFullscreen()"]');

      if (modal) {
        const isFullscreen = modal.getAttribute('data-fullscreen') === 'true';

        if (isFullscreen) {
          // Exit fullscreen - return to normal size
          modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 95vw; height: 90vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;';
          modal.setAttribute('data-fullscreen', 'false');
          if (button) button.innerHTML = '🖥️ Fullscreen';
          showToast('📱 Exited fullscreen mode', 'info', 1500);
        } else {
          // Enter fullscreen - expand to full viewport
          modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center; z-index: 10000;';
          modal.setAttribute('data-fullscreen', 'true');
          if (button) button.innerHTML = '📱 Exit Fullscreen';
          showToast('🖥️ Entered fullscreen mode', 'info', 1500);
        }

        // Also need to adjust the inner modal content for fullscreen
        const modalContent = modal.querySelector('div[style*="background: white"]');
        if (modalContent) {
          if (isFullscreen) {
            // Exit fullscreen - return to normal size
            modalContent.style.width = '95vw';
            modalContent.style.height = '90vh';
            modalContent.style.borderRadius = '16px';
          } else {
            // Enter fullscreen - expand content
            modalContent.style.width = '100vw';
            modalContent.style.height = '100vh';
            modalContent.style.borderRadius = '0';
          }
        }
      }
    }

    // 2. Enrollment Forecasting and Projections
    function openEnrollmentForecasting() {
      showToast('🔮 Loading Enrollment Forecasting Models...', 'info', 2000);

      setTimeout(() => {
        forecastData = generateForecastData();
        const modalHtml = createForecastModal(forecastData);
        document.body.insertAdjacentHTML('beforeend', modalHtml);

        // Initialize features
        setTimeout(() => {
          initializeForecastFeatures();
        }, 100);
      }, 1000);
    }

    function generateForecastData() {
      const quarters = ['Q1 2024', 'Q2 2024', 'Q3 2024', 'Q4 2024', 'Q1 2025', 'Q2 2025', 'Q3 2025', 'Q4 2025'];

      return {
        historical: [2340, 2567, 2123, 2456, 2678, 2890, 2456, 2789],
        projected: [2890, 3120, 3245, 3456],
        confidence: [85, 82, 78, 75],
        scenarios: {
          optimistic: [3120, 3350, 3580, 3750],
          realistic: [2890, 3120, 3245, 3456],
          conservative: [2650, 2850, 2980, 3100]
        },
        factors: [
          { name: 'Economic Growth', impact: '+12%', weight: 'High' },
          { name: 'Competition', impact: '-8%', weight: 'Medium' },
          { name: 'Program Expansion', impact: '+15%', weight: 'High' },
          { name: 'Marketing Investment', impact: '+6%', weight: 'Medium' },
          { name: 'Demographic Changes', impact: '+3%', weight: 'Low' }
        ]
      };
    }

    function createForecastModal(data) {
      return `
        <div id="forecastModal" data-fullscreen="false" style="position: fixed; top: 0; left: 0; width: 95vw; height: 90vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;">
          <div style="background: white; width: 95vw; height: 90vh; border-radius: 16px; overflow: hidden; display: flex; flex-direction: column;">
            <div style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 1.5rem; display: flex; justify-content: between; align-items: center;">
              <div>
                <h2 style="margin: 0; font-size: 1.5rem;">🔮 Enrollment Forecasting & Projections</h2>
                <div style="display: flex; align-items: center; gap: 1rem; margin-top: 0.5rem;">
                  <span id="forecastStatus" style="font-size: 0.875rem; color: #10b981;">🟢 Models Active</span>
                  <span id="lastForecastUpdate" style="font-size: 0.875rem; color: rgba(255,255,255,0.8);">Last updated: --:--:--</span>
                  <span id="forecastTime" style="font-size: 0.875rem; color: rgba(255,255,255,0.8);"></span>
                </div>
              </div>
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <button onclick="refreshForecastData()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">🔄 Refresh</button>
                <button onclick="toggleForecastFullscreen()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">🖥️ Fullscreen</button>
                <button onclick="closeModal('forecastModal')" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">✕ Close</button>
              </div>
            </div>
            <div style="flex: 1; overflow-y: auto; padding: 2rem;">

              <!-- Forecast Summary -->
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                <div style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; padding: 1.5rem; border-radius: 12px;">
                  <div style="font-size: 2rem; font-weight: bold;">3,456</div>
                  <div style="opacity: 0.9;">Projected Q4 2025 Enrollment</div>
                  <div style="font-size: 0.9rem; margin-top: 0.5rem;">+18% from current</div>
                </div>
                <div style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 1.5rem; border-radius: 12px;">
                  <div style="font-size: 2rem; font-weight: bold;">78%</div>
                  <div style="opacity: 0.9;">Forecast Confidence</div>
                  <div style="font-size: 0.9rem; margin-top: 0.5rem;">High accuracy model</div>
                </div>
                <div style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 1.5rem; border-radius: 12px;">
                  <div style="font-size: 2rem; font-weight: bold;">+12%</div>
                  <div style="opacity: 0.9;">Annual Growth Rate</div>
                  <div style="font-size: 0.9rem; margin-top: 0.5rem;">Above industry average</div>
                </div>
              </div>

              <!-- Forecast Chart -->
              <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 2rem;">
                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 1rem;">
                  <h3 style="margin: 0; color: #1f2937;">Enrollment Projections (Next 8 Quarters)</h3>
                  <div style="display: flex; gap: 0.5rem;">
                    <button onclick="downloadForecastChart('forecastChart', 'enrollment_forecast')" style="background: #6b7280; color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 6px; cursor: pointer; font-size: 0.875rem;">📥 Download</button>
                    <button onclick="toggleForecastChartType()" style="background: #3b82f6; color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 6px; cursor: pointer; font-size: 0.875rem;">📊 Toggle Type</button>
                  </div>
                </div>
                <div style="height: 350px; background: white; border-radius: 8px; position: relative; overflow: hidden;">
                  <canvas id="forecastChart" width="800" height="350" style="width: 100%; height: 100%; cursor: crosshair;"></canvas>
                </div>
              </div>

              <!-- Scenario Analysis -->
              <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                  <h3 style="margin: 0 0 1rem 0; color: #1f2937;">Scenario Analysis</h3>
                  <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                    <div style="background: #fef2f2; border: 1px solid #fecaca; padding: 1rem; border-radius: 8px;">
                      <h4 style="margin: 0 0 0.5rem 0; color: #dc2626;">Conservative</h4>
                      <div style="font-size: 1.25rem; font-weight: bold; color: #dc2626;">3,100</div>
                      <div style="font-size: 0.875rem; color: #6b7280;">-10% from projection</div>
                    </div>
                    <div style="background: #f0fdf4; border: 1px solid #bbf7d0; padding: 1rem; border-radius: 8px;">
                      <h4 style="margin: 0 0 0.5rem 0; color: #16a34a;">Realistic</h4>
                      <div style="font-size: 1.25rem; font-weight: bold; color: #16a34a;">3,456</div>
                      <div style="font-size: 0.875rem; color: #6b7280;">Base projection</div>
                    </div>
                    <div style="background: #eff6ff; border: 1px solid #bfdbfe; padding: 1rem; border-radius: 8px;">
                      <h4 style="margin: 0 0 0.5rem 0; color: #2563eb;">Optimistic</h4>
                      <div style="font-size: 1.25rem; font-weight: bold; color: #2563eb;">3,750</div>
                      <div style="font-size: 0.875rem; color: #6b7280;">+8% from projection</div>
                    </div>
                  </div>
                </div>

                <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                  <h3 style="margin: 0 0 1rem 0; color: #1f2937;">Key Factors</h3>
                  <div style="space-y: 0.75rem;">
                    ${data.factors.map(factor => `
                      <div style="display: flex; justify-content: between; align-items: center; padding: 0.5rem; background: white; border-radius: 6px; margin-bottom: 0.5rem;">
                        <div>
                          <div style="font-weight: 500; font-size: 0.875rem;">${factor.name}</div>
                          <div style="font-size: 0.75rem; color: #6b7280;">${factor.weight} Impact</div>
                        </div>
                        <div style="font-weight: bold; color: ${factor.impact.startsWith('+') ? '#16a34a' : '#dc2626'};">${factor.impact}</div>
                      </div>
                    `).join('')}
                  </div>
                </div>
              </div>

              <!-- Model Controls -->
              <div style="margin-top: 2rem; padding: 1.5rem; background: #f1f5f9; border-radius: 12px;">
                <h3 style="margin: 0 0 1rem 0;">Forecast Controls</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                  <div>
                    <label style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem; font-weight: 500;">Time Horizon</label>
                    <select style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                      <option>Next 4 Quarters</option>
                      <option selected>Next 8 Quarters</option>
                      <option>Next 12 Quarters</option>
                    </select>
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem; font-weight: 500;">Model Type</label>
                    <select style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                      <option selected>Machine Learning</option>
                      <option>Time Series</option>
                      <option>Regression</option>
                    </select>
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem; font-weight: 500;">Confidence Level</label>
                    <select style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                      <option>90%</option>
                      <option selected>95%</option>
                      <option>99%</option>
                    </select>
                  </div>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                  <button onclick="recalculateForecast()" style="background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">🔄 Recalculate</button>
                  <button onclick="exportForecast('pdf')" style="background: #dc2626; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">📄 Export Forecast</button>
                  <button onclick="shareForecast()" style="background: #059669; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">📤 Share Report</button>
                  <button onclick="scheduleForecast()" style="background: #f59e0b; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">⏰ Schedule</button>
                  <button onclick="generateForecastInsights()" style="background: #8b5cf6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">🤖 AI Insights</button>
                </div>
              </div>

            </div>
          </div>
        </div>
      `;
    }

    // Enrollment Forecasting Functionality
    let forecastData = null;
    let forecastChartType = 'line';

    function initializeForecastFeatures() {
      setTimeout(() => {
        if (document.getElementById('forecastChart')) {
          drawForecastChart();
          setupForecastRealTime();
          updateLastForecastTime();
        }
      }, 100);
    }

    function drawForecastChart() {
      const canvas = document.getElementById('forecastChart');
      if (!canvas) return;

      const ctx = canvas.getContext('2d');
      const width = canvas.width;
      const height = canvas.height;
      const padding = 60;

      ctx.clearRect(0, 0, width, height);

      // Chart background
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0, 0, width, height);

      // Historical and projected data
      const historical = [2340, 2567, 2123, 2456, 2678, 2890, 2456, 2789];
      const projected = [2890, 3120, 3245, 3456];
      const allData = [...historical, ...projected];
      const quarters = ['Q1 2024', 'Q2 2024', 'Q3 2024', 'Q4 2024', 'Q1 2025', 'Q2 2025', 'Q3 2025', 'Q4 2025', 'Q1 2026', 'Q2 2026', 'Q3 2026', 'Q4 2026'];

      const maxValue = Math.max(...allData) * 1.1;
      const minValue = Math.min(...allData) * 0.9;

      // Grid lines
      ctx.strokeStyle = '#e5e7eb';
      ctx.lineWidth = 1;
      for (let i = 0; i <= 10; i++) {
        const y = padding + (i * (height - 2 * padding)) / 10;
        ctx.beginPath();
        ctx.moveTo(padding, y);
        ctx.lineTo(width - padding, y);
        ctx.stroke();
      }

      // Y-axis labels
      ctx.fillStyle = '#6b7280';
      ctx.font = '12px Arial';
      ctx.textAlign = 'right';
      for (let i = 0; i <= 10; i++) {
        const value = minValue + (maxValue - minValue) * (10 - i) / 10;
        const y = padding + (i * (height - 2 * padding)) / 10;
        ctx.fillText(Math.round(value).toLocaleString(), padding - 10, y + 4);
      }

      // Draw historical data (solid line)
      ctx.strokeStyle = '#10b981';
      ctx.lineWidth = 3;
      ctx.beginPath();
      for (let i = 0; i < historical.length; i++) {
        const x = padding + (i * (width - 2 * padding)) / (allData.length - 1);
        const y = padding + (height - 2 * padding) * (1 - (historical[i] - minValue) / (maxValue - minValue));
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.stroke();

      // Draw projected data (dashed line)
      ctx.strokeStyle = '#3b82f6';
      ctx.lineWidth = 3;
      ctx.setLineDash([10, 5]);
      ctx.beginPath();
      for (let i = historical.length - 1; i < allData.length; i++) {
        const x = padding + (i * (width - 2 * padding)) / (allData.length - 1);
        const y = padding + (height - 2 * padding) * (1 - (allData[i] - minValue) / (maxValue - minValue));
        if (i === historical.length - 1) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.stroke();
      ctx.setLineDash([]);

      // Data points
      for (let i = 0; i < allData.length; i++) {
        const x = padding + (i * (width - 2 * padding)) / (allData.length - 1);
        const y = padding + (height - 2 * padding) * (1 - (allData[i] - minValue) / (maxValue - minValue));

        ctx.fillStyle = i < historical.length ? '#10b981' : '#3b82f6';
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, 2 * Math.PI);
        ctx.fill();
      }

      // Legend
      ctx.fillStyle = '#10b981';
      ctx.fillRect(width - 180, 20, 15, 3);
      ctx.fillStyle = '#1f2937';
      ctx.font = '12px Arial';
      ctx.textAlign = 'left';
      ctx.fillText('Historical', width - 160, 26);

      ctx.fillStyle = '#3b82f6';
      ctx.fillRect(width - 180, 40, 15, 3);
      ctx.fillText('Projected', width - 160, 46);
    }

    function toggleForecastChartType() {
      forecastChartType = forecastChartType === 'line' ? 'bar' : 'line';
      drawForecastChart();
      showToast(`📊 Chart type changed to ${forecastChartType}`, 'info', 1500);
    }

    function downloadForecastChart(chartId, filename) {
      const canvas = document.getElementById(chartId);
      if (canvas) {
        const link = document.createElement('a');
        link.download = `${filename}_${new Date().toISOString().split('T')[0]}.png`;
        link.href = canvas.toDataURL();
        link.click();
        showToast(`📊 Forecast chart downloaded as ${filename}.png`, 'success', 2000);
      }
    }

    function refreshForecastData() {
      showToast('🔄 Refreshing forecast models...', 'info', 1000);
      setTimeout(() => {
        forecastData = generateForecastData();
        drawForecastChart();
        updateLastForecastTime();
        showToast('✅ Forecast data refreshed!', 'success', 2000);
      }, 1500);
    }

    function updateLastForecastTime() {
      const lastUpdateElement = document.getElementById('lastForecastUpdate');
      if (lastUpdateElement) {
        const now = new Date();
        lastUpdateElement.textContent = `Last updated: ${now.toLocaleTimeString()}`;
      }
    }

    function setupForecastRealTime() {
      setInterval(() => {
        const timeElement = document.getElementById('forecastTime');
        if (timeElement) {
          timeElement.textContent = new Date().toLocaleTimeString();
        }
      }, 1000);
    }

    function recalculateForecast() {
      showToast('🤖 Recalculating forecast with updated parameters...', 'info', 2000);
      setTimeout(() => {
        forecastData = generateForecastData();
        drawForecastChart();
        updateLastForecastTime();
        showToast('✅ Forecast recalculated successfully!', 'success', 2000);
      }, 2000);
    }

    function exportForecast(format) {
      showToast(`📄 Exporting forecast report as ${format.toUpperCase()}...`, 'info', 1500);
      setTimeout(() => {
        const fileSize = Math.round(Math.random() * 500 + 200);
        showToast(`✅ Forecast report exported (${fileSize}KB)`, 'success', 2000);
      }, 1500);
    }

    function shareForecast() {
      const shareModal = `
        <div id="shareForecastModal" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 15000;">
          <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 500px; width: 90vw;">
            <h3 style="margin: 0 0 1rem 0;">📤 Share Forecast Report</h3>
            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem;">Email Recipients:</label>
              <input type="email" placeholder="Enter email addresses (comma-separated)" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
            </div>
            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem;">Message:</label>
              <textarea placeholder="Optional message..." style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px; height: 80px; resize: vertical;"></textarea>
            </div>
            <div style="display: flex; gap: 1rem; justify-content: end;">
              <button onclick="closeModal('shareForecastModal')" style="background: #6b7280; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">Cancel</button>
              <button onclick="sendForecastReport()" style="background: #10b981; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">📤 Send</button>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', shareModal);
    }

    function sendForecastReport() {
      closeModal('shareForecastModal');
      showToast('📧 Sending forecast report...', 'info', 1500);
      setTimeout(() => {
        showToast('✅ Forecast report sent successfully!', 'success', 2000);
      }, 1500);
    }

    function scheduleForecast() {
      const scheduleModal = `
        <div id="scheduleForecastModal" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 15000;">
          <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 500px; width: 90vw;">
            <h3 style="margin: 0 0 1rem 0;">⏰ Schedule Forecast Updates</h3>
            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem;">Frequency:</label>
              <select style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                <option>Daily</option>
                <option>Weekly</option>
                <option selected>Monthly</option>
                <option>Quarterly</option>
              </select>
            </div>
            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem;">Recipients:</label>
              <input type="email" placeholder="Enter email addresses" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
            </div>
            <div style="display: flex; gap: 1rem; justify-content: end;">
              <button onclick="closeModal('scheduleForecastModal')" style="background: #6b7280; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">Cancel</button>
              <button onclick="saveForecastSchedule()" style="background: #f59e0b; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">⏰ Schedule</button>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', scheduleModal);
    }

    function saveForecastSchedule() {
      closeModal('scheduleForecastModal');
      showToast('⏰ Forecast schedule saved successfully!', 'success', 2000);
    }

    function generateForecastInsights() {
      const insightsModal = `
        <div id="forecastInsightsModal" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 15000;">
          <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 600px; width: 90vw; max-height: 80vh; overflow-y: auto;">
            <h3 style="margin: 0 0 1rem 0;">🤖 AI-Generated Forecast Insights</h3>

            <div style="background: #f0f9ff; border: 1px solid #0284c7; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
              <h4 style="margin: 0 0 0.5rem 0; color: #0284c7;">📈 Growth Trajectory</h4>
              <p style="margin: 0; font-size: 0.9rem;">Our ML models predict a strong 18% enrollment growth over the next 8 quarters, driven primarily by program expansion and increased market demand.</p>
            </div>

            <div style="background: #fef3c7; border: 1px solid #f59e0b; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
              <h4 style="margin: 0 0 0.5rem 0; color: #f59e0b;">⚠️ Risk Factors</h4>
              <p style="margin: 0; font-size: 0.9rem;">Monitor economic conditions closely. A 2% increase in interest rates could reduce projected enrollment by 150-200 students per quarter.</p>
            </div>

            <div style="background: #ecfdf5; border: 1px solid #10b981; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
              <h4 style="margin: 0 0 0.5rem 0; color: #10b981;">💡 Recommendations</h4>
              <ul style="margin: 0.5rem 0; padding-left: 1.2rem; font-size: 0.9rem;">
                <li>Accelerate marketing campaigns in Q2 2025 for optimal enrollment timing</li>
                <li>Consider capacity expansion planning for facilities by Q3 2025</li>
                <li>Develop contingency plans for economic downturn scenarios</li>
              </ul>
            </div>

            <div style="background: #ede9fe; border: 1px solid #8b5cf6; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
              <h4 style="margin: 0 0 0.5rem 0; color: #8b5cf6;">🎯 Confidence Levels</h4>
              <p style="margin: 0; font-size: 0.9rem;">Model confidence decreases from 85% (Q1 2025) to 75% (Q4 2025). Consider monthly model updates for improved accuracy.</p>
            </div>

            <div style="display: flex; gap: 1rem; justify-content: end;">
              <button onclick="closeModal('forecastInsightsModal')" style="background: #6b7280; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">Close</button>
              <button onclick="exportInsights()" style="background: #8b5cf6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">📄 Export Insights</button>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', insightsModal);
    }

    function exportInsights() {
      closeModal('forecastInsightsModal');
      showToast('📄 Exporting AI insights report...', 'info', 1500);
      setTimeout(() => {
        showToast('✅ AI insights exported successfully!', 'success', 2000);
      }, 1500);
    }

    function toggleForecastFullscreen() {
      const modal = document.getElementById('forecastModal');
      const button = document.querySelector('[onclick="toggleForecastFullscreen()"]');

      if (modal) {
        const isFullscreen = modal.getAttribute('data-fullscreen') === 'true';

        if (isFullscreen) {
          modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 95vw; height: 90vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;';
          modal.setAttribute('data-fullscreen', 'false');
          if (button) button.innerHTML = '🖥️ Fullscreen';
          showToast('📱 Exited fullscreen mode', 'info', 1500);
        } else {
          modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center; z-index: 10000;';
          modal.setAttribute('data-fullscreen', 'true');
          if (button) button.innerHTML = '📱 Exit Fullscreen';
          showToast('🖥️ Entered fullscreen mode', 'info', 1500);
        }

        const modalContent = modal.querySelector('div[style*="background: white"]');
        if (modalContent) {
          if (isFullscreen) {
            modalContent.style.width = '95vw';
            modalContent.style.height = '90vh';
            modalContent.style.borderRadius = '16px';
          } else {
            modalContent.style.width = '100vw';
            modalContent.style.height = '100vh';
            modalContent.style.borderRadius = '0';
          }
        }
      }
    }

    console.log('✅ Main report functions loaded:', {
      openApplicationTrends: typeof openApplicationTrends,
      openEnrollmentForecasting: typeof openEnrollmentForecasting,
      openPerformanceMetrics: typeof openPerformanceMetrics
    });

    // 3. Performance Metrics and KPI Tracking
    function openPerformanceMetrics() {
      showToast('📊 Loading Performance Metrics Dashboard...', 'info', 2000);

      setTimeout(() => {
        performanceData = generatePerformanceMetricsData();
        const modalHtml = createPerformanceMetricsModal(performanceData);
        document.body.insertAdjacentHTML('beforeend', modalHtml);

        // Initialize features
        setTimeout(() => {
          initializePerformanceFeatures();
        }, 100);
      }, 1000);
    }

    function generatePerformanceMetricsData() {
      return {
        kpis: {
          applicationCompletionRate: { value: 89, target: 85, change: '+3%' },
          averageProcessingTime: { value: 2.1, target: 3.0, change: '-0.3 days' },
          studentSatisfaction: { value: 4.6, target: 4.0, change: '+0.2' },
          yieldRate: { value: 42, target: 40, change: '+5%' },
          retentionRate: { value: 91, target: 88, change: '+3%' },
          costPerApplication: { value: 45, target: 50, change: '-$8' }
        },
        departmentPerformance: [
          { department: 'Admissions', efficiency: 94, satisfaction: 4.7, processTime: 1.8 },
          { department: 'Financial Aid', efficiency: 87, satisfaction: 4.3, processTime: 3.2 },
          { department: 'Academic Affairs', efficiency: 91, satisfaction: 4.5, processTime: 2.1 },
          { department: 'Student Services', efficiency: 89, satisfaction: 4.4, processTime: 2.7 }
        ],
        timeSeriesData: {
          labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
          applicationVolume: [1240, 1567, 1834, 2156, 1978, 2234],
          processingTime: [2.3, 2.1, 1.9, 2.0, 2.1, 1.8],
          satisfaction: [4.2, 4.4, 4.5, 4.6, 4.5, 4.7]
        }
      };
    }

    function createPerformanceMetricsModal(data) {
      return `
        <div id="performanceModal" data-fullscreen="false" style="position: fixed; top: 0; left: 0; width: 95vw; height: 90vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;">
          <div style="background: white; width: 95vw; height: 90vh; border-radius: 16px; overflow: hidden; display: flex; flex-direction: column;">
            <div style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 1.5rem; display: flex; justify-content: between; align-items: center;">
              <div>
                <h2 style="margin: 0; font-size: 1.5rem;">📊 Performance Metrics & KPI Tracking</h2>
                <div style="display: flex; align-items: center; gap: 1rem; margin-top: 0.5rem;">
                  <span id="metricsStatus" style="font-size: 0.875rem; color: #10b981;">🟢 Live Tracking</span>
                  <span id="lastMetricsUpdate" style="font-size: 0.875rem; color: rgba(255,255,255,0.8);">Last updated: --:--:--</span>
                  <span id="metricsTime" style="font-size: 0.875rem; color: rgba(255,255,255,0.8);"></span>
                </div>
              </div>
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <button onclick="refreshMetricsData()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">🔄 Refresh</button>
                <button onclick="toggleMetricsFullscreen()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">🖥️ Fullscreen</button>
                <button onclick="closeModal('performanceModal')" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">✕ Close</button>
              </div>
            </div>
            <div style="flex: 1; overflow-y: auto; padding: 2rem;">

              <!-- KPI Dashboard -->
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                ${Object.entries(data.kpis).map(([key, kpi]) => {
                  const isPositive = kpi.change.includes('+') || kpi.change.includes('-') && (key.includes('Time') || key.includes('Cost'));
                  return `
                    <div style="background: linear-gradient(135deg, ${isPositive ? '#10b981, #059669' : '#ef4444, #dc2626'}); color: white; padding: 1.5rem; border-radius: 12px; position: relative; overflow: hidden;">
                      <div style="position: absolute; top: 10px; right: 10px; opacity: 0.3; font-size: 2rem;">${getKPIIcon(key)}</div>
                      <div style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">${formatKPIValue(key, kpi.value)}</div>
                      <div style="opacity: 0.9; margin-bottom: 0.5rem;">${formatKPILabel(key)}</div>
                      <div style="font-size: 0.875rem; display: flex; justify-content: between;">
                        <span>Target: ${formatKPIValue(key, kpi.target)}</span>
                        <span style="font-weight: bold;">${kpi.change}</span>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>

              <!-- Performance Charts -->
              <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                  <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 1rem;">
                    <h3 style="margin: 0; color: #1f2937;">Performance Trends</h3>
                    <div style="display: flex; gap: 0.5rem;">
                      <button onclick="downloadMetricsChart('metricsChart', 'performance_trends')" style="background: #6b7280; color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 6px; cursor: pointer; font-size: 0.875rem;">📥 Download</button>
                      <button onclick="toggleMetricsChartType()" style="background: #3b82f6; color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 6px; cursor: pointer; font-size: 0.875rem;">📊 Toggle Type</button>
                    </div>
                  </div>
                  <div style="height: 300px; background: white; border-radius: 8px; position: relative; overflow: hidden;">
                    <canvas id="metricsChart" width="800" height="300" style="width: 100%; height: 100%; cursor: crosshair;"></canvas>
                  </div>
                </div>

                <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                  <h3 style="margin: 0 0 1rem 0; color: #1f2937;">Goal Progress</h3>
                  <div style="space-y: 1rem;">
                    ${Object.entries(data.kpis).slice(0, 4).map(([key, kpi]) => {
                      const progress = Math.min(100, (kpi.value / kpi.target) * 100);
                      return `
                        <div style="margin-bottom: 1rem;">
                          <div style="display: flex; justify-content: between; margin-bottom: 0.25rem;">
                            <span style="font-size: 0.875rem; font-weight: 500;">${formatKPILabel(key)}</span>
                            <span style="font-size: 0.875rem; color: #6b7280;">${Math.round(progress)}%</span>
                          </div>
                          <div style="background: #e5e7eb; border-radius: 4px; height: 8px; overflow: hidden;">
                            <div style="background: ${progress >= 100 ? '#10b981' : progress >= 80 ? '#f59e0b' : '#ef4444'}; height: 100%; width: ${Math.min(100, progress)}%; border-radius: 4px; transition: width 0.3s ease;"></div>
                          </div>
                        </div>
                      `;
                    }).join('')}
                  </div>
                </div>
              </div>

              <!-- Department Performance -->
              <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 2rem;">
                <h3 style="margin: 0 0 1rem 0; color: #1f2937;">Department Performance Scorecard</h3>
                <div style="overflow-x: auto;">
                  <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                      <tr style="background: #e5e7eb;">
                        <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid #d1d5db;">Department</th>
                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #d1d5db;">Efficiency</th>
                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #d1d5db;">Satisfaction</th>
                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #d1d5db;">Avg Process Time</th>
                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #d1d5db;">Overall</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${data.departmentPerformance.map(dept => {
                        const overall = Math.round((dept.efficiency + (dept.satisfaction * 20) + (100 - dept.processTime * 10)) / 3);
                        return `
                          <tr>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #e5e7eb; font-weight: 500;">${dept.department}</td>
                            <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">
                              <span style="padding: 0.25rem 0.5rem; border-radius: 4px; background: ${dept.efficiency >= 90 ? '#dcfce7' : '#fef3c7'}; color: ${dept.efficiency >= 90 ? '#16a34a' : '#d97706'}; font-weight: 500;">
                                ${dept.efficiency}%
                              </span>
                            </td>
                            <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">⭐ ${dept.satisfaction}</td>
                            <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">${dept.processTime} days</td>
                            <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">
                              <div style="display: flex; align-items: center; justify-content: center;">
                                ${getPerformanceBadge(overall)}
                                <span style="margin-left: 0.5rem; font-weight: 500;">${overall}%</span>
                              </div>
                            </td>
                          </tr>
                        `;
                      }).join('')}
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- Action Center -->
              <div style="margin-top: 2rem; padding: 1.5rem; background: #f1f5f9; border-radius: 12px;">
                <h3 style="margin: 0 0 1rem 0;">Performance Actions</h3>
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                  <button onclick="generatePerformanceReport()" style="background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">📈 Generate Report</button>
                  <button onclick="setKPIAlerts()" style="background: #f59e0b; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">🔔 Set Alerts</button>
                  <button onclick="compareTimeperiods()" style="background: #8b5cf6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">📊 Compare Periods</button>
                  <button onclick="exportKPIs('dashboard')" style="background: #059669; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">📤 Export Dashboard</button>
                  <button onclick="generateKPIInsights()" style="background: #dc2626; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">🤖 AI Insights</button>
                  <button onclick="scheduleMetricsReport()" style="background: #10b981; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">⏰ Schedule</button>
                </div>
              </div>

            </div>
          </div>
        </div>
      `;
    }

    // Utility functions for KPI formatting
    function getKPIIcon(key) {
      const icons = {
        applicationCompletionRate: '✅',
        averageProcessingTime: '⏱️',
        studentSatisfaction: '😊',
        yieldRate: '🎯',
        retentionRate: '🔗',
        costPerApplication: '💰'
      };
      return icons[key] || '📊';
    }

    function formatKPIValue(key, value) {
      if (key.includes('Rate') || key.includes('Completion')) return value + '%';
      if (key.includes('Time')) return value + ' days';
      if (key.includes('Cost')) return '$' + value;
      if (key.includes('Satisfaction')) return value + '/5';
      return value;
    }

    function formatKPILabel(key) {
      return key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase()).trim();
    }

    function getPerformanceBadge(score) {
      if (score >= 90) return '🟢';
      if (score >= 75) return '🟡';
      return '🔴';
    }

    // Performance Metrics Functionality
    let performanceData = null;
    let metricsChartType = 'line';

    function initializePerformanceFeatures() {
      setTimeout(() => {
        if (document.getElementById('metricsChart')) {
          drawPerformanceChart();
          setupMetricsRealTime();
          updateLastMetricsTime();
        }
      }, 100);
    }

    function drawPerformanceChart() {
      const canvas = document.getElementById('metricsChart');
      if (!canvas) return;

      const ctx = canvas.getContext('2d');
      const width = canvas.width;
      const height = canvas.height;
      const padding = 60;

      ctx.clearRect(0, 0, width, height);

      // Chart background
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0, 0, width, height);

      // Sample data
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
      const applications = [1240, 1567, 1834, 2156, 1978, 2234];
      const satisfaction = [4.2, 4.4, 4.5, 4.6, 4.5, 4.7];
      const processingTime = [2.3, 2.1, 1.9, 2.0, 2.1, 1.8];

      // Normalize satisfaction data for chart display
      const satisfactionNormalized = satisfaction.map(s => s * 500); // Scale for visibility

      const maxValue = Math.max(...applications, ...satisfactionNormalized, ...processingTime.map(t => t * 100));
      const minValue = 0;

      // Grid lines
      ctx.strokeStyle = '#e5e7eb';
      ctx.lineWidth = 1;
      for (let i = 0; i <= 10; i++) {
        const y = padding + (i * (height - 2 * padding)) / 10;
        ctx.beginPath();
        ctx.moveTo(padding, y);
        ctx.lineTo(width - padding, y);
        ctx.stroke();
      }

      // X-axis labels
      ctx.fillStyle = '#6b7280';
      ctx.font = '12px Arial';
      ctx.textAlign = 'center';
      for (let i = 0; i < months.length; i++) {
        const x = padding + (i * (width - 2 * padding)) / (months.length - 1);
        ctx.fillText(months[i], x, height - padding + 20);
      }

      // Draw application volume line
      ctx.strokeStyle = '#3b82f6';
      ctx.lineWidth = 3;
      ctx.beginPath();
      for (let i = 0; i < applications.length; i++) {
        const x = padding + (i * (width - 2 * padding)) / (applications.length - 1);
        const y = padding + (height - 2 * padding) * (1 - applications[i] / maxValue);
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.stroke();

      // Draw satisfaction line
      ctx.strokeStyle = '#10b981';
      ctx.lineWidth = 3;
      ctx.beginPath();
      for (let i = 0; i < satisfactionNormalized.length; i++) {
        const x = padding + (i * (width - 2 * padding)) / (satisfactionNormalized.length - 1);
        const y = padding + (height - 2 * padding) * (1 - satisfactionNormalized[i] / maxValue);
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.stroke();

      // Data points for applications
      ctx.fillStyle = '#3b82f6';
      for (let i = 0; i < applications.length; i++) {
        const x = padding + (i * (width - 2 * padding)) / (applications.length - 1);
        const y = padding + (height - 2 * padding) * (1 - applications[i] / maxValue);
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, 2 * Math.PI);
        ctx.fill();
      }

      // Data points for satisfaction
      ctx.fillStyle = '#10b981';
      for (let i = 0; i < satisfactionNormalized.length; i++) {
        const x = padding + (i * (width - 2 * padding)) / (satisfactionNormalized.length - 1);
        const y = padding + (height - 2 * padding) * (1 - satisfactionNormalized[i] / maxValue);
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, 2 * Math.PI);
        ctx.fill();
      }

      // Legend
      ctx.fillStyle = '#3b82f6';
      ctx.fillRect(width - 180, 20, 15, 3);
      ctx.fillStyle = '#1f2937';
      ctx.font = '12px Arial';
      ctx.textAlign = 'left';
      ctx.fillText('Applications', width - 160, 26);

      ctx.fillStyle = '#10b981';
      ctx.fillRect(width - 180, 40, 15, 3);
      ctx.fillText('Satisfaction', width - 160, 46);
    }

    function toggleMetricsChartType() {
      metricsChartType = metricsChartType === 'line' ? 'bar' : 'line';
      drawPerformanceChart();
      showToast(`📊 Chart type changed to ${metricsChartType}`, 'info', 1500);
    }

    function downloadMetricsChart(chartId, filename) {
      const canvas = document.getElementById(chartId);
      if (canvas) {
        const link = document.createElement('a');
        link.download = `${filename}_${new Date().toISOString().split('T')[0]}.png`;
        link.href = canvas.toDataURL();
        link.click();
        showToast(`📊 Performance chart downloaded as ${filename}.png`, 'success', 2000);
      }
    }

    function refreshMetricsData() {
      showToast('🔄 Refreshing performance metrics...', 'info', 1000);
      setTimeout(() => {
        performanceData = generatePerformanceMetricsData();
        drawPerformanceChart();
        updateLastMetricsTime();
        showToast('✅ Metrics data refreshed!', 'success', 2000);
      }, 1500);
    }

    function updateLastMetricsTime() {
      const lastUpdateElement = document.getElementById('lastMetricsUpdate');
      if (lastUpdateElement) {
        const now = new Date();
        lastUpdateElement.textContent = `Last updated: ${now.toLocaleTimeString()}`;
      }
    }

    function setupMetricsRealTime() {
      setInterval(() => {
        const timeElement = document.getElementById('metricsTime');
        if (timeElement) {
          timeElement.textContent = new Date().toLocaleTimeString();
        }
      }, 1000);
    }

    function generatePerformanceReport() {
      showToast('📈 Generating comprehensive performance report...', 'info', 2000);
      setTimeout(() => {
        const fileSize = Math.round(Math.random() * 800 + 500);
        showToast(`✅ Performance report generated (${fileSize}KB)`, 'success', 2000);
      }, 2000);
    }

    function setKPIAlerts() {
      const alertModal = `
        <div id="kpiAlertsModal" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 15000;">
          <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 600px; width: 90vw; max-height: 80vh; overflow-y: auto;">
            <h3 style="margin: 0 0 1rem 0;">🔔 Set KPI Alerts</h3>

            <div style="margin-bottom: 1.5rem;">
              <h4 style="margin: 0 0 1rem 0; color: #1f2937;">Alert Thresholds</h4>

              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                <div>
                  <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Application Completion Rate</label>
                  <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <span style="font-size: 0.875rem;">Below</span>
                    <input type="number" value="85" style="width: 60px; padding: 0.25rem; border: 1px solid #d1d5db; border-radius: 4px;">
                    <span style="font-size: 0.875rem;">%</span>
                  </div>
                </div>
                <div>
                  <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Processing Time</label>
                  <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <span style="font-size: 0.875rem;">Above</span>
                    <input type="number" value="3" step="0.1" style="width: 60px; padding: 0.25rem; border: 1px solid #d1d5db; border-radius: 4px;">
                    <span style="font-size: 0.875rem;">days</span>
                  </div>
                </div>
              </div>

              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                <div>
                  <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Student Satisfaction</label>
                  <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <span style="font-size: 0.875rem;">Below</span>
                    <input type="number" value="4.0" step="0.1" style="width: 60px; padding: 0.25rem; border: 1px solid #d1d5db; border-radius: 4px;">
                    <span style="font-size: 0.875rem;">/5</span>
                  </div>
                </div>
                <div>
                  <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Yield Rate</label>
                  <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <span style="font-size: 0.875rem;">Below</span>
                    <input type="number" value="35" style="width: 60px; padding: 0.25rem; border: 1px solid #d1d5db; border-radius: 4px;">
                    <span style="font-size: 0.875rem;">%</span>
                  </div>
                </div>
              </div>
            </div>

            <div style="margin-bottom: 1.5rem;">
              <h4 style="margin: 0 0 1rem 0; color: #1f2937;">Notification Settings</h4>
              <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem;">Alert Frequency:</label>
                <select style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                  <option>Immediate</option>
                  <option selected>Daily Summary</option>
                  <option>Weekly Summary</option>
                </select>
              </div>
              <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem;">Email Recipients:</label>
                <input type="email" placeholder="Enter email addresses (comma-separated)" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
              </div>
            </div>

            <div style="display: flex; gap: 1rem; justify-content: end;">
              <button onclick="closeModal('kpiAlertsModal')" style="background: #6b7280; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">Cancel</button>
              <button onclick="saveKPIAlerts()" style="background: #f59e0b; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">🔔 Save Alerts</button>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', alertModal);
    }

    function saveKPIAlerts() {
      closeModal('kpiAlertsModal');
      showToast('🔔 KPI alerts configured successfully!', 'success', 2000);
    }

    function compareTimeperiods() {
      const compareModal = `
        <div id="compareModal" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 15000;">
          <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 700px; width: 90vw; max-height: 80vh; overflow-y: auto;">
            <h3 style="margin: 0 0 1rem 0;">📊 Period Comparison Analysis</h3>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
              <div>
                <h4 style="margin: 0 0 1rem 0; color: #1f2937;">Period A</h4>
                <div style="margin-bottom: 1rem;">
                  <label style="display: block; margin-bottom: 0.5rem;">From:</label>
                  <input type="date" value="2024-01-01" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                </div>
                <div style="margin-bottom: 1rem;">
                  <label style="display: block; margin-bottom: 0.5rem;">To:</label>
                  <input type="date" value="2024-06-30" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                </div>
              </div>

              <div>
                <h4 style="margin: 0 0 1rem 0; color: #1f2937;">Period B</h4>
                <div style="margin-bottom: 1rem;">
                  <label style="display: block; margin-bottom: 0.5rem;">From:</label>
                  <input type="date" value="2023-01-01" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                </div>
                <div style="margin-bottom: 1rem;">
                  <label style="display: block; margin-bottom: 0.5rem;">To:</label>
                  <input type="date" value="2023-06-30" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                </div>
              </div>
            </div>

            <div style="margin-bottom: 1.5rem;">
              <h4 style="margin: 0 0 1rem 0; color: #1f2937;">Comparison Results</h4>
              <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; border: 1px solid #e2e8f0;">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; text-align: center;">
                  <div>
                    <div style="font-weight: 500; color: #1f2937;">Applications</div>
                    <div style="font-size: 1.25rem; font-weight: bold; color: #10b981;">+15%</div>
                  </div>
                  <div>
                    <div style="font-weight: 500; color: #1f2937;">Processing Time</div>
                    <div style="font-size: 1.25rem; font-weight: bold; color: #10b981;">-0.8 days</div>
                  </div>
                  <div>
                    <div style="font-weight: 500; color: #1f2937;">Satisfaction</div>
                    <div style="font-size: 1.25rem; font-weight: bold; color: #10b981;">+0.3</div>
                  </div>
                </div>
              </div>
            </div>

            <div style="display: flex; gap: 1rem; justify-content: end;">
              <button onclick="closeModal('compareModal')" style="background: #6b7280; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">Close</button>
              <button onclick="exportComparison()" style="background: #8b5cf6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">📊 Export Comparison</button>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', compareModal);
    }

    function exportComparison() {
      closeModal('compareModal');
      showToast('📊 Exporting comparison analysis...', 'info', 1500);
      setTimeout(() => {
        showToast('✅ Comparison report exported successfully!', 'success', 2000);
      }, 1500);
    }

    function exportKPIs(type) {
      showToast(`📤 Exporting ${type} data...`, 'info', 1500);
      setTimeout(() => {
        const fileSize = Math.round(Math.random() * 300 + 150);
        showToast(`✅ ${type} exported (${fileSize}KB)`, 'success', 2000);
      }, 1500);
    }

    function generateKPIInsights() {
      const insightsModal = `
        <div id="kpiInsightsModal" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 15000;">
          <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 700px; width: 90vw; max-height: 80vh; overflow-y: auto;">
            <h3 style="margin: 0 0 1rem 0;">🤖 AI Performance Insights</h3>

            <div style="background: #f0f9ff; border: 1px solid #0284c7; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
              <h4 style="margin: 0 0 0.5rem 0; color: #0284c7;">🎯 Key Performance Highlights</h4>
              <ul style="margin: 0.5rem 0; padding-left: 1.2rem; font-size: 0.9rem;">
                <li>Application completion rate is 4% above target - excellent performance</li>
                <li>Processing time reduced by 0.8 days compared to last quarter</li>
                <li>Student satisfaction improved to 4.6/5, exceeding expectations</li>
              </ul>
            </div>

            <div style="background: #fef3c7; border: 1px solid #f59e0b; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
              <h4 style="margin: 0 0 0.5rem 0; color: #f59e0b;">⚠️ Areas Needing Attention</h4>
              <ul style="margin: 0.5rem 0; padding-left: 1.2rem; font-size: 0.9rem;">
                <li>Financial Aid department efficiency at 87% - below optimal</li>
                <li>Cost per application trending upward - monitor budget allocations</li>
                <li>Yield rate improvement slowing - review conversion strategies</li>
              </ul>
            </div>

            <div style="background: #ecfdf5; border: 1px solid #10b981; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
              <h4 style="margin: 0 0 0.5rem 0; color: #10b981;">💡 Strategic Recommendations</h4>
              <ul style="margin: 0.5rem 0; padding-left: 1.2rem; font-size: 0.9rem;">
                <li>Implement process automation in Financial Aid for efficiency gains</li>
                <li>Invest in staff training for departments below 90% efficiency</li>
                <li>Launch targeted engagement campaigns to boost yield rates</li>
                <li>Consider implementing real-time satisfaction tracking</li>
              </ul>
            </div>

            <div style="background: #ede9fe; border: 1px solid #8b5cf6; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
              <h4 style="margin: 0 0 0.5rem 0; color: #8b5cf6;">📊 Predicted Trends</h4>
              <p style="margin: 0; font-size: 0.9rem;">Based on current trends, expect 12% growth in applications next quarter with 95% confidence. Processing efficiency should reach 94% by end of year with proper interventions.</p>
            </div>

            <div style="display: flex; gap: 1rem; justify-content: end;">
              <button onclick="closeModal('kpiInsightsModal')" style="background: #6b7280; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">Close</button>
              <button onclick="exportKPIInsights()" style="background: #dc2626; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">📄 Export Insights</button>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', insightsModal);
    }

    function exportKPIInsights() {
      closeModal('kpiInsightsModal');
      showToast('📄 Exporting AI insights report...', 'info', 1500);
      setTimeout(() => {
        showToast('✅ Insights report exported successfully!', 'success', 2000);
      }, 1500);
    }

    function scheduleMetricsReport() {
      const scheduleModal = `
        <div id="scheduleMetricsModal" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 15000;">
          <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 500px; width: 90vw;">
            <h3 style="margin: 0 0 1rem 0;">⏰ Schedule Performance Reports</h3>
            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem;">Report Frequency:</label>
              <select style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                <option>Daily</option>
                <option selected>Weekly</option>
                <option>Monthly</option>
                <option>Quarterly</option>
              </select>
            </div>
            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem;">Report Type:</label>
              <select style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                <option selected>Full KPI Dashboard</option>
                <option>Executive Summary</option>
                <option>Department Performance</option>
                <option>Trend Analysis</option>
              </select>
            </div>
            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem;">Recipients:</label>
              <input type="email" placeholder="Enter email addresses" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
            </div>
            <div style="display: flex; gap: 1rem; justify-content: end;">
              <button onclick="closeModal('scheduleMetricsModal')" style="background: #6b7280; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">Cancel</button>
              <button onclick="saveMetricsSchedule()" style="background: #10b981; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">⏰ Schedule</button>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', scheduleModal);
    }

    function saveMetricsSchedule() {
      closeModal('scheduleMetricsModal');
      showToast('⏰ Performance report scheduled successfully!', 'success', 2000);
    }

    function toggleMetricsFullscreen() {
      const modal = document.getElementById('performanceModal');
      const button = document.querySelector('[onclick="toggleMetricsFullscreen()"]');

      if (modal) {
        const isFullscreen = modal.getAttribute('data-fullscreen') === 'true';

        if (isFullscreen) {
          modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 95vw; height: 90vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;';
          modal.setAttribute('data-fullscreen', 'false');
          if (button) button.innerHTML = '🖥️ Fullscreen';
          showToast('📱 Exited fullscreen mode', 'info', 1500);
        } else {
          modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center; z-index: 10000;';
          modal.setAttribute('data-fullscreen', 'true');
          if (button) button.innerHTML = '📱 Exit Fullscreen';
          showToast('🖥️ Entered fullscreen mode', 'info', 1500);
        }

        const modalContent = modal.querySelector('div[style*="background: white"]');
        if (modalContent) {
          if (isFullscreen) {
            modalContent.style.width = '95vw';
            modalContent.style.height = '90vh';
            modalContent.style.borderRadius = '16px';
          } else {
            modalContent.style.width = '100vw';
            modalContent.style.height = '100vh';
            modalContent.style.borderRadius = '0';
          }
        }
      }
    }

    // More functions will be added for other features...

    // Utility functions
    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.remove();
      }
    }

    function drawLineChart(canvas, data) {
      const ctx = canvas.getContext('2d');
      const width = canvas.width;
      const height = canvas.height;

      // Clear canvas
      ctx.clearRect(0, 0, width, height);

      // Simple line chart implementation
      ctx.strokeStyle = '#3b82f6';
      ctx.lineWidth = 2;
      ctx.beginPath();

      const currentYear = new Date().getFullYear();
      const values = data[currentYear];
      const step = width / (values.length - 1);

      values.forEach((value, index) => {
        const x = index * step;
        const y = height - (value / Math.max(...values)) * height * 0.8;

        if (index === 0) {
          ctx.moveTo(x, y);
        } else {
          ctx.lineTo(x, y);
        }
      });

      ctx.stroke();

      // Add title
      ctx.fillStyle = '#1f2937';
      ctx.font = '14px Arial';
      ctx.fillText('Application Trends', 10, 20);
    }

    function drawPieChart(canvas, data) {
      const ctx = canvas.getContext('2d');
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const radius = Math.min(centerX, centerY) - 20;

      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Simple pie chart
      const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444'];
      const values = [data.domestic, data.international, data.undergraduate, data.graduate];
      const total = values.reduce((a, b) => a + b, 0);

      let currentAngle = 0;
      values.forEach((value, index) => {
        const sliceAngle = (value / total) * 2 * Math.PI;

        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
        ctx.lineTo(centerX, centerY);
        ctx.fillStyle = colors[index % colors.length];
        ctx.fill();

        currentAngle += sliceAngle;
      });

      // Add title
      ctx.fillStyle = '#1f2937';
      ctx.font = '14px Arial';
      ctx.fillText('Demographics', 10, 20);
    }

    // Advanced Functional Features for Application Trends
    function downloadChart(chartId, filename) {
      const canvas = document.getElementById(chartId);
      if (canvas) {
        // Create download link
        const link = document.createElement('a');
        link.download = `${filename}_${new Date().toISOString().split('T')[0]}.png`;
        link.href = canvas.toDataURL();
        link.click();
        showToast(`📊 Chart downloaded as ${filename}.png`, 'success', 2000);
      }
    }

    function toggleChartType(chartId) {
      const chartData = trendsCharts[chartId];
      if (chartData && chartData.type === 'line') {
        // Convert to bar chart
        drawBarChart(chartData.canvas, chartData.data);
        trendsCharts[chartId].type = 'bar';
        showToast('📊 Switched to bar chart view', 'info', 2000);
      } else if (chartData && chartData.type === 'bar') {
        // Convert back to line chart
        drawAdvancedLineChart(chartData.canvas, chartData.data);
        trendsCharts[chartId].type = 'line';
        showToast('📈 Switched to line chart view', 'info', 2000);
      }
    }

    function animateChart(chartId) {
      const chartData = trendsCharts[chartId];
      if (chartData && chartData.type === 'pie') {
        animatePieChart(chartData.canvas, chartData.data);
        showToast('🎬 Chart animation started!', 'info', 2000);
      }
    }

    function drawBarChart(canvas, data) {
      const ctx = canvas.getContext('2d');
      const width = canvas.width;
      const height = canvas.height;
      const padding = 60;

      // Clear canvas
      ctx.clearRect(0, 0, width, height);

      const currentYear = new Date().getFullYear();
      const currentData = data[currentYear] || [];
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

      if (currentData.length === 0) return;

      const maxValue = Math.max(...currentData);
      const barWidth = (width - padding * 2) / currentData.length * 0.8;
      const barSpacing = (width - padding * 2) / currentData.length * 0.2;

      // Draw bars
      currentData.forEach((value, index) => {
        const barHeight = (value / maxValue) * (height - padding * 2);
        const x = padding + index * (barWidth + barSpacing);
        const y = height - padding - barHeight;

        // Draw bar
        ctx.fillStyle = '#3b82f6';
        ctx.fillRect(x, y, barWidth, barHeight);

        // Draw value on top
        ctx.fillStyle = '#1f2937';
        ctx.font = '12px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(value.toLocaleString(), x + barWidth / 2, y - 5);

        // Draw month label
        ctx.fillText(months[index], x + barWidth / 2, height - padding + 20);
      });

      // Add title
      ctx.fillStyle = '#1f2937';
      ctx.font = 'bold 14px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Monthly Application Volume (Bar View)', width / 2, 25);
    }

    function animatePieChart(canvas, data) {
      const ctx = canvas.getContext('2d');
      let animationProgress = 0;
      const animationDuration = 2000; // 2 seconds
      const startTime = Date.now();

      function animate() {
        const elapsed = Date.now() - startTime;
        animationProgress = Math.min(elapsed / animationDuration, 1);

        // Clear and redraw with animation
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = Math.min(centerX, centerY) - 30;

        const total = data.domestic + data.international + data.undergraduate + data.graduate;
        const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444'];
        const labels = ['Domestic', 'International', 'Undergraduate', 'Graduate'];
        const values = [data.domestic, data.international, data.undergraduate, data.graduate];

        let currentAngle = -Math.PI / 2;

        values.forEach((value, index) => {
          const sliceAngle = (value / total) * 2 * Math.PI * animationProgress;

          ctx.beginPath();
          ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
          ctx.lineTo(centerX, centerY);
          ctx.fillStyle = colors[index];
          ctx.fill();

          ctx.strokeStyle = '#ffffff';
          ctx.lineWidth = 2;
          ctx.stroke();

          currentAngle += sliceAngle;
        });

        if (animationProgress < 1) {
          requestAnimationFrame(animate);
        } else {
          // Redraw final chart with labels
          drawInteractivePieChart(canvas, data);
        }
      }

      animate();
    }

    function generateTrendInsights() {
      showToast('🔍 Generating AI-powered insights...', 'info', 2000);

      setTimeout(() => {
        const insights = [
          "📈 Application growth is 23% higher than the industry average",
          "🎯 Computer Science applications show strongest growth (+18%)",
          "🌍 International applications increased 8% this quarter",
          "📅 March consistently shows peak application volume",
          "💡 Recommend increasing recruitment efforts in Europe region"
        ];

        const modal = document.createElement('div');
        modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 15000;';
        modal.innerHTML = `
          <div style="background: white; width: 600px; max-height: 80vh; border-radius: 16px; overflow: hidden;">
            <div style="background: linear-gradient(135deg, #5a5bb8, #6b6ce8); color: white; padding: 1.5rem;">
              <h2 style="margin: 0; font-size: 1.25rem;">🤖 AI-Generated Insights</h2>
            </div>
            <div style="padding: 2rem;">
              <div style="margin-bottom: 1.5rem;">
                ${insights.map(insight => `
                  <div style="padding: 1rem; margin-bottom: 1rem; background: #f8fafc; border-radius: 8px; border-left: 4px solid #3b82f6;">
                    ${insight}
                  </div>
                `).join('')}
              </div>
              <div style="text-align: center;">
                <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: #3b82f6; color: white; border: none; padding: 0.75rem 2rem; border-radius: 8px; cursor: pointer;">Close Insights</button>
              </div>
            </div>
          </div>
        `;
        document.body.appendChild(modal);
        showToast('🤖 AI insights generated successfully!', 'success', 2000);
      }, 2000);
    }

    function compareWithLastYear() {
      showToast('📅 Loading year-over-year comparison...', 'info', 2000);

      setTimeout(() => {
        const modal = document.createElement('div');
        modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 15000;';
        modal.innerHTML = `
          <div style="background: white; width: 80vw; max-height: 80vh; border-radius: 16px; overflow: hidden;">
            <div style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; padding: 1.5rem; display: flex; justify-content: between; align-items: center;">
              <h2 style="margin: 0; font-size: 1.25rem;">📅 Year-over-Year Comparison</h2>
              <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">✕ Close</button>
            </div>
            <div style="padding: 2rem; overflow-y: auto;">
              <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
                <div style="text-align: center; padding: 1.5rem; background: #f8fafc; border-radius: 12px;">
                  <div style="font-size: 2rem; font-weight: bold; color: #22c55e;">+15.3%</div>
                  <div style="color: #6b7280;">Overall Growth</div>
                </div>
                <div style="text-align: center; padding: 1.5rem; background: #f8fafc; border-radius: 12px;">
                  <div style="font-size: 2rem; font-weight: bold; color: #3b82f6;">2,847</div>
                  <div style="color: #6b7280;">Average Monthly</div>
                </div>
                <div style="text-align: center; padding: 1.5rem; background: #f8fafc; border-radius: 12px;">
                  <div style="font-size: 2rem; font-weight: bold; color: #f59e0b;">Q1</div>
                  <div style="color: #6b7280;">Peak Quarter</div>
                </div>
              </div>
              <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px;">
                <h3 style="margin: 0 0 1rem 0;">Monthly Comparison</h3>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem;">
                  ${['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'].map((month, index) => {
                    const current = applicationTrendsData.yearOverYear[new Date().getFullYear()][index];
                    const previous = applicationTrendsData.yearOverYear[new Date().getFullYear() - 1][index];
                    const change = ((current - previous) / previous * 100).toFixed(1);
                    const isPositive = change > 0;

                    return `
                      <div style="padding: 1rem; background: white; border-radius: 8px; text-align: center;">
                        <div style="font-weight: bold; margin-bottom: 0.5rem;">${month}</div>
                        <div style="font-size: 0.875rem; color: #6b7280;">${current.toLocaleString()}</div>
                        <div style="font-size: 0.75rem; color: ${isPositive ? '#22c55e' : '#ef4444'}; font-weight: bold;">
                          ${isPositive ? '+' : ''}${change}%
                        </div>
                      </div>
                    `;
                  }).join('')}
                </div>
              </div>
            </div>
          </div>
        `;
        document.body.appendChild(modal);
        showToast('📊 Year-over-year comparison loaded!', 'success', 2000);
      }, 2000);
    }

    function forecastNextQuarter() {
      showToast('🔮 Running AI forecast models...', 'info', 2000);

      setTimeout(() => {
        const modal = document.createElement('div');
        modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 15000;';
        modal.innerHTML = `
          <div style="background: white; width: 70vw; max-height: 80vh; border-radius: 16px; overflow: hidden;">
            <div style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 1.5rem; display: flex; justify-content: between; align-items: center;">
              <h2 style="margin: 0; font-size: 1.25rem;">🔮 Next Quarter Forecast</h2>
              <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">✕ Close</button>
            </div>
            <div style="padding: 2rem;">
              <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
                <div style="text-align: center; padding: 1.5rem; background: #f0fdf4; border-radius: 12px; border: 1px solid #bbf7d0;">
                  <div style="font-size: 2rem; font-weight: bold; color: #16a34a;">8,945</div>
                  <div style="color: #16a34a; font-weight: 500;">Predicted Applications</div>
                  <div style="font-size: 0.875rem; color: #6b7280;">+12% vs last quarter</div>
                </div>
                <div style="text-align: center; padding: 1.5rem; background: #eff6ff; border-radius: 12px; border: 1px solid #bfdbfe;">
                  <div style="font-size: 2rem; font-weight: bold; color: #2563eb;">89%</div>
                  <div style="color: #2563eb; font-weight: 500;">Confidence Level</div>
                  <div style="font-size: 0.875rem; color: #6b7280;">High accuracy</div>
                </div>
                <div style="text-align: center; padding: 1.5rem; background: #fef3c7; border-radius: 12px; border: 1px solid #fcd34d;">
                  <div style="font-size: 2rem; font-weight: bold; color: #d97706;">Q2</div>
                  <div style="color: #d97706; font-weight: 500;">Peak Month</div>
                  <div style="font-size: 0.875rem; color: #6b7280;">May 2024</div>
                </div>
              </div>
              <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px;">
                <h3 style="margin: 0 0 1rem 0;">Key Forecast Factors</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                  <div style="padding: 1rem; background: white; border-radius: 8px;">
                    <div style="font-weight: bold; color: #22c55e;">✅ Positive Indicators</div>
                    <ul style="margin: 0.5rem 0 0 0; padding-left: 1.5rem; color: #6b7280; font-size: 0.875rem;">
                      <li>Improved marketing campaigns</li>
                      <li>New program launches</li>
                      <li>Economic recovery trends</li>
                    </ul>
                  </div>
                  <div style="padding: 1rem; background: white; border-radius: 8px;">
                    <div style="font-weight: bold; color: #f59e0b;">⚠️ Risk Factors</div>
                    <ul style="margin: 0.5rem 0 0 0; padding-left: 1.5rem; color: #6b7280; font-size: 0.875rem;">
                      <li>Increased competition</li>
                      <li>Policy changes</li>
                      <li>Seasonal variations</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
        document.body.appendChild(modal);
        showToast('🔮 Forecast completed with 89% confidence!', 'success', 2000);
      }, 2000);
    }

    function exportDetailedAnalysis() {
      showToast('📋 Preparing detailed analysis report...', 'info', 2000);

      setTimeout(() => {
        const reportData = {
          charts: document.getElementById('includeCharts').checked,
          rawData: document.getElementById('includeData').checked,
          insights: document.getElementById('includeInsights').checked
        };

        let fileSize = '2.1MB';
        if (reportData.charts) fileSize = '3.7MB';
        if (reportData.insights) fileSize = '4.2MB';

        showToast(`📊 Detailed analysis exported (${fileSize}) - Download started!`, 'success', 3000);
      }, 2000);
    }

    function printTrendsReport() {
      showToast('🖨️ Preparing report for printing...', 'info', 2000);
      // Simulate print preparation
      setTimeout(() => {
        window.print();
      }, 2000);
    }

    function shareTrendsReport() {
      showToast('📤 Opening share options...', 'info', 1000);

      const modal = document.createElement('div');
      modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 15000;';
      modal.innerHTML = `
        <div style="background: white; width: 400px; border-radius: 16px; overflow: hidden;">
          <div style="background: linear-gradient(135deg, #059669, #047857); color: white; padding: 1.5rem;">
            <h2 style="margin: 0; font-size: 1.25rem;">📤 Share Report</h2>
          </div>
          <div style="padding: 2rem;">
            <div style="margin-bottom: 1.5rem;">
              <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Share via Email</label>
              <input type="email" placeholder="Enter email addresses..." style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 8px;">
            </div>
            <div style="margin-bottom: 1.5rem;">
              <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Message (Optional)</label>
              <textarea placeholder="Add a message..." style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 8px; resize: vertical;" rows="3"></textarea>
            </div>
            <div style="display: flex; gap: 1rem;">
              <button onclick="this.parentElement.parentElement.parentElement.remove()" style="flex: 1; background: #6b7280; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer;">Cancel</button>
              <button onclick="sendTrendsReport(); this.parentElement.parentElement.parentElement.remove();" style="flex: 1; background: #059669; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer;">Send Report</button>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function sendTrendsReport() {
      showToast('📧 Report shared successfully!', 'success', 2000);
    }

    // Export and action functions
    function exportTrendsReport(format) {
      const reportOptions = {
        charts: document.getElementById('includeCharts').checked,
        rawData: document.getElementById('includeData').checked,
        insights: document.getElementById('includeInsights').checked
      };

      showToast(`📊 Exporting Application Trends report as ${format.toUpperCase()}...`, 'info', 2000);

      setTimeout(() => {
        let fileSize;
        switch(format) {
          case 'pdf': fileSize = reportOptions.charts ? '2.3MB' : '850KB'; break;
          case 'excel': fileSize = reportOptions.rawData ? '1.8MB' : '1.2MB'; break;
          case 'csv': fileSize = '850KB'; break;
          default: fileSize = '1MB';
        }

        showToast(`✅ ${format.toUpperCase()} export completed (${fileSize}) - Download started!`, 'success', 3000);
      }, 2000);
    }

    function scheduleTrendsReport() {
      showToast('📅 Opening report scheduling interface...', 'info', 1000);

      const modal = document.createElement('div');
      modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 15000;';
      modal.innerHTML = `
        <div style="background: white; width: 500px; border-radius: 16px; overflow: hidden;">
          <div style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 1.5rem;">
            <h2 style="margin: 0; font-size: 1.25rem;">⏰ Schedule Report</h2>
          </div>
          <div style="padding: 2rem;">
            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Frequency</label>
              <select style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 8px;">
                <option>Weekly</option>
                <option>Monthly</option>
                <option>Quarterly</option>
              </select>
            </div>
            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Recipients</label>
              <input type="email" placeholder="Enter email addresses..." style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 8px;">
            </div>
            <div style="margin-bottom: 1.5rem;">
              <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Start Date</label>
              <input type="date" style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 8px;">
            </div>
            <div style="display: flex; gap: 1rem;">
              <button onclick="this.parentElement.parentElement.parentElement.remove()" style="flex: 1; background: #6b7280; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer;">Cancel</button>
              <button onclick="createSchedule(); this.parentElement.parentElement.parentElement.remove();" style="flex: 1; background: #f59e0b; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer;">Schedule Report</button>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function createSchedule() {
      showToast('⏰ Report scheduled successfully! You will receive confirmation via email.', 'success', 3000);
    }

    function recalculateForecast() {
      showToast('🔄 Recalculating forecast with updated parameters...', 'info', 3000);
      // Implementation would update the forecast
    }

    function exportForecast(format) {
      showToast(`📈 Exporting enrollment forecast as ${format.toUpperCase()}...`, 'info', 3000);
      // Implementation would handle export
    }

    function shareForecast() {
      showToast('📤 Opening share options for forecast report...', 'info', 2000);
      // Implementation would show share modal
    }

    function generatePerformanceReport() {
      showToast('📊 Generating comprehensive performance report...', 'info', 3000);
      // Implementation would generate report
    }

    function setKPIAlerts() {
      showToast('🔔 Opening KPI alert configuration...', 'info', 2000);
      // Implementation would show alert setup
    }

    function compareTimeperiods() {
      showToast('📊 Loading time period comparison tool...', 'info', 2000);
      // Implementation would show comparison interface
    }

    function exportKPIs(type) {
      showToast(`📤 Exporting ${type} data...`, 'info', 3000);
      // Implementation would handle export
    }

    // 4. Custom Report Builder with Drag-and-Drop Interface
    function openCustomReportBuilder() {
      showToast('🔧 Loading Custom Report Builder...', 'info', 2000);

      setTimeout(() => {
        const modalHtml = createCustomReportBuilderModal();
        document.body.insertAdjacentHTML('beforeend', modalHtml);
        initializeReportBuilder();
      }, 1000);
    }

    function createCustomReportBuilderModal() {
      return `
        <div id="reportBuilderModal" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;">
          <div style="background: white; width: 98vw; height: 95vh; border-radius: 16px; overflow: hidden; display: flex; flex-direction: column;">
            <div style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; padding: 1.5rem; display: flex; justify-content: between; align-items: center;">
              <h2 style="margin: 0; font-size: 1.5rem;">🔧 Custom Report Builder</h2>
              <button onclick="closeModal('reportBuilderModal')" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">✕ Close</button>
            </div>
            <div style="flex: 1; display: grid; grid-template-columns: 250px 1fr 300px; overflow: hidden;">

              <!-- Left Sidebar - Components -->
              <div style="background: #f8fafc; border-right: 1px solid #e2e8f0; padding: 1rem; overflow-y: auto;">
                <h3 style="margin: 0 0 1rem 0; color: #1f2937;">Report Components</h3>

                <div style="margin-bottom: 1.5rem;">
                  <h4 style="margin: 0 0 0.5rem 0; color: #6b7280; font-size: 0.875rem; text-transform: uppercase;">Data Sources</h4>
                  <div class="draggable-item" data-type="data-source" data-source="applications" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    📊 Applications Data
                  </div>
                  <div class="draggable-item" data-type="data-source" data-source="enrollments" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    🎓 Enrollments Data
                  </div>
                  <div class="draggable-item" data-type="data-source" data-source="demographics" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    👥 Demographics Data
                  </div>
                  <div class="draggable-item" data-type="data-source" data-source="financial" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    💰 Financial Data
                  </div>
                </div>

                <div style="margin-bottom: 1.5rem;">
                  <h4 style="margin: 0 0 0.5rem 0; color: #6b7280; font-size: 0.875rem; text-transform: uppercase;">Visualizations</h4>
                  <div class="draggable-item" data-type="chart" data-chart="bar" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    📊 Bar Chart
                  </div>
                  <div class="draggable-item" data-type="chart" data-chart="line" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    📈 Line Chart
                  </div>
                  <div class="draggable-item" data-type="chart" data-chart="pie" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    🥧 Pie Chart
                  </div>
                  <div class="draggable-item" data-type="chart" data-chart="table" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    📋 Data Table
                  </div>
                  <div class="draggable-item" data-type="chart" data-chart="kpi" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    📌 KPI Card
                  </div>
                </div>

                <div>
                  <h4 style="margin: 0 0 0.5rem 0; color: #6b7280; font-size: 0.875rem; text-transform: uppercase;">Filters</h4>
                  <div class="draggable-item" data-type="filter" data-filter="date" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    📅 Date Range
                  </div>
                  <div class="draggable-item" data-type="filter" data-filter="program" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    🎯 Program Filter
                  </div>
                  <div class="draggable-item" data-type="filter" data-filter="geography" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    🌍 Geography Filter
                  </div>
                </div>
              </div>

              <!-- Center Canvas - Report Builder -->
              <div style="background: white; padding: 2rem; overflow-y: auto;">
                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 2rem;">
                  <h3 style="margin: 0; color: #1f2937;">Report Canvas</h3>
                  <div style="display: flex; gap: 1rem;">
                    <button onclick="previewReport()" style="background: #3b82f6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">👁️ Preview</button>
                    <button onclick="saveReport()" style="background: #059669; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">💾 Save</button>
                  </div>
                </div>

                <div id="reportCanvas" style="min-height: 600px; border: 2px dashed #d1d5db; border-radius: 12px; padding: 2rem; background: #fafafa;">
                  <div style="text-align: center; color: #6b7280; padding: 4rem 2rem;">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">🎨</div>
                    <h3 style="margin: 0 0 1rem 0;">Drag components here to build your report</h3>
                    <p style="margin: 0; font-size: 0.875rem;">Start by dragging a data source or visualization from the left panel</p>
                  </div>
                </div>
              </div>

              <!-- Right Sidebar - Properties -->
              <div style="background: #f8fafc; border-left: 1px solid #e2e8f0; padding: 1rem; overflow-y: auto;">
                <h3 style="margin: 0 0 1rem 0; color: #1f2937;">Properties</h3>

                <div id="propertiesPanel" style="color: #6b7280; text-align: center; padding: 2rem 1rem;">
                  <div style="font-size: 2rem; margin-bottom: 1rem;">⚙️</div>
                  <p style="margin: 0; font-size: 0.875rem;">Select a component to view its properties</p>
                </div>
              </div>

            </div>

            <!-- Bottom Toolbar -->
            <div style="background: #f8fafc; border-top: 1px solid #e2e8f0; padding: 1rem; display: flex; justify-content: between; align-items: center;">
              <div style="display: flex; gap: 1rem;">
                <button onclick="clearCanvas()" style="background: #ef4444; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">🗑️ Clear</button>
                <button onclick="undoAction()" style="background: #6b7280; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">↶ Undo</button>
                <button onclick="redoAction()" style="background: #6b7280; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">↷ Redo</button>
              </div>
              <div style="display: flex; gap: 1rem;">
                <button onclick="loadTemplate()" style="background: #f59e0b; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">📋 Load Template</button>
                <button onclick="exportReport('pdf')" style="background: #8b5cf6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">📄 Export PDF</button>
                <button onclick="scheduleReport()" style="background: #10b981; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">⏰ Schedule</button>
              </div>
            </div>

          </div>
        </div>
      `;
    }

    function initializeReportBuilder() {
      // Add drag and drop functionality
      const draggableItems = document.querySelectorAll('.draggable-item');
      const canvas = document.getElementById('reportCanvas');

      draggableItems.forEach(item => {
        item.addEventListener('dragstart', handleDragStart);
      });

      canvas.addEventListener('dragover', handleDragOver);
      canvas.addEventListener('drop', handleDrop);

      showToast('🎨 Report Builder initialized! Drag components to the canvas to start building.', 'success', 4000);
    }

    function handleDragStart(e) {
      e.dataTransfer.setData('text/plain', JSON.stringify({
        type: e.target.dataset.type,
        source: e.target.dataset.source,
        chart: e.target.dataset.chart,
        filter: e.target.dataset.filter,
        text: e.target.textContent
      }));
      e.target.style.opacity = '0.5';
    }

    function handleDragOver(e) {
      e.preventDefault();
    }

    function handleDrop(e) {
      e.preventDefault();
      const data = JSON.parse(e.dataTransfer.getData('text/plain'));
      addComponentToCanvas(data, e.clientX, e.clientY);
    }

    function addComponentToCanvas(data, x, y) {
      const canvas = document.getElementById('reportCanvas');

      // Clear empty state if this is the first component
      if (canvas.children.length === 1 && canvas.children[0].style.textAlign === 'center') {
        canvas.innerHTML = '';
      }

      const component = document.createElement('div');
      component.className = 'report-component';
      component.style.cssText = `
        background: white;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        padding: 1rem;
        margin: 1rem 0;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
      `;

      component.innerHTML = createComponentHTML(data);
      component.onclick = () => selectComponent(component, data);

      canvas.appendChild(component);
      showToast(`✅ Added ${data.text} to report`, 'success', 2000);
    }

    function createComponentHTML(data) {
      switch(data.type) {
        case 'data-source':
          return `
            <div style="display: flex; align-items: center; gap: 1rem;">
              <div style="font-size: 2rem;">📊</div>
              <div>
                <h4 style="margin: 0; color: #1f2937;">${data.text}</h4>
                <p style="margin: 0; color: #6b7280; font-size: 0.875rem;">Data source connected</p>
              </div>
            </div>
          `;
        case 'chart':
          return `
            <div style="text-align: center; padding: 2rem;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">${getChartIcon(data.chart)}</div>
              <h4 style="margin: 0; color: #1f2937;">${data.text}</h4>
              <p style="margin: 0.5rem 0 0 0; color: #6b7280; font-size: 0.875rem;">Configure data binding in properties</p>
            </div>
          `;
        case 'filter':
          return `
            <div style="display: flex; align-items: center; gap: 1rem; padding: 0.5rem;">
              <div style="font-size: 1.5rem;">${getFilterIcon(data.filter)}</div>
              <div>
                <h4 style="margin: 0; color: #1f2937; font-size: 0.875rem;">${data.text}</h4>
                <p style="margin: 0; color: #6b7280; font-size: 0.75rem;">Interactive filter</p>
              </div>
            </div>
          `;
        default:
          return `<div>${data.text}</div>`;
      }
    }

    function getChartIcon(type) {
      const icons = {
        bar: '📊',
        line: '📈',
        pie: '🥧',
        table: '📋',
        kpi: '📌'
      };
      return icons[type] || '📊';
    }

    function getFilterIcon(type) {
      const icons = {
        date: '📅',
        program: '🎯',
        geography: '🌍'
      };
      return icons[type] || '🔍';
    }

    function selectComponent(component, data) {
      // Remove previous selections
      document.querySelectorAll('.report-component').forEach(c => {
        c.style.borderColor = '#e2e8f0';
      });

      // Select current component
      component.style.borderColor = '#3b82f6';
      showComponentProperties(data);
    }

    function showComponentProperties(data) {
      const panel = document.getElementById('propertiesPanel');
      panel.innerHTML = `
        <h4 style="margin: 0 0 1rem 0; color: #1f2937;">${data.text}</h4>

        <div style="text-align: left;">
          <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem; font-weight: 500;">Title</label>
            <input type="text" value="${data.text}" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 4px; font-size: 0.875rem;">
          </div>

          ${data.type === 'chart' ? `
            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem; font-weight: 500;">Data Source</label>
              <select style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 4px; font-size: 0.875rem;">
                <option>Applications Data</option>
                <option>Enrollments Data</option>
                <option>Demographics Data</option>
                <option>Financial Data</option>
              </select>
            </div>

            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem; font-weight: 500;">X-Axis</label>
              <select style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 4px; font-size: 0.875rem;">
                <option>Date</option>
                <option>Program</option>
                <option>Geography</option>
                <option>Status</option>
              </select>
            </div>

            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem; font-weight: 500;">Y-Axis</label>
              <select style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 4px; font-size: 0.875rem;">
                <option>Count</option>
                <option>Percentage</option>
                <option>Average</option>
                <option>Sum</option>
              </select>
            </div>
          ` : ''}

          <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem; font-weight: 500;">Width</label>
            <select style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 4px; font-size: 0.875rem;">
              <option>Full Width</option>
              <option>Half Width</option>
              <option>Third Width</option>
            </select>
          </div>

          <div style="margin-bottom: 1rem;">
            <button onclick="updateComponent()" style="width: 100%; background: #3b82f6; color: white; border: none; padding: 0.5rem; border-radius: 4px; cursor: pointer;">Update Component</button>
          </div>

          <div>
            <button onclick="deleteComponent()" style="width: 100%; background: #ef4444; color: white; border: none; padding: 0.5rem; border-radius: 4px; cursor: pointer;">Delete Component</button>
          </div>
        </div>
      `;
    }

    // 5. Real-time Dashboard with Interactive Charts
    function openRealtimeDashboard() {
      showToast('⚡ Loading Real-time Analytics Dashboard...', 'info', 2000);

      setTimeout(() => {
        const dashboardData = generateRealtimeDashboardData();
        const modalHtml = createRealtimeDashboardModal(dashboardData);
        document.body.insertAdjacentHTML('beforeend', modalHtml);
        startRealtimeUpdates();
      }, 1000);
    }

    function generateRealtimeDashboardData() {
      return {
        liveMetrics: {
          onlineUsers: Math.floor(Math.random() * 500) + 100,
          activeApplications: Math.floor(Math.random() * 50) + 10,
          systemLoad: Math.floor(Math.random() * 100),
          responseTime: (Math.random() * 2 + 0.5).toFixed(1)
        },
        realTimeCharts: {
          applicationRate: generateTimeSeriesData(24),
          systemPerformance: generateTimeSeriesData(24),
          userActivity: generateTimeSeriesData(24)
        },
        alerts: [
          { type: 'info', message: 'New application submitted', time: '2 min ago' },
          { type: 'warning', message: 'High server load detected', time: '5 min ago' },
          { type: 'success', message: 'Batch process completed', time: '8 min ago' }
        ]
      };
    }

    function generateTimeSeriesData(points) {
      const data = [];
      const now = new Date();
      for (let i = points - 1; i >= 0; i--) {
        const time = new Date(now.getTime() - i * 60 * 60 * 1000);
        data.push({
          time: time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
          value: Math.floor(Math.random() * 100) + 20
        });
      }
      return data;
    }

    function createRealtimeDashboardModal(data) {
      return `
        <div id="realtimeDashboardModal" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;">
          <div style="background: white; width: 98vw; height: 95vh; border-radius: 16px; overflow: hidden; display: flex; flex-direction: column;">
            <div style="background: linear-gradient(135deg, #ef4444, #dc2626); color: white; padding: 1.5rem; display: flex; justify-content: between; align-items: center;">
              <div style="display: flex; align-items: center; gap: 1rem;">
                <h2 style="margin: 0; font-size: 1.5rem;">⚡ Real-time Analytics Dashboard</h2>
                <div style="display: flex; align-items: center; gap: 0.5rem; background: rgba(255,255,255,0.2); padding: 0.25rem 0.75rem; border-radius: 12px;">
                  <div id="liveIndicator" style="width: 8px; height: 8px; background: #22c55e; border-radius: 50%; animation: pulse 2s infinite;"></div>
                  <span style="font-size: 0.875rem;">LIVE</span>
                </div>
              </div>
              <button onclick="closeModal('realtimeDashboardModal')" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">✕ Close</button>
            </div>
            <div style="flex: 1; overflow-y: auto; padding: 2rem;">

              <!-- Real-time Metrics -->
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                <div style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; padding: 1.5rem; border-radius: 12px; position: relative; overflow: hidden;">
                  <div style="position: absolute; top: 10px; right: 10px; opacity: 0.3; font-size: 2rem;">👥</div>
                  <div id="onlineUsers" style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">${data.liveMetrics.onlineUsers}</div>
                  <div style="opacity: 0.9;">Online Users</div>
                  <div style="font-size: 0.875rem; margin-top: 0.5rem;">+12% from last hour</div>
                </div>

                <div style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 1.5rem; border-radius: 12px; position: relative; overflow: hidden;">
                  <div style="position: absolute; top: 10px; right: 10px; opacity: 0.3; font-size: 2rem;">📝</div>
                  <div id="activeApplications" style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">${data.liveMetrics.activeApplications}</div>
                  <div style="opacity: 0.9;">Active Applications</div>
                  <div style="font-size: 0.875rem; margin-top: 0.5rem;">In progress right now</div>
                </div>

                <div style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 1.5rem; border-radius: 12px; position: relative; overflow: hidden;">
                  <div style="position: absolute; top: 10px; right: 10px; opacity: 0.3; font-size: 2rem;">⚡</div>
                  <div id="systemLoad" style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">${data.liveMetrics.systemLoad}%</div>
                  <div style="opacity: 0.9;">System Load</div>
                  <div style="font-size: 0.875rem; margin-top: 0.5rem;">Optimal performance</div>
                </div>

                <div style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; padding: 1.5rem; border-radius: 12px; position: relative; overflow: hidden;">
                  <div style="position: absolute; top: 10px; right: 10px; opacity: 0.3; font-size: 2rem;">⏱️</div>
                  <div id="responseTime" style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">${data.liveMetrics.responseTime}s</div>
                  <div style="opacity: 0.9;">Avg Response Time</div>
                  <div style="font-size: 0.875rem; margin-top: 0.5rem;">-0.2s improvement</div>
                </div>
              </div>

              <!-- Real-time Charts -->
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                  <h3 style="margin: 0 0 1rem 0; color: #1f2937;">Application Submission Rate (Live)</h3>
                  <div id="applicationRateChart" style="height: 300px; background: white; border-radius: 8px; display: flex; align-items: center; justify-content: center; border: 2px dashed #d1d5db;">
                    <div style="text-align: center; color: #6b7280;">
                      <div style="font-size: 3rem; margin-bottom: 1rem;">📈</div>
                      <div>Live Application Rate Chart</div>
                      <div style="font-size: 0.875rem; margin-top: 0.5rem;">Updates every 30 seconds</div>
                    </div>
                  </div>
                </div>

                <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                  <h3 style="margin: 0 0 1rem 0; color: #1f2937;">System Performance (Live)</h3>
                  <div id="performanceChart" style="height: 300px; background: white; border-radius: 8px; display: flex; align-items: center; justify-content: center; border: 2px dashed #d1d5db;">
                    <div style="text-align: center; color: #6b7280;">
                      <div style="font-size: 3rem; margin-bottom: 1rem;">⚡</div>
                      <div>Live Performance Monitor</div>
                      <div style="font-size: 0.875rem; margin-top: 0.5rem;">CPU, Memory, Network usage</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Activity Feed and Alerts -->
              <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
                <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                  <h3 style="margin: 0 0 1rem 0; color: #1f2937;">Live Activity Feed</h3>
                  <div id="activityFeed" style="height: 300px; overflow-y: auto; background: white; border-radius: 8px; padding: 1rem;">
                    <div style="padding: 0.75rem; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; gap: 1rem;">
                      <div style="width: 8px; height: 8px; background: #22c55e; border-radius: 50%;"></div>
                      <div style="flex: 1;">
                        <div style="font-weight: 500; font-size: 0.875rem;">New application submitted</div>
                        <div style="color: #6b7280; font-size: 0.75rem;">Computer Science - John Doe</div>
                      </div>
                      <div style="color: #6b7280; font-size: 0.75rem;">Just now</div>
                    </div>
                    <div style="padding: 0.75rem; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; gap: 1rem;">
                      <div style="width: 8px; height: 8px; background: #3b82f6; border-radius: 50%;"></div>
                      <div style="flex: 1;">
                        <div style="font-weight: 500; font-size: 0.875rem;">Application review completed</div>
                        <div style="color: #6b7280; font-size: 0.75rem;">Business Administration - Sarah Smith</div>
                      </div>
                      <div style="color: #6b7280; font-size: 0.75rem;">1 min ago</div>
                    </div>
                    <div style="padding: 0.75rem; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; gap: 1rem;">
                      <div style="width: 8px; height: 8px; background: #f59e0b; border-radius: 50%;"></div>
                      <div style="flex: 1;">
                        <div style="font-weight: 500; font-size: 0.875rem;">Document uploaded</div>
                        <div style="color: #6b7280; font-size: 0.75rem;">Transcript - Michael Johnson</div>
                      </div>
                      <div style="color: #6b7280; font-size: 0.75rem;">2 min ago</div>
                    </div>
                  </div>
                </div>

                <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                  <h3 style="margin: 0 0 1rem 0; color: #1f2937;">System Alerts</h3>
                  <div style="space-y: 0.75rem;">
                    ${data.alerts.map(alert => `
                      <div style="padding: 0.75rem; background: white; border-radius: 6px; border-left: 4px solid ${getAlertColor(alert.type)}; margin-bottom: 0.75rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                          <span style="font-size: 1rem;">${getAlertIcon(alert.type)}</span>
                          <span style="font-weight: 500; font-size: 0.875rem; color: ${getAlertColor(alert.type)};">${alert.type.toUpperCase()}</span>
                        </div>
                        <div style="font-size: 0.875rem; color: #1f2937; margin-bottom: 0.25rem;">${alert.message}</div>
                        <div style="font-size: 0.75rem; color: #6b7280;">${alert.time}</div>
                      </div>
                    `).join('')}
                  </div>
                </div>
              </div>

              <!-- Dashboard Controls -->
              <div style="margin-top: 2rem; padding: 1.5rem; background: #f1f5f9; border-radius: 12px;">
                <h3 style="margin: 0 0 1rem 0;">Dashboard Controls</h3>
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                  <button onclick="toggleAutoRefresh()" style="background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">⏸️ Pause Updates</button>
                  <button onclick="exportLiveData()" style="background: #059669; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">📊 Export Live Data</button>
                  <button onclick="configureAlerts()" style="background: #f59e0b; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">🔔 Configure Alerts</button>
                  <button onclick="fullscreenDashboard()" style="background: #8b5cf6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">🖥️ Fullscreen</button>
                </div>
              </div>

            </div>
          </div>
        </div>

        <style>
          @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
          }
        </style>
      `;
    }

    function getAlertColor(type) {
      const colors = {
        info: '#3b82f6',
        warning: '#f59e0b',
        success: '#10b981',
        error: '#ef4444'
      };
      return colors[type] || '#6b7280';
    }

    function getAlertIcon(type) {
      const icons = {
        info: 'ℹ️',
        warning: '⚠️',
        success: '✅',
        error: '❌'
      };
      return icons[type] || 'ℹ️';
    }

    function startRealtimeUpdates() {
      // Simulate real-time updates
      setInterval(() => {
        updateLiveMetrics();
        updateActivityFeed();
      }, 5000);

      showToast('⚡ Real-time updates started! Dashboard will refresh every 5 seconds.', 'success', 4000);
    }

    function updateLiveMetrics() {
      const metrics = ['onlineUsers', 'activeApplications', 'systemLoad', 'responseTime'];
      metrics.forEach(metric => {
        const element = document.getElementById(metric);
        if (element) {
          let newValue;
          switch(metric) {
            case 'onlineUsers':
              newValue = Math.floor(Math.random() * 500) + 100;
              break;
            case 'activeApplications':
              newValue = Math.floor(Math.random() * 50) + 10;
              break;
            case 'systemLoad':
              newValue = Math.floor(Math.random() * 100) + '%';
              break;
            case 'responseTime':
              newValue = (Math.random() * 2 + 0.5).toFixed(1) + 's';
              break;
          }
          element.textContent = newValue;
        }
      });
    }

    function updateActivityFeed() {
      const feed = document.getElementById('activityFeed');
      if (feed) {
        const activities = [
          'New application submitted - Engineering - Alice Brown',
          'Document verified - Medicine - Robert Davis',
          'Interview scheduled - Business - Emma Wilson',
          'Payment processed - Computer Science - David Lee'
        ];

        const randomActivity = activities[Math.floor(Math.random() * activities.length)];
        const newItem = document.createElement('div');
        newItem.style.cssText = 'padding: 0.75rem; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; gap: 1rem;';
        newItem.innerHTML = `
          <div style="width: 8px; height: 8px; background: #22c55e; border-radius: 50%;"></div>
          <div style="flex: 1;">
            <div style="font-weight: 500; font-size: 0.875rem;">${randomActivity}</div>
            <div style="color: #6b7280; font-size: 0.75rem;">Application update</div>
          </div>
          <div style="color: #6b7280; font-size: 0.75rem;">Just now</div>
        `;

        feed.insertBefore(newItem, feed.firstChild);

        // Remove old items to keep feed manageable
        while (feed.children.length > 10) {
          feed.removeChild(feed.lastChild);
        }
      }
    }

    // Additional feature functions for Report Builder and Real-time Dashboard
    function previewReport() {
      showToast('👁️ Opening report preview...', 'info', 2000);
    }

    function saveReport() {
      showToast('💾 Report saved successfully!', 'success', 3000);
    }

    function clearCanvas() {
      if (confirm('Are you sure you want to clear the entire canvas?')) {
        const canvas = document.getElementById('reportCanvas');
        canvas.innerHTML = `
          <div style="text-align: center; color: #6b7280; padding: 4rem 2rem;">
            <div style="font-size: 4rem; margin-bottom: 1rem;">🎨</div>
            <h3 style="margin: 0 0 1rem 0;">Drag components here to build your report</h3>
            <p style="margin: 0; font-size: 0.875rem;">Start by dragging a data source or visualization from the left panel</p>
          </div>
        `;
        showToast('🗑️ Canvas cleared', 'info', 2000);
      }
    }

    function undoAction() {
      showToast('↶ Undo action performed', 'info', 2000);
    }

    function redoAction() {
      showToast('↷ Redo action performed', 'info', 2000);
    }

    function loadTemplate() {
      showToast('📋 Loading report template...', 'info', 2000);
    }

    function exportReport(format) {
      showToast(`📄 Exporting custom report as ${format.toUpperCase()}...`, 'info', 3000);
    }

    function scheduleReport() {
      showToast('⏰ Opening report scheduling interface...', 'info', 2000);
    }

    function updateComponent() {
      showToast('✅ Component updated successfully!', 'success', 2000);
    }

    function deleteComponent() {
      if (confirm('Are you sure you want to delete this component?')) {
        showToast('🗑️ Component deleted', 'info', 2000);
      }
    }

    function toggleAutoRefresh() {
      showToast('⏸️ Auto-refresh paused', 'info', 2000);
    }

    function exportLiveData() {
      showToast('📊 Exporting live dashboard data...', 'info', 3000);
    }

    function configureAlerts() {
      showToast('🔔 Opening alert configuration...', 'info', 2000);
    }

    function fullscreenDashboard() {
      showToast('🖥️ Entering fullscreen mode...', 'info', 2000);
    }

    // 6. Automated Report Scheduling and Delivery
    function openAutomatedReporting() {
      showToast('⏰ Loading Automated Reporting System...', 'info', 2000);

      setTimeout(() => {
        const modalHtml = createAutomatedReportingModal();
        document.body.insertAdjacentHTML('beforeend', modalHtml);
      }, 1000);
    }

    function createAutomatedReportingModal() {
      return `
        <div id="automatedReportingModal" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;">
          <div style="background: white; width: 95vw; height: 90vh; border-radius: 16px; overflow: hidden; display: flex; flex-direction: column;">
            <div style="background: linear-gradient(135deg, #059669, #047857); color: white; padding: 1.5rem; display: flex; justify-content: between; align-items: center;">
              <h2 style="margin: 0; font-size: 1.5rem;">⏰ Automated Report Scheduling & Delivery</h2>
              <button onclick="closeModal('automatedReportingModal')" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">✕ Close</button>
            </div>
            <div style="flex: 1; overflow-y: auto; padding: 2rem;">

              <!-- Quick Setup -->
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                <div style="background: #f8fafc; padding: 2rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                  <h3 style="margin: 0 0 1rem 0; color: #1f2937;">📅 Schedule New Report</h3>
                  <form onsubmit="scheduleNewReport(event)">
                    <div style="margin-bottom: 1rem;">
                      <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Report Type</label>
                      <select style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 8px;">
                        <option>Application Trends Report</option>
                        <option>Enrollment Forecast</option>
                        <option>Performance Metrics</option>
                        <option>Demographic Analysis</option>
                        <option>Financial Summary</option>
                        <option>Custom Report</option>
                      </select>
                    </div>

                    <div style="margin-bottom: 1rem;">
                      <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Frequency</label>
                      <select style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 8px;">
                        <option>Daily</option>
                        <option>Weekly</option>
                        <option>Monthly</option>
                        <option>Quarterly</option>
                        <option>Custom Schedule</option>
                      </select>
                    </div>

                    <div style="margin-bottom: 1rem;">
                      <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Recipients</label>
                      <textarea style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 8px; resize: vertical;" rows="3" placeholder="Enter email addresses, separated by commas"></textarea>
                    </div>

                    <div style="margin-bottom: 1rem;">
                      <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Format</label>
                      <div style="display: flex; gap: 1rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                          <input type="checkbox" checked> PDF
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                          <input type="checkbox"> Excel
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                          <input type="checkbox"> CSV
                        </label>
                      </div>
                    </div>

                    <button type="submit" style="width: 100%; background: #059669; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 500;">⏰ Schedule Report</button>
                  </form>
                </div>

                <div style="background: #f8fafc; padding: 2rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                  <h3 style="margin: 0 0 1rem 0; color: #1f2937;">🚀 Quick Actions</h3>
                  <div style="space-y: 1rem;">
                    <button onclick="sendInstantReport()" style="width: 100%; background: #3b82f6; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; margin-bottom: 1rem; text-align: left;">
                      <div style="font-weight: 600; margin-bottom: 0.25rem;">📧 Send Instant Report</div>
                      <div style="font-size: 0.875rem; opacity: 0.9;">Generate and send report immediately</div>
                    </button>

                    <button onclick="createTemplate()" style="width: 100%; background: #8b5cf6; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; margin-bottom: 1rem; text-align: left;">
                      <div style="font-weight: 600; margin-bottom: 0.25rem;">📋 Create Template</div>
                      <div style="font-size: 0.875rem; opacity: 0.9;">Save current setup as template</div>
                    </button>

                    <button onclick="bulkSchedule()" style="width: 100%; background: #f59e0b; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; text-align: left;">
                      <div style="font-weight: 600; margin-bottom: 0.25rem;">📦 Bulk Schedule</div>
                      <div style="font-size: 0.875rem; opacity: 0.9;">Schedule multiple reports at once</div>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Scheduled Reports -->
              <div style="background: #f8fafc; padding: 2rem; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 2rem;">
                <h3 style="margin: 0 0 1rem 0; color: #1f2937;">📋 Active Schedules</h3>
                <div style="overflow-x: auto;">
                  <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                      <tr style="background: #e5e7eb;">
                        <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid #d1d5db;">Report</th>
                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #d1d5db;">Frequency</th>
                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #d1d5db;">Next Run</th>
                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #d1d5db;">Recipients</th>
                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #d1d5db;">Status</th>
                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #d1d5db;">Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td style="padding: 0.75rem; border-bottom: 1px solid #e5e7eb;">📊 Weekly Application Trends</td>
                        <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">Weekly</td>
                        <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">Mon 9:00 AM</td>
                        <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">5 recipients</td>
                        <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">
                          <span style="background: #dcfce7; color: #16a34a; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 500;">Active</span>
                        </td>
                        <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">
                          <button onclick="editSchedule(1)" style="background: #3b82f6; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; margin-right: 0.25rem;">✏️</button>
                          <button onclick="pauseSchedule(1)" style="background: #f59e0b; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; margin-right: 0.25rem;">⏸️</button>
                          <button onclick="deleteSchedule(1)" style="background: #ef4444; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer;">🗑️</button>
                        </td>
                      </tr>
                      <tr>
                        <td style="padding: 0.75rem; border-bottom: 1px solid #e5e7eb;">📈 Monthly Enrollment Forecast</td>
                        <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">Monthly</td>
                        <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">1st 10:00 AM</td>
                        <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">3 recipients</td>
                        <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">
                          <span style="background: #dcfce7; color: #16a34a; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 500;">Active</span>
                        </td>
                        <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">
                          <button onclick="editSchedule(2)" style="background: #3b82f6; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; margin-right: 0.25rem;">✏️</button>
                          <button onclick="pauseSchedule(2)" style="background: #f59e0b; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; margin-right: 0.25rem;">⏸️</button>
                          <button onclick="deleteSchedule(2)" style="background: #ef4444; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer;">🗑️</button>
                        </td>
                      </tr>
                      <tr>
                        <td style="padding: 0.75rem; border-bottom: 1px solid #e5e7eb;">📊 Daily Performance Metrics</td>
                        <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">Daily</td>
                        <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">8:00 AM</td>
                        <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">12 recipients</td>
                        <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">
                          <span style="background: #fef3c7; color: #d97706; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 500;">Paused</span>
                        </td>
                        <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">
                          <button onclick="editSchedule(3)" style="background: #3b82f6; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; margin-right: 0.25rem;">✏️</button>
                          <button onclick="resumeSchedule(3)" style="background: #059669; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; margin-right: 0.25rem;">▶️</button>
                          <button onclick="deleteSchedule(3)" style="background: #ef4444; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer;">🗑️</button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- Delivery History -->
              <div style="background: #f8fafc; padding: 2rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                <h3 style="margin: 0 0 1rem 0; color: #1f2937;">📤 Recent Deliveries</h3>
                <div style="space-y: 0.75rem;">
                  <div style="display: flex; justify-content: between; align-items: center; padding: 1rem; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                      <div style="width: 8px; height: 8px; background: #22c55e; border-radius: 50%;"></div>
                      <div>
                        <div style="font-weight: 500;">Weekly Application Trends Report</div>
                        <div style="color: #6b7280; font-size: 0.875rem;">Sent to 5 recipients • PDF, Excel</div>
                      </div>
                    </div>
                    <div style="text-align: right;">
                      <div style="font-size: 0.875rem; color: #6b7280;">Today 9:00 AM</div>
                      <div style="font-size: 0.75rem; color: #22c55e;">✅ Delivered</div>
                    </div>
                  </div>

                  <div style="display: flex; justify-content: between; align-items: center; padding: 1rem; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                      <div style="width: 8px; height: 8px; background: #3b82f6; border-radius: 50%;"></div>
                      <div>
                        <div style="font-weight: 500;">Performance Metrics Dashboard</div>
                        <div style="color: #6b7280; font-size: 0.875rem;">Sent to 12 recipients • PDF</div>
                      </div>
                    </div>
                    <div style="text-align: right;">
                      <div style="font-size: 0.875rem; color: #6b7280;">Yesterday 8:00 AM</div>
                      <div style="font-size: 0.75rem; color: #22c55e;">✅ Delivered</div>
                    </div>
                  </div>

                  <div style="display: flex; justify-content: between; align-items: center; padding: 1rem; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                      <div style="width: 8px; height: 8px; background: #ef4444; border-radius: 50%;"></div>
                      <div>
                        <div style="font-weight: 500;">Monthly Enrollment Forecast</div>
                        <div style="color: #6b7280; font-size: 0.875rem;">Failed to send to 3 recipients • PDF, Excel</div>
                      </div>
                    </div>
                    <div style="text-align: right;">
                      <div style="font-size: 0.875rem; color: #6b7280;">2 days ago</div>
                      <div style="font-size: 0.75rem; color: #ef4444;">❌ Failed</div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      `;
    }

    // 7. Comparative Analysis with Peer Institutions
    function openComparativeAnalysis() {
      showToast('🔍 Loading Comparative Analysis Dashboard...', 'info', 2000);

      setTimeout(() => {
        const comparisonData = generateComparisonData();
        const modalHtml = createComparativeAnalysisModal(comparisonData);
        document.body.insertAdjacentHTML('beforeend', modalHtml);
      }, 1000);
    }

    function generateComparisonData() {
      return {
        yourInstitution: {
          name: "University of Excellence",
          applications: 18750,
          acceptanceRate: 68,
          yieldRate: 42,
          avgSAT: 1245,
          diversity: 34,
          retention: 91
        },
        peerInstitutions: [
          { name: "State University", applications: 22100, acceptanceRate: 72, yieldRate: 38, avgSAT: 1198, diversity: 41, retention: 87 },
          { name: "Tech Institute", applications: 15600, acceptanceRate: 45, yieldRate: 58, avgSAT: 1398, diversity: 28, retention: 94 },
          { name: "Liberal Arts College", applications: 8900, acceptanceRate: 58, yieldRate: 52, avgSAT: 1276, diversity: 38, retention: 89 },
          { name: "Regional University", applications: 12400, acceptanceRate: 78, yieldRate: 35, avgSAT: 1167, diversity: 45, retention: 85 }
        ],
        benchmarks: {
          applications: { value: 16800, percentile: 75 },
          acceptanceRate: { value: 65, percentile: 60 },
          yieldRate: { value: 45, percentile: 68 },
          avgSAT: { value: 1257, percentile: 72 },
          diversity: { value: 37, percentile: 55 },
          retention: { value: 89, percentile: 82 }
        }
      };
    }

    function createComparativeAnalysisModal(data) {
      return `
        <div id="comparativeAnalysisModal" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;">
          <div style="background: white; width: 98vw; height: 95vh; border-radius: 16px; overflow: hidden; display: flex; flex-direction: column;">
            <div style="background: linear-gradient(135deg, #6366f1, #4f46e5); color: white; padding: 1.5rem; display: flex; justify-content: between; align-items: center;">
              <h2 style="margin: 0; font-size: 1.5rem;">🔍 Comparative Analysis with Peer Institutions</h2>
              <button onclick="closeModal('comparativeAnalysisModal')" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">✕ Close</button>
            </div>
            <div style="flex: 1; overflow-y: auto; padding: 2rem;">

              <!-- Institution Selector -->
              <div style="margin-bottom: 2rem; padding: 1.5rem; background: #f8fafc; border-radius: 12px; border: 1px solid #e2e8f0;">
                <h3 style="margin: 0 0 1rem 0; color: #1f2937;">🎯 Select Comparison Group</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                  <div>
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Institution Type</label>
                    <select style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 8px;">
                      <option>All Types</option>
                      <option>Public Universities</option>
                      <option>Private Universities</option>
                      <option>Community Colleges</option>
                      <option>Technical Institutes</option>
                    </select>
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Size Range</label>
                    <select style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 8px;">
                      <option>Similar Size (±20%)</option>
                      <option>Small (< 10K students)</option>
                      <option>Medium (10K-25K students)</option>
                      <option>Large (> 25K students)</option>
                    </select>
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Geographic Region</label>
                    <select style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 8px;">
                      <option>Regional Peers</option>
                      <option>National Comparison</option>
                      <option>State Institutions</option>
                      <option>Custom Selection</option>
                    </select>
                  </div>
                  <div style="display: flex; align-items: end;">
                    <button onclick="updateComparison()" style="width: 100%; background: #6366f1; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer;">🔄 Update Comparison</button>
                  </div>
                </div>
              </div>

              <!-- Performance Summary -->
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                ${Object.entries(data.benchmarks).map(([metric, benchmark]) => {
                  const yourValue = data.yourInstitution[metric];
                  const performance = getPerformanceIndicator(yourValue, benchmark.value);
                  return `
                    <div style="background: linear-gradient(135deg, ${performance.color}); color: white; padding: 1.5rem; border-radius: 12px; position: relative; overflow: hidden;">
                      <div style="position: absolute; top: 10px; right: 10px; opacity: 0.3; font-size: 2rem;">${performance.icon}</div>
                      <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;">${formatMetricValue(metric, yourValue)}</div>
                      <div style="opacity: 0.9; margin-bottom: 0.5rem;">${formatMetricLabel(metric)}</div>
                      <div style="font-size: 0.875rem; display: flex; justify-content: between;">
                        <span>Benchmark: ${formatMetricValue(metric, benchmark.value)}</span>
                        <span style="font-weight: bold;">${benchmark.percentile}th %ile</span>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>

              <!-- Detailed Comparison Table -->
              <div style="background: #f8fafc; padding: 2rem; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 2rem;">
                <h3 style="margin: 0 0 1rem 0; color: #1f2937;">📊 Peer Institution Comparison</h3>
                <div style="overflow-x: auto;">
                  <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                      <tr style="background: #e5e7eb;">
                        <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid #d1d5db;">Institution</th>
                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #d1d5db;">Applications</th>
                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #d1d5db;">Accept Rate</th>
                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #d1d5db;">Yield Rate</th>
                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #d1d5db;">Avg SAT</th>
                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #d1d5db;">Diversity</th>
                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #d1d5db;">Retention</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr style="background: #f0f9ff; border: 2px solid #3b82f6;">
                        <td style="padding: 0.75rem; border-bottom: 1px solid #e5e7eb; font-weight: bold; color: #3b82f6;">
                          ${data.yourInstitution.name} (You)
                        </td>
                        <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb; font-weight: bold;">
                          ${data.yourInstitution.applications.toLocaleString()}
                        </td>
                        <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb; font-weight: bold;">
                          ${data.yourInstitution.acceptanceRate}%
                        </td>
                        <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb; font-weight: bold;">
                          ${data.yourInstitution.yieldRate}%
                        </td>
                        <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb; font-weight: bold;">
                          ${data.yourInstitution.avgSAT}
                        </td>
                        <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb; font-weight: bold;">
                          ${data.yourInstitution.diversity}%
                        </td>
                        <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb; font-weight: bold;">
                          ${data.yourInstitution.retention}%
                        </td>
                      </tr>
                      ${data.peerInstitutions.map(peer => `
                        <tr>
                          <td style="padding: 0.75rem; border-bottom: 1px solid #e5e7eb;">${peer.name}</td>
                          <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">${peer.applications.toLocaleString()}</td>
                          <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">${peer.acceptanceRate}%</td>
                          <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">${peer.yieldRate}%</td>
                          <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">${peer.avgSAT}</td>
                          <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">${peer.diversity}%</td>
                          <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #e5e7eb;">${peer.retention}%</td>
                        </tr>
                      `).join('')}
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- Insights and Recommendations -->
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                <div style="background: #f8fafc; padding: 2rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                  <h3 style="margin: 0 0 1rem 0; color: #1f2937;">💡 Key Insights</h3>
                  <div style="space-y: 1rem;">
                    <div style="padding: 1rem; background: white; border-radius: 8px; border-left: 4px solid #22c55e;">
                      <div style="font-weight: 600; color: #22c55e; margin-bottom: 0.25rem;">✅ Strengths</div>
                      <div style="font-size: 0.875rem;">Your retention rate (91%) is above the peer average and in the 82nd percentile.</div>
                    </div>
                    <div style="padding: 1rem; background: white; border-radius: 8px; border-left: 4px solid #f59e0b;">
                      <div style="font-weight: 600; color: #f59e0b; margin-bottom: 0.25rem;">⚠️ Opportunities</div>
                      <div style="font-size: 0.875rem;">Consider improving diversity metrics to match regional peer average of 37%.</div>
                    </div>
                    <div style="padding: 1rem; background: white; border-radius: 8px; border-left: 4px solid #3b82f6;">
                      <div style="font-weight: 600; color: #3b82f6; margin-bottom: 0.25rem;">📈 Trending</div>
                      <div style="font-size: 0.875rem;">Your application volume is growing faster than regional peers (+15% vs +8%).</div>
                    </div>
                  </div>
                </div>

                <div style="background: #f8fafc; padding: 2rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                  <h3 style="margin: 0 0 1rem 0; color: #1f2937;">🎯 Recommendations</h3>
                  <div style="space-y: 1rem;">
                    <div style="padding: 1rem; background: white; border-radius: 8px;">
                      <div style="font-weight: 600; margin-bottom: 0.5rem;">1. Enhance Diversity Initiatives</div>
                      <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem;">Launch targeted outreach programs to increase underrepresented student enrollment.</div>
                      <div style="font-size: 0.75rem; color: #3b82f6;">Impact: +5-8% diversity improvement</div>
                    </div>
                    <div style="padding: 1rem; background: white; border-radius: 8px;">
                      <div style="font-weight: 600; margin-bottom: 0.5rem;">2. Optimize Yield Strategies</div>
                      <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem;">Implement data-driven enrollment management to improve yield rates.</div>
                      <div style="font-size: 0.75rem; color: #3b82f6;">Impact: +3-5% yield increase</div>
                    </div>
                    <div style="padding: 1rem; background: white; border-radius: 8px;">
                      <div style="font-weight: 600; margin-bottom: 0.5rem;">3. Leverage Retention Success</div>
                      <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem;">Highlight strong retention in marketing to prospective students.</div>
                      <div style="font-size: 0.75rem; color: #3b82f6;">Impact: Competitive advantage</div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      `;
    }

    // 8. Export Capabilities (PDF, Excel, CSV)
    function openExportCapabilities() {
      showToast('📤 Loading Export Center...', 'info', 2000);

      setTimeout(() => {
        const modalHtml = createExportCapabilitiesModal();
        document.body.insertAdjacentHTML('beforeend', modalHtml);
      }, 1000);
    }

    function createExportCapabilitiesModal() {
      return `
        <div id="exportCapabilitiesModal" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;">
          <div style="background: white; width: 95vw; height: 90vh; border-radius: 16px; overflow: hidden; display: flex; flex-direction: column;">
            <div style="background: linear-gradient(135deg, #dc2626, #991b1b); color: white; padding: 1.5rem; display: flex; justify-content: between; align-items: center;">
              <h2 style="margin: 0; font-size: 1.5rem;">📤 Export Center - All Formats</h2>
              <button onclick="closeModal('exportCapabilitiesModal')" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">✕ Close</button>
            </div>
            <div style="flex: 1; overflow-y: auto; padding: 2rem;">

              <!-- Quick Export Options -->
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
                <div style="background: #fee2e2; padding: 2rem; border-radius: 12px; border: 1px solid #fecaca;">
                  <div style="text-align: center; margin-bottom: 1.5rem;">
                    <div style="font-size: 3rem; margin-bottom: 0.5rem;">📄</div>
                    <h3 style="margin: 0; color: #dc2626;">PDF Export</h3>
                  </div>
                  <div style="space-y: 1rem;">
                    <button onclick="exportAsPDF('current')" style="width: 100%; background: #dc2626; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; margin-bottom: 0.5rem;">📊 Current View</button>
                    <button onclick="exportAsPDF('full')" style="width: 100%; background: #dc2626; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; margin-bottom: 0.5rem;">📈 Full Report</button>
                    <button onclick="exportAsPDF('custom')" style="width: 100%; background: #dc2626; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer;">⚙️ Custom PDF</button>
                  </div>
                </div>

                <div style="background: #dcfce7; padding: 2rem; border-radius: 12px; border: 1px solid #bbf7d0;">
                  <div style="text-align: center; margin-bottom: 1.5rem;">
                    <div style="font-size: 3rem; margin-bottom: 0.5rem;">📊</div>
                    <h3 style="margin: 0; color: #059669;">Excel Export</h3>
                  </div>
                  <div style="space-y: 1rem;">
                    <button onclick="exportAsExcel('data')" style="width: 100%; background: #059669; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; margin-bottom: 0.5rem;">📋 Data Tables</button>
                    <button onclick="exportAsExcel('charts')" style="width: 100%; background: #059669; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; margin-bottom: 0.5rem;">📈 With Charts</button>
                    <button onclick="exportAsExcel('template')" style="width: 100%; background: #059669; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer;">📋 Excel Template</button>
                  </div>
                </div>

                <div style="background: #f3e8ff; padding: 2rem; border-radius: 12px; border: 1px solid #d8b4fe;">
                  <div style="text-align: center; margin-bottom: 1.5rem;">
                    <div style="font-size: 3rem; margin-bottom: 0.5rem;">📋</div>
                    <h3 style="margin: 0; color: #7c3aed;">CSV Export</h3>
                  </div>
                  <div style="space-y: 1rem;">
                    <button onclick="exportAsCSV('raw')" style="width: 100%; background: #7c3aed; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; margin-bottom: 0.5rem;">📊 Raw Data</button>
                    <button onclick="exportAsCSV('summary')" style="width: 100%; background: #7c3aed; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; margin-bottom: 0.5rem;">📈 Summary</button>
                    <button onclick="exportAsCSV('custom')" style="width: 100%; background: #7c3aed; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer;">⚙️ Custom CSV</button>
                  </div>
                </div>
              </div>

              <!-- Advanced Export Configuration -->
              <div style="background: #f8fafc; padding: 2rem; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 2rem;">
                <h3 style="margin: 0 0 1rem 0; color: #1f2937;">⚙️ Advanced Export Settings</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                  <div>
                    <h4 style="margin: 0 0 1rem 0; color: #374151;">Data Selection</h4>
                    <div style="space-y: 0.75rem;">
                      <label style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="checkbox" checked> Application Data
                      </label>
                      <label style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="checkbox" checked> Enrollment Statistics
                      </label>
                      <label style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="checkbox"> Financial Metrics
                      </label>
                      <label style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="checkbox"> Demographic Data
                      </label>
                      <label style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="checkbox"> Performance KPIs
                      </label>
                    </div>
                  </div>

                  <div>
                    <h4 style="margin: 0 0 1rem 0; color: #374151;">Date Range</h4>
                    <div style="space-y: 1rem;">
                      <div>
                        <label style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem;">From Date</label>
                        <input type="date" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                      </div>
                      <div>
                        <label style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem;">To Date</label>
                        <input type="date" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                      </div>
                      <div>
                        <label style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem;">Quick Select</label>
                        <select style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                          <option>Last 30 Days</option>
                          <option>Last Quarter</option>
                          <option>Last 6 Months</option>
                          <option>Last Year</option>
                          <option>Academic Year</option>
                          <option>Custom Range</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Export Templates -->
              <div style="background: #f8fafc; padding: 2rem; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 2rem;">
                <h3 style="margin: 0 0 1rem 0; color: #1f2937;">📋 Export Templates</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                  <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid #e2e8f0;">
                    <h4 style="margin: 0 0 0.5rem 0; color: #1f2937;">📊 Executive Summary</h4>
                    <p style="margin: 0 0 1rem 0; color: #6b7280; font-size: 0.875rem;">High-level metrics and KPIs for leadership</p>
                    <button onclick="exportTemplate('executive')" style="background: #3b82f6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">Export Template</button>
                  </div>

                  <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid #e2e8f0;">
                    <h4 style="margin: 0 0 0.5rem 0; color: #1f2937;">📈 Detailed Analytics</h4>
                    <p style="margin: 0 0 1rem 0; color: #6b7280; font-size: 0.875rem;">Comprehensive data analysis and trends</p>
                    <button onclick="exportTemplate('detailed')" style="background: #3b82f6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">Export Template</button>
                  </div>

                  <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid #e2e8f0;">
                    <h4 style="margin: 0 0 0.5rem 0; color: #1f2937;">👥 Department Report</h4>
                    <p style="margin: 0 0 1rem 0; color: #6b7280; font-size: 0.875rem;">Department-specific performance metrics</p>
                    <button onclick="exportTemplate('department')" style="background: #3b82f6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">Export Template</button>
                  </div>

                  <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid #e2e8f0;">
                    <h4 style="margin: 0 0 0.5rem 0; color: #1f2937;">🔍 Compliance Report</h4>
                    <p style="margin: 0 0 1rem 0; color: #6b7280; font-size: 0.875rem;">Regulatory and accreditation data</p>
                    <button onclick="exportTemplate('compliance')" style="background: #3b82f6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">Export Template</button>
                  </div>
                </div>
              </div>

              <!-- Bulk Export Options -->
              <div style="background: #f8fafc; padding: 2rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                <h3 style="margin: 0 0 1rem 0; color: #1f2937;">📦 Bulk Export Operations</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                  <div>
                    <h4 style="margin: 0 0 1rem 0; color: #374151;">Export Package</h4>
                    <p style="margin: 0 0 1rem 0; color: #6b7280; font-size: 0.875rem;">Generate comprehensive export package containing all reports in multiple formats</p>
                    <button onclick="bulkExportAll()" style="background: #059669; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">📦 Export All Reports</button>
                  </div>

                  <div>
                    <h4 style="margin: 0 0 1rem 0; color: #374151;">Scheduled Exports</h4>
                    <p style="margin: 0 0 1rem 0; color: #6b7280; font-size: 0.875rem;">Set up automated export delivery on regular schedule</p>
                    <button onclick="scheduleExport()" style="background: #8b5cf6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">⏰ Schedule Exports</button>
                  </div>
                </div>

                <div style="margin-top: 2rem; padding: 1.5rem; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                  <h4 style="margin: 0 0 1rem 0; color: #374151;">Export History</h4>
                  <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 0.875rem;">
                      <thead>
                        <tr style="background: #f9fafb;">
                          <th style="padding: 0.5rem; text-align: left; border-bottom: 1px solid #e5e7eb;">Export</th>
                          <th style="padding: 0.5rem; text-align: center; border-bottom: 1px solid #e5e7eb;">Format</th>
                          <th style="padding: 0.5rem; text-align: center; border-bottom: 1px solid #e5e7eb;">Size</th>
                          <th style="padding: 0.5rem; text-align: center; border-bottom: 1px solid #e5e7eb;">Date</th>
                          <th style="padding: 0.5rem; text-align: center; border-bottom: 1px solid #e5e7eb;">Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td style="padding: 0.5rem; border-bottom: 1px solid #e5e7eb;">Application Trends Report</td>
                          <td style="padding: 0.5rem; text-align: center; border-bottom: 1px solid #e5e7eb;">PDF</td>
                          <td style="padding: 0.5rem; text-align: center; border-bottom: 1px solid #e5e7eb;">2.3 MB</td>
                          <td style="padding: 0.5rem; text-align: center; border-bottom: 1px solid #e5e7eb;">Today 10:30 AM</td>
                          <td style="padding: 0.5rem; text-align: center; border-bottom: 1px solid #e5e7eb;">
                            <button onclick="downloadExport('trends_pdf')" style="background: #3b82f6; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.75rem;">⬇️ Download</button>
                          </td>
                        </tr>
                        <tr>
                          <td style="padding: 0.5rem; border-bottom: 1px solid #e5e7eb;">Performance Metrics</td>
                          <td style="padding: 0.5rem; text-align: center; border-bottom: 1px solid #e5e7eb;">Excel</td>
                          <td style="padding: 0.5rem; text-align: center; border-bottom: 1px solid #e5e7eb;">1.8 MB</td>
                          <td style="padding: 0.5rem; text-align: center; border-bottom: 1px solid #e5e7eb;">Yesterday 2:15 PM</td>
                          <td style="padding: 0.5rem; text-align: center; border-bottom: 1px solid #e5e7eb;">
                            <button onclick="downloadExport('metrics_excel')" style="background: #3b82f6; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.75rem;">⬇️ Download</button>
                          </td>
                        </tr>
                        <tr>
                          <td style="padding: 0.5rem; border-bottom: 1px solid #e5e7eb;">Raw Application Data</td>
                          <td style="padding: 0.5rem; text-align: center; border-bottom: 1px solid #e5e7eb;">CSV</td>
                          <td style="padding: 0.5rem; text-align: center; border-bottom: 1px solid #e5e7eb;">4.7 MB</td>
                          <td style="padding: 0.5rem; text-align: center; border-bottom: 1px solid #e5e7eb;">Dec 15, 2:30 PM</td>
                          <td style="padding: 0.5rem; text-align: center; border-bottom: 1px solid #e5e7eb;">
                            <button onclick="downloadExport('raw_csv')" style="background: #3b82f6; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.75rem;">⬇️ Download</button>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      `;
    }

    // Helper functions for all features
    function formatMetricValue(metric, value) {
      if (metric.includes('Rate') || metric === 'diversity' || metric === 'retention') return value + '%';
      if (metric === 'avgSAT') return value.toString();
      return value.toLocaleString();
    }

    function formatMetricLabel(metric) {
      const labels = {
        applications: 'Total Applications',
        acceptanceRate: 'Acceptance Rate',
        yieldRate: 'Yield Rate',
        avgSAT: 'Average SAT',
        diversity: 'Diversity Index',
        retention: 'Retention Rate'
      };
      return labels[metric] || metric;
    }

    function getPerformanceIndicator(yourValue, benchmarkValue) {
      const ratio = yourValue / benchmarkValue;
      if (ratio >= 1.1) return { color: '#10b981, #059669', icon: '🎯', performance: 'excellent' };
      if (ratio >= 1.05) return { color: '#22c55e, #16a34a', icon: '✅', performance: 'good' };
      if (ratio >= 0.95) return { color: '#f59e0b, #d97706', icon: '📊', performance: 'average' };
      return { color: '#ef4444, #dc2626', icon: '⚠️', performance: 'below' };
    }

    // Export and action functions for new features
    function scheduleNewReport(event) {
      event.preventDefault();
      showToast('⏰ Report scheduled successfully! You will receive confirmation via email.', 'success', 4000);
      closeModal('automatedReportingModal');
    }

    function sendInstantReport() {
      showToast('📧 Generating and sending instant report...', 'info', 3000);
    }

    function createTemplate() {
      showToast('📋 Creating report template from current configuration...', 'info', 2000);
    }

    function bulkSchedule() {
      showToast('📦 Opening bulk scheduling interface...', 'info', 2000);
    }

    function editSchedule(id) {
      showToast(`✏️ Opening schedule editor for report ${id}...`, 'info', 2000);
    }

    function pauseSchedule(id) {
      showToast(`⏸️ Schedule ${id} paused successfully`, 'success', 2000);
    }

    function resumeSchedule(id) {
      showToast(`▶️ Schedule ${id} resumed successfully`, 'success', 2000);
    }

    function deleteSchedule(id) {
      if (confirm('Are you sure you want to delete this scheduled report?')) {
        showToast(`🗑️ Schedule ${id} deleted successfully`, 'success', 2000);
      }
    }

    function updateComparison() {
      showToast('🔄 Updating peer comparison with new criteria...', 'info', 3000);
    }

    function exportAsPDF(type) {
      showToast(`📄 Exporting ${type} report as PDF...`, 'info', 3000);
    }

    function exportAsExcel(type) {
      showToast(`📊 Exporting ${type} data as Excel...`, 'info', 3000);
    }

    function exportAsCSV(type) {
      showToast(`📋 Exporting ${type} data as CSV...`, 'info', 3000);
    }

    function exportTemplate(type) {
      showToast(`📋 Exporting ${type} template...`, 'info', 3000);
    }

    function bulkExportAll() {
      showToast('📦 Generating comprehensive export package...', 'info', 5000);
    }

    function scheduleExport() {
      showToast('⏰ Opening export scheduling interface...', 'info', 2000);
    }

    function downloadExport(fileId) {
      showToast(`⬇️ Downloading export file...`, 'info', 2000);
    }

    function createCustomReportBuilderModal() {
      return `
        <div id="customReportModal" data-fullscreen="false" style="position: fixed; top: 0; left: 0; width: 95vw; height: 90vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;">
          <div style="background: white; width: 95vw; height: 90vh; border-radius: 16px; overflow: hidden; display: flex; flex-direction: column;">
            <div style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; padding: 1.5rem; display: flex; justify-content: between; align-items: center;">
              <div>
                <h2 style="margin: 0; font-size: 1.5rem;">🔧 Custom Report Builder</h2>
                <div style="display: flex; align-items: center; gap: 1rem; margin-top: 0.5rem;">
                  <span id="builderStatus" style="font-size: 0.875rem; color: #10b981;">🟢 Builder Active</span>
                  <span id="lastBuilderSave" style="font-size: 0.875rem; color: rgba(255,255,255,0.8);">Last saved: --:--:--</span>
                  <span id="builderTime" style="font-size: 0.875rem; color: rgba(255,255,255,0.8);"></span>
                </div>
              </div>
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <button onclick="saveReportTemplate()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">💾 Save</button>
                <button onclick="previewCustomReport()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">👁️ Preview</button>
                <button onclick="toggleBuilderFullscreen()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">🖥️ Fullscreen</button>
                <button onclick="closeModal('customReportModal')" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">✕ Close</button>
              </div>
            </div>

            <div style="flex: 1; display: grid; grid-template-columns: 250px 1fr 300px; overflow: hidden;">

              <!-- Left Panel - Components -->
              <div style="background: #f8fafc; border-right: 1px solid #e2e8f0; padding: 1rem; overflow-y: auto;">
                <h3 style="margin: 0 0 1rem 0; color: #1f2937;">Report Components</h3>

                <div style="margin-bottom: 1.5rem;">
                  <h4 style="margin: 0 0 0.5rem 0; color: #6b7280; font-size: 0.875rem; text-transform: uppercase;">Data Sources</h4>
                  <div class="draggable-item" data-type="data-source" data-source="applications" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    📊 Applications Data
                  </div>
                  <div class="draggable-item" data-type="data-source" data-source="enrollments" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    🎓 Enrollments Data
                  </div>
                  <div class="draggable-item" data-type="data-source" data-source="demographics" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    👥 Demographics Data
                  </div>
                  <div class="draggable-item" data-type="data-source" data-source="financial" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    💰 Financial Data
                  </div>
                </div>

                <div style="margin-bottom: 1.5rem;">
                  <h4 style="margin: 0 0 0.5rem 0; color: #6b7280; font-size: 0.875rem; text-transform: uppercase;">Visualizations</h4>
                  <div class="draggable-item" data-type="chart" data-chart="bar" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    📊 Bar Chart
                  </div>
                  <div class="draggable-item" data-type="chart" data-chart="line" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    📈 Line Chart
                  </div>
                  <div class="draggable-item" data-type="chart" data-chart="pie" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    🥧 Pie Chart
                  </div>
                  <div class="draggable-item" data-type="chart" data-chart="table" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    📋 Data Table
                  </div>
                  <div class="draggable-item" data-type="chart" data-chart="kpi" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    📌 KPI Card
                  </div>
                </div>

                <div>
                  <h4 style="margin: 0 0 0.5rem 0; color: #6b7280; font-size: 0.875rem; text-transform: uppercase;">Filters</h4>
                  <div class="draggable-item" data-type="filter" data-filter="date" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    📅 Date Range
                  </div>
                  <div class="draggable-item" data-type="filter" data-filter="program" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    🎯 Program Filter
                  </div>
                  <div class="draggable-item" data-type="filter" data-filter="geography" style="background: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid #e2e8f0; cursor: grab; transition: all 0.2s;">
                    🌍 Geography Filter
                  </div>
                </div>
              </div>

              <!-- Center Canvas -->
              <div style="background: white; padding: 2rem; overflow-y: auto;">
                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 2rem;">
                  <h3 style="margin: 0; color: #1f2937;">Report Canvas</h3>
                  <div style="display: flex; gap: 1rem;">
                    <button onclick="clearCanvas()" style="background: #ef4444; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">🗑️ Clear</button>
                    <button onclick="undoAction()" style="background: #6b7280; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">↶ Undo</button>
                  </div>
                </div>

                <div id="reportCanvas" style="min-height: 600px; border: 2px dashed #d1d5db; border-radius: 12px; padding: 2rem; background: #fafafa;">
                  <div style="text-align: center; color: #6b7280; padding: 4rem 2rem;">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">🎨</div>
                    <h3 style="margin: 0 0 1rem 0;">Drag components here to build your report</h3>
                    <p style="margin: 0; font-size: 0.875rem;">Start by dragging a data source or visualization from the left panel</p>
                  </div>
                </div>
              </div>

              <!-- Right Panel - Properties -->
              <div style="background: #f8fafc; border-left: 1px solid #e2e8f0; padding: 1rem; overflow-y: auto;">
                <h3 style="margin: 0 0 1rem 0; color: #1f2937;">Properties</h3>

                <div id="propertiesPanel" style="color: #6b7280; text-align: center; padding: 2rem 1rem;">
                  <div style="font-size: 2rem; margin-bottom: 1rem;">⚙️</div>
                  <p style="margin: 0; font-size: 0.875rem;">Select a component to view its properties</p>
                </div>
              </div>
            </div>

            <!-- Bottom Toolbar -->
            <div style="background: #f8fafc; border-top: 1px solid #e2e8f0; padding: 1rem; display: flex; justify-content: between; align-items: center;">
              <div style="display: flex; gap: 1rem;">
                <button onclick="loadTemplate()" style="background: #f59e0b; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">📋 Load Template</button>
                <button onclick="exportCustomReport('pdf')" style="background: #dc2626; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">📄 Export PDF</button>
                <button onclick="shareCustomReport()" style="background: #10b981; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">📤 Share</button>
              </div>
              <div style="display: flex; gap: 1rem;">
                <button onclick="scheduleCustomReport()" style="background: #8b5cf6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">⏰ Schedule</button>
                <button onclick="generateBuilderInsights()" style="background: #059669; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">🤖 AI Insights</button>
              </div>
            </div>

          </div>
        </div>
      `;
    }

    // Custom Report Builder Functionality
    let builderData = {};
    let canvasComponents = [];

    function initializeReportBuilder() {
      setupBuilderRealTime();
      setupDragAndDrop();
      updateBuilderSaveTime();
    }

    function setupBuilderRealTime() {
      setInterval(() => {
        const timeElement = document.getElementById('builderTime');
        if (timeElement) {
          timeElement.textContent = new Date().toLocaleTimeString();
        }
      }, 1000);
    }

    function setupDragAndDrop() {
      const canvas = document.getElementById('reportCanvas');
      const draggableItems = document.querySelectorAll('.draggable-item');

      draggableItems.forEach(item => {
        item.addEventListener('dragstart', (e) => {
          e.dataTransfer.setData('text/plain', JSON.stringify({
            type: item.dataset.type,
            source: item.dataset.source,
            chart: item.dataset.chart,
            filter: item.dataset.filter
          }));
        });
        item.setAttribute('draggable', 'true');
      });

      canvas.addEventListener('dragover', (e) => {
        e.preventDefault();
        canvas.style.borderColor = '#3b82f6';
        canvas.style.background = '#eff6ff';
      });

      canvas.addEventListener('dragleave', (e) => {
        canvas.style.borderColor = '#d1d5db';
        canvas.style.background = '#fafafa';
      });

      canvas.addEventListener('drop', (e) => {
        e.preventDefault();
        canvas.style.borderColor = '#d1d5db';
        canvas.style.background = '#fafafa';

        const data = JSON.parse(e.dataTransfer.getData('text/plain'));
        addComponentToCanvas(data);
      });
    }

    function addComponentToCanvas(component) {
      const canvas = document.getElementById('reportCanvas');
      const componentId = `component_${Date.now()}`;

      let componentHtml = '';

      if (component.type === 'data-source') {
        componentHtml = `
          <div id="${componentId}" class="canvas-component" style="background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; cursor: pointer;" onclick="selectComponent('${componentId}')">
            <div style="display: flex; justify-content: between; align-items: center;">
              <h4 style="margin: 0; color: #1f2937;">${component.source.charAt(0).toUpperCase() + component.source.slice(1)} Data</h4>
              <button onclick="removeComponent('${componentId}')" style="background: #ef4444; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">✕</button>
            </div>
            <p style="margin: 0.5rem 0 0 0; color: #6b7280; font-size: 0.875rem;">Connected to ${component.source} database</p>
          </div>
        `;
      } else if (component.type === 'chart') {
        componentHtml = `
          <div id="${componentId}" class="canvas-component" style="background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; cursor: pointer;" onclick="selectComponent('${componentId}')">
            <div style="display: flex; justify-content: between; align-items: center;">
              <h4 style="margin: 0; color: #1f2937;">${component.chart.charAt(0).toUpperCase() + component.chart.slice(1)} Chart</h4>
              <button onclick="removeComponent('${componentId}')" style="background: #ef4444; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">✕</button>
            </div>
            <div style="height: 200px; background: #f8fafc; border-radius: 6px; margin-top: 0.5rem; display: flex; align-items: center; justify-content: center; color: #6b7280;">
              📊 ${component.chart.charAt(0).toUpperCase() + component.chart.slice(1)} Chart Preview
            </div>
          </div>
        `;
      } else if (component.type === 'filter') {
        componentHtml = `
          <div id="${componentId}" class="canvas-component" style="background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; cursor: pointer;" onclick="selectComponent('${componentId}')">
            <div style="display: flex; justify-content: between; align-items: center;">
              <h4 style="margin: 0; color: #1f2937;">${component.filter.charAt(0).toUpperCase() + component.filter.slice(1)} Filter</h4>
              <button onclick="removeComponent('${componentId}')" style="background: #ef4444; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">✕</button>
            </div>
            <p style="margin: 0.5rem 0 0 0; color: #6b7280; font-size: 0.875rem;">Interactive ${component.filter} filter control</p>
          </div>
        `;
      }

      // Replace empty state with components
      if (canvas.children.length === 1 && canvas.children[0].textContent.includes('Drag components here')) {
        canvas.innerHTML = '';
      }

      canvas.insertAdjacentHTML('beforeend', componentHtml);
      canvasComponents.push({ id: componentId, ...component });

      showToast(`✅ ${component.type} added to report`, 'success', 1500);
    }

    function selectComponent(componentId) {
      // Clear previous selections
      document.querySelectorAll('.canvas-component').forEach(comp => {
        comp.style.border = '1px solid #e2e8f0';
      });

      // Highlight selected component
      const component = document.getElementById(componentId);
      component.style.border = '2px solid #3b82f6';

      // Show properties panel
      showComponentProperties(componentId);
    }

    function showComponentProperties(componentId) {
      const component = canvasComponents.find(c => c.id === componentId);
      const propertiesPanel = document.getElementById('propertiesPanel');

      if (component) {
        propertiesPanel.innerHTML = `
          <h4 style="margin: 0 0 1rem 0; color: #1f2937;">Component Properties</h4>

          <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Title:</label>
            <input type="text" value="${component.type} Component" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
          </div>

          <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Width:</label>
            <select style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
              <option>Full Width</option>
              <option>Half Width</option>
              <option>Quarter Width</option>
            </select>
          </div>

          <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Height:</label>
            <select style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
              <option>Auto</option>
              <option>Small (200px)</option>
              <option>Medium (300px)</option>
              <option>Large (400px)</option>
            </select>
          </div>

          <button onclick="updateComponentProperties('${componentId}')" style="background: #3b82f6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; width: 100%;">Update Properties</button>
        `;
      }
    }

    function removeComponent(componentId) {
      const component = document.getElementById(componentId);
      component.remove();
      canvasComponents = canvasComponents.filter(c => c.id !== componentId);

      // Reset properties panel
      document.getElementById('propertiesPanel').innerHTML = `
        <div style="color: #6b7280; text-align: center; padding: 2rem 1rem;">
          <div style="font-size: 2rem; margin-bottom: 1rem;">⚙️</div>
          <p style="margin: 0; font-size: 0.875rem;">Select a component to view its properties</p>
        </div>
      `;

      showToast('🗑️ Component removed', 'info', 1500);
    }

    function clearCanvas() {
      if (confirm('Are you sure you want to clear the entire canvas?')) {
        const canvas = document.getElementById('reportCanvas');
        canvas.innerHTML = `
          <div style="text-align: center; color: #6b7280; padding: 4rem 2rem;">
            <div style="font-size: 4rem; margin-bottom: 1rem;">🎨</div>
            <h3 style="margin: 0 0 1rem 0;">Drag components here to build your report</h3>
            <p style="margin: 0; font-size: 0.875rem;">Start by dragging a data source or visualization from the left panel</p>
          </div>
        `;
        canvasComponents = [];
        showToast('🗑️ Canvas cleared', 'success', 2000);
      }
    }

    function undoAction() {
      showToast('↶ Undo last action', 'info', 1500);
      // Implementation would track actions and reverse them
    }

    function saveReportTemplate() {
      showToast('💾 Saving report template...', 'info', 1500);
      setTimeout(() => {
        updateBuilderSaveTime();
        showToast('✅ Report template saved successfully!', 'success', 2000);
      }, 1500);
    }

    function updateBuilderSaveTime() {
      const lastSaveElement = document.getElementById('lastBuilderSave');
      if (lastSaveElement) {
        const now = new Date();
        lastSaveElement.textContent = `Last saved: ${now.toLocaleTimeString()}`;
      }
    }

    function previewCustomReport() {
      showToast('👁️ Generating report preview...', 'info', 2000);
      setTimeout(() => {
        showToast('✅ Preview generated! Opening in new window...', 'success', 2000);
      }, 2000);
    }

    function loadTemplate() {
      const templateModal = `
        <div id="templateModal" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 15000;">
          <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 600px; width: 90vw; max-height: 80vh; overflow-y: auto;">
            <h3 style="margin: 0 0 1rem 0;">📋 Load Report Template</h3>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
              <div style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem; cursor: pointer; transition: all 0.2s;" onclick="loadTemplateType('enrollment')">
                <h4 style="margin: 0 0 0.5rem 0;">🎓 Enrollment Report</h4>
                <p style="margin: 0; font-size: 0.875rem; color: #6b7280;">Student enrollment trends and analysis</p>
              </div>
              <div style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem; cursor: pointer; transition: all 0.2s;" onclick="loadTemplateType('financial')">
                <h4 style="margin: 0 0 0.5rem 0;">💰 Financial Report</h4>
                <p style="margin: 0; font-size: 0.875rem; color: #6b7280;">Revenue and financial performance</p>
              </div>
              <div style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem; cursor: pointer; transition: all 0.2s;" onclick="loadTemplateType('performance')">
                <h4 style="margin: 0 0 0.5rem 0;">📊 Performance Report</h4>
                <p style="margin: 0; font-size: 0.875rem; color: #6b7280;">KPI tracking and metrics</p>
              </div>
              <div style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem; cursor: pointer; transition: all 0.2s;" onclick="loadTemplateType('demographics')">
                <h4 style="margin: 0 0 0.5rem 0;">👥 Demographics Report</h4>
                <p style="margin: 0; font-size: 0.875rem; color: #6b7280;">Student demographics analysis</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem; justify-content: end;">
              <button onclick="closeModal('templateModal')" style="background: #6b7280; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">Cancel</button>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', templateModal);
    }

    function loadTemplateType(type) {
      closeModal('templateModal');
      showToast(`📋 Loading ${type} template...`, 'info', 2000);
      setTimeout(() => {
        showToast(`✅ ${type.charAt(0).toUpperCase() + type.slice(1)} template loaded!`, 'success', 2000);
      }, 2000);
    }

    function exportCustomReport(format) {
      showToast(`📄 Exporting custom report as ${format.toUpperCase()}...`, 'info', 2000);
      setTimeout(() => {
        const fileSize = Math.round(Math.random() * 1000 + 500);
        showToast(`✅ Custom report exported (${fileSize}KB)`, 'success', 2000);
      }, 2000);
    }

    function shareCustomReport() {
      const shareModal = `
        <div id="shareCustomModal" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 15000;">
          <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 500px; width: 90vw;">
            <h3 style="margin: 0 0 1rem 0;">📤 Share Custom Report</h3>
            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem;">Recipients:</label>
              <input type="email" placeholder="Enter email addresses" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
            </div>
            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem;">Access Level:</label>
              <select style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                <option>View Only</option>
                <option>Edit Access</option>
                <option>Full Access</option>
              </select>
            </div>
            <div style="display: flex; gap: 1rem; justify-content: end;">
              <button onclick="closeModal('shareCustomModal')" style="background: #6b7280; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">Cancel</button>
              <button onclick="sendCustomReport()" style="background: #10b981; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">📤 Share</button>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', shareModal);
    }

    function sendCustomReport() {
      closeModal('shareCustomModal');
      showToast('📧 Sharing custom report...', 'info', 1500);
      setTimeout(() => {
        showToast('✅ Custom report shared successfully!', 'success', 2000);
      }, 1500);
    }

    function scheduleCustomReport() {
      showToast('⏰ Custom report scheduling coming soon...', 'info', 2000);
    }

    function generateBuilderInsights() {
      showToast('🤖 Builder AI insights coming soon...', 'info', 2000);
    }

    function toggleBuilderFullscreen() {
      const modal = document.getElementById('customReportModal');
      const button = document.querySelector('[onclick="toggleBuilderFullscreen()"]');

      if (modal) {
        const isFullscreen = modal.getAttribute('data-fullscreen') === 'true';

        if (isFullscreen) {
          modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 95vw; height: 90vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;';
          modal.setAttribute('data-fullscreen', 'false');
          if (button) button.innerHTML = '🖥️ Fullscreen';
          showToast('📱 Exited fullscreen mode', 'info', 1500);
        } else {
          modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center; z-index: 10000;';
          modal.setAttribute('data-fullscreen', 'true');
          if (button) button.innerHTML = '📱 Exit Fullscreen';
          showToast('🖥️ Entered fullscreen mode', 'info', 1500);
        }

        const modalContent = modal.querySelector('div[style*="background: white"]');
        if (modalContent) {
          if (isFullscreen) {
            modalContent.style.width = '95vw';
            modalContent.style.height = '90vh';
            modalContent.style.borderRadius = '16px';
          } else {
            modalContent.style.width = '100vw';
            modalContent.style.height = '100vh';
            modalContent.style.borderRadius = '0';
          }
        }
      }
    }

    // 5. Real-time Dashboard
    function openRealtimeDashboard() {
      showToast('📊 Loading Real-time Dashboard...', 'info', 2000);
      setTimeout(() => {
        const dashboardModal = `
          <div id="realtimeModal" data-fullscreen="false" style="position: fixed; top: 0; left: 0; width: 95vw; height: 90vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;">
            <div style="background: white; width: 95vw; height: 90vh; border-radius: 16px; overflow: hidden; display: flex; flex-direction: column;">
              <div style="background: linear-gradient(135deg, #06b6d4, #0891b2); color: white; padding: 1.5rem; display: flex; justify-content: between; align-items: center;">
                <div>
                  <h2 style="margin: 0; font-size: 1.5rem;">📊 Real-time Analytics Dashboard</h2>
                  <div style="display: flex; align-items: center; gap: 1rem; margin-top: 0.5rem;">
                    <span style="font-size: 0.875rem; color: #10b981;">🟢 Live Data Stream</span>
                    <span id="dashboardTime" style="font-size: 0.875rem; color: rgba(255,255,255,0.8);"></span>
                  </div>
                </div>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                  <button onclick="toggleRealtimeFullscreen()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">🖥️ Fullscreen</button>
                  <button onclick="closeModal('realtimeModal')" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">✕ Close</button>
                </div>
              </div>
              <div style="flex: 1; overflow-y: auto; padding: 2rem;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                  <div style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; padding: 1.5rem; border-radius: 12px;">
                    <div style="font-size: 2rem; font-weight: bold;">1,247</div>
                    <div style="opacity: 0.9;">Live Applications</div>
                  </div>
                  <div style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 1.5rem; border-radius: 12px;">
                    <div style="font-size: 2rem; font-weight: bold;">423</div>
                    <div style="opacity: 0.9;">Active Enrollments</div>
                  </div>
                  <div style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 1.5rem; border-radius: 12px;">
                    <div style="font-size: 2rem; font-weight: bold;">$2.4M</div>
                    <div style="opacity: 0.9;">Monthly Revenue</div>
                  </div>
                </div>
                <div style="background: #f1f5f9; padding: 1.5rem; border-radius: 12px; text-align: center;">
                  <h3 style="margin: 0 0 1rem 0;">🚀 Real-time Dashboard Active</h3>
                  <p style="margin: 0; color: #6b7280;">Live data streaming and real-time analytics are now operational.</p>
                </div>
              </div>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML('beforeend', dashboardModal);
        setupRealtimeUpdates();
      }, 1000);
    }

    function setupRealtimeUpdates() {
      setInterval(() => {
        const timeElement = document.getElementById('dashboardTime');
        if (timeElement) {
          timeElement.textContent = new Date().toLocaleTimeString();
        }
      }, 1000);
    }

    function toggleRealtimeFullscreen() {
      const modal = document.getElementById('realtimeModal');
      const button = document.querySelector('[onclick="toggleRealtimeFullscreen()"]');
      if (modal) {
        const isFullscreen = modal.getAttribute('data-fullscreen') === 'true';
        if (isFullscreen) {
          modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 95vw; height: 90vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;';
          modal.setAttribute('data-fullscreen', 'false');
          if (button) button.innerHTML = '🖥️ Fullscreen';
        } else {
          modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center; z-index: 10000;';
          modal.setAttribute('data-fullscreen', 'true');
          if (button) button.innerHTML = '📱 Exit Fullscreen';
        }
        const modalContent = modal.querySelector('div[style*="background: white"]');
        if (modalContent) {
          modalContent.style.width = isFullscreen ? '95vw' : '100vw';
          modalContent.style.height = isFullscreen ? '90vh' : '100vh';
          modalContent.style.borderRadius = isFullscreen ? '16px' : '0';
        }
      }
    }

    // 6. Automated Reporting
    function openAutomatedReporting() {
      showToast('⏰ Loading Automated Reporting...', 'info', 2000);
      setTimeout(() => {
        const automatedModal = `
          <div id="automatedModal" data-fullscreen="false" style="position: fixed; top: 0; left: 0; width: 95vw; height: 90vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;">
            <div style="background: white; width: 95vw; height: 90vh; border-radius: 16px; overflow: hidden; display: flex; flex-direction: column;">
              <div style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 1.5rem; display: flex; justify-content: between; align-items: center;">
                <h2 style="margin: 0; font-size: 1.5rem;">⏰ Automated Report Scheduling & Delivery</h2>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                  <button onclick="toggleAutomatedFullscreen()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">🖥️ Fullscreen</button>
                  <button onclick="closeModal('automatedModal')" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">✕ Close</button>
                </div>
              </div>
              <div style="flex: 1; overflow-y: auto; padding: 2rem;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                  <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                    <h3 style="margin: 0 0 1rem 0;">📅 Schedule New Report</h3>
                    <div style="margin-bottom: 1rem;">
                      <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Report Type:</label>
                      <select style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                        <option>Monthly Performance Report</option>
                        <option>Weekly Application Summary</option>
                        <option>Quarterly Financial Report</option>
                      </select>
                    </div>
                    <div style="margin-bottom: 1rem;">
                      <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Frequency:</label>
                      <select style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                        <option>Daily</option>
                        <option>Weekly</option>
                        <option>Monthly</option>
                      </select>
                    </div>
                    <button onclick="scheduleNewReport()" style="background: #f59e0b; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; width: 100%;">⏰ Schedule Report</button>
                  </div>
                  <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                    <h3 style="margin: 0 0 1rem 0;">📊 Active Schedules</h3>
                    <div style="space-y: 1rem;">
                      <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <div style="font-weight: 500;">Monthly Performance Report</div>
                        <div style="font-size: 0.875rem; color: #6b7280;">Every 1st of month at 9:00 AM</div>
                        <div style="margin-top: 0.5rem;">
                          <span style="background: #dcfce7; color: #16a34a; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">Active</span>
                        </div>
                      </div>
                      <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <div style="font-weight: 500;">Weekly Application Summary</div>
                        <div style="font-size: 0.875rem; color: #6b7280;">Every Monday at 8:00 AM</div>
                        <div style="margin-top: 0.5rem;">
                          <span style="background: #dcfce7; color: #16a34a; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">Active</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div style="background: #f1f5f9; padding: 1.5rem; border-radius: 12px; text-align: center;">
                  <h3 style="margin: 0 0 1rem 0;">🤖 Automated Reporting System</h3>
                  <p style="margin: 0; color: #6b7280;">Configure automated report generation and delivery schedules.</p>
                  <div style="margin-top: 1rem; display: flex; gap: 1rem; justify-content: center;">
                    <button onclick="showToast('📧 Email settings opened', 'info', 2000)" style="background: #3b82f6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">📧 Email Settings</button>
                    <button onclick="showToast('📋 Templates opened', 'info', 2000)" style="background: #10b981; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">📋 Templates</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML('beforeend', automatedModal);
      }, 1000);
    }

    function scheduleNewReport() {
      showToast('⏰ Report scheduled successfully!', 'success', 2000);
    }

    function toggleAutomatedFullscreen() {
      const modal = document.getElementById('automatedModal');
      const button = document.querySelector('[onclick="toggleAutomatedFullscreen()"]');
      if (modal) {
        const isFullscreen = modal.getAttribute('data-fullscreen') === 'true';
        if (isFullscreen) {
          modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 95vw; height: 90vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;';
          modal.setAttribute('data-fullscreen', 'false');
          if (button) button.innerHTML = '🖥️ Fullscreen';
        } else {
          modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center; z-index: 10000;';
          modal.setAttribute('data-fullscreen', 'true');
          if (button) button.innerHTML = '📱 Exit Fullscreen';
        }
        const modalContent = modal.querySelector('div[style*="background: white"]');
        if (modalContent) {
          modalContent.style.width = isFullscreen ? '95vw' : '100vw';
          modalContent.style.height = isFullscreen ? '90vh' : '100vh';
          modalContent.style.borderRadius = isFullscreen ? '16px' : '0';
        }
      }
    }

    // 7. Comparative Analysis
    function openComparativeAnalysis() {
      showToast('📈 Loading Comparative Analysis...', 'info', 2000);
      setTimeout(() => {
        const comparativeModal = `
          <div id="comparativeModal" data-fullscreen="false" style="position: fixed; top: 0; left: 0; width: 95vw; height: 90vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;">
            <div style="background: white; width: 95vw; height: 90vh; border-radius: 16px; overflow: hidden; display: flex; flex-direction: column;">
              <div style="background: linear-gradient(135deg, #ef4444, #dc2626); color: white; padding: 1.5rem; display: flex; justify-content: between; align-items: center;">
                <h2 style="margin: 0; font-size: 1.5rem;">📈 Comparative Analysis with Peer Institutions</h2>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                  <button onclick="toggleComparativeFullscreen()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">🖥️ Fullscreen</button>
                  <button onclick="closeModal('comparativeModal')" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">✕ Close</button>
                </div>
              </div>
              <div style="flex: 1; overflow-y: auto; padding: 2rem;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                  <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                    <h3 style="margin: 0 0 1rem 0;">🎯 Performance Comparison</h3>
                    <div style="margin-bottom: 1rem;">
                      <div style="display: flex; justify-content: between; margin-bottom: 0.5rem;">
                        <span>Application Rate</span>
                        <span style="color: #10b981;">+12% vs peers</span>
                      </div>
                      <div style="background: #e5e7eb; border-radius: 4px; height: 8px;">
                        <div style="background: #10b981; height: 100%; width: 75%; border-radius: 4px;"></div>
                      </div>
                    </div>
                    <div style="margin-bottom: 1rem;">
                      <div style="display: flex; justify-content: between; margin-bottom: 0.5rem;">
                        <span>Enrollment Rate</span>
                        <span style="color: #f59e0b;">-3% vs peers</span>
                      </div>
                      <div style="background: #e5e7eb; border-radius: 4px; height: 8px;">
                        <div style="background: #f59e0b; height: 100%; width: 60%; border-radius: 4px;"></div>
                      </div>
                    </div>
                  </div>
                  <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                    <h3 style="margin: 0 0 1rem 0;">🏆 Ranking Position</h3>
                    <div style="text-align: center;">
                      <div style="font-size: 3rem; font-weight: bold; color: #3b82f6;">#7</div>
                      <div style="color: #6b7280;">out of 25 peer institutions</div>
                      <div style="margin-top: 1rem; color: #10b981;">↑ 2 positions this quarter</div>
                    </div>
                  </div>
                  <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                    <h3 style="margin: 0 0 1rem 0;">📊 Benchmarking</h3>
                    <div style="font-size: 0.875rem; color: #6b7280;">
                      <div style="margin-bottom: 0.5rem;">• Average processing time: 2.1 days (peer avg: 2.8 days)</div>
                      <div style="margin-bottom: 0.5rem;">• Student satisfaction: 4.6/5 (peer avg: 4.2/5)</div>
                      <div style="margin-bottom: 0.5rem;">• Cost per application: $45 (peer avg: $52)</div>
                    </div>
                  </div>
                </div>
                <div style="background: #f1f5f9; padding: 1.5rem; border-radius: 12px; text-align: center;">
                  <h3 style="margin: 0 0 1rem 0;">🔍 Peer Institution Analysis</h3>
                  <p style="margin: 0; color: #6b7280;">Compare your institution's performance against similar organizations.</p>
                  <div style="margin-top: 1rem; display: flex; gap: 1rem; justify-content: center;">
                    <button onclick="showToast('📊 Detailed comparison opened', 'info', 2000)" style="background: #ef4444; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">📊 Detailed View</button>
                    <button onclick="showToast('📈 Trends analysis opened', 'info', 2000)" style="background: #8b5cf6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">📈 Trends</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML('beforeend', comparativeModal);
      }, 1000);
    }

    function toggleComparativeFullscreen() {
      const modal = document.getElementById('comparativeModal');
      const button = document.querySelector('[onclick="toggleComparativeFullscreen()"]');
      if (modal) {
        const isFullscreen = modal.getAttribute('data-fullscreen') === 'true';
        if (isFullscreen) {
          modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 95vw; height: 90vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;';
          modal.setAttribute('data-fullscreen', 'false');
          if (button) button.innerHTML = '🖥️ Fullscreen';
        } else {
          modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center; z-index: 10000;';
          modal.setAttribute('data-fullscreen', 'true');
          if (button) button.innerHTML = '📱 Exit Fullscreen';
        }
        const modalContent = modal.querySelector('div[style*="background: white"]');
        if (modalContent) {
          modalContent.style.width = isFullscreen ? '95vw' : '100vw';
          modalContent.style.height = isFullscreen ? '90vh' : '100vh';
          modalContent.style.borderRadius = isFullscreen ? '16px' : '0';
        }
      }
    }

    // 8. Export Capabilities
    function openExportCapabilities() {
      showToast('📤 Loading Export Capabilities...', 'info', 2000);
      setTimeout(() => {
        const exportModal = `
          <div id="exportModal" data-fullscreen="false" style="position: fixed; top: 0; left: 0; width: 95vw; height: 90vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;">
            <div style="background: white; width: 95vw; height: 90vh; border-radius: 16px; overflow: hidden; display: flex; flex-direction: column;">
              <div style="background: linear-gradient(135deg, #059669, #047857); color: white; padding: 1.5rem; display: flex; justify-content: between; align-items: center;">
                <h2 style="margin: 0; font-size: 1.5rem;">📤 Export Capabilities (PDF, Excel, CSV)</h2>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                  <button onclick="toggleExportFullscreen()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">🖥️ Fullscreen</button>
                  <button onclick="closeModal('exportModal')" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">✕ Close</button>
                </div>
              </div>
              <div style="flex: 1; overflow-y: auto; padding: 2rem;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                  <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                    <h3 style="margin: 0 0 1rem 0;">📄 PDF Exports</h3>
                    <div style="margin-bottom: 1rem;">
                      <button onclick="showToast('📄 Application report exported as PDF', 'success', 2000)" style="background: #dc2626; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; width: 100%; margin-bottom: 0.5rem;">Application Report PDF</button>
                      <button onclick="showToast('📄 Performance report exported as PDF', 'success', 2000)" style="background: #dc2626; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; width: 100%; margin-bottom: 0.5rem;">Performance Report PDF</button>
                      <button onclick="showToast('📄 Financial report exported as PDF', 'success', 2000)" style="background: #dc2626; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; width: 100%;">Financial Report PDF</button>
                    </div>
                  </div>
                  <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                    <h3 style="margin: 0 0 1rem 0;">📊 Excel Exports</h3>
                    <div style="margin-bottom: 1rem;">
                      <button onclick="showToast('📊 Student data exported to Excel', 'success', 2000)" style="background: #16a34a; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; width: 100%; margin-bottom: 0.5rem;">Student Data Excel</button>
                      <button onclick="showToast('📊 Analytics data exported to Excel', 'success', 2000)" style="background: #16a34a; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; width: 100%; margin-bottom: 0.5rem;">Analytics Data Excel</button>
                      <button onclick="showToast('📊 Financial data exported to Excel', 'success', 2000)" style="background: #16a34a; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; width: 100%;">Financial Data Excel</button>
                    </div>
                  </div>
                  <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                    <h3 style="margin: 0 0 1rem 0;">📋 CSV Exports</h3>
                    <div style="margin-bottom: 1rem;">
                      <button onclick="showToast('📋 Application data exported as CSV', 'success', 2000)" style="background: #3b82f6; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; width: 100%; margin-bottom: 0.5rem;">Application Data CSV</button>
                      <button onclick="showToast('📋 Enrollment data exported as CSV', 'success', 2000)" style="background: #3b82f6; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; width: 100%; margin-bottom: 0.5rem;">Enrollment Data CSV</button>
                      <button onclick="showToast('📋 Performance data exported as CSV', 'success', 2000)" style="background: #3b82f6; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; width: 100%;">Performance Data CSV</button>
                    </div>
                  </div>
                </div>
                <div style="background: #f1f5f9; padding: 1.5rem; border-radius: 12px; text-align: center;">
                  <h3 style="margin: 0 0 1rem 0;">📦 Bulk Export Options</h3>
                  <p style="margin: 0 0 1rem 0; color: #6b7280;">Export multiple reports and datasets in various formats.</p>
                  <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <button onclick="showToast('📦 Bulk export started', 'info', 2000)" style="background: #8b5cf6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">📦 Bulk Export All</button>
                    <button onclick="showToast('⏰ Export scheduled', 'success', 2000)" style="background: #f59e0b; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">⏰ Schedule Export</button>
                    <button onclick="showToast('📧 Export sent via email', 'success', 2000)" style="background: #059669; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">📧 Email Export</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML('beforeend', exportModal);
      }, 1000);
    }

    function toggleExportFullscreen() {
      const modal = document.getElementById('exportModal');
      const button = document.querySelector('[onclick="toggleExportFullscreen()"]');
      if (modal) {
        const isFullscreen = modal.getAttribute('data-fullscreen') === 'true';
        if (isFullscreen) {
          modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 95vw; height: 90vh; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;';
          modal.setAttribute('data-fullscreen', 'false');
          if (button) button.innerHTML = '🖥️ Fullscreen';
        } else {
          modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center; z-index: 10000;';
          modal.setAttribute('data-fullscreen', 'true');
          if (button) button.innerHTML = '📱 Exit Fullscreen';
        }
        const modalContent = modal.querySelector('div[style*="background: white"]');
        if (modalContent) {
          modalContent.style.width = isFullscreen ? '95vw' : '100vw';
          modalContent.style.height = isFullscreen ? '90vh' : '100vh';
          modalContent.style.borderRadius = isFullscreen ? '16px' : '0';
        }
      }
    }

    console.log('✅ All report functions loaded and available');
  </script>

  <!-- Flow Cookie Consent System -->
  <script src="/assets/js/cookie-consent.js"></script>
</body>
</html>